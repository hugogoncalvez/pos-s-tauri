import{W as L,X as B,j as t,a as ae,b as oe,r as c,e as ne,o as v,U as y,m as se,P as Y,T as w,G as o,I,B as ie,a0 as m,i as q,a2 as E}from"./index-C4A7YWMW.js";import{S as O}from"./StyledAutocomplete-D4kJFy6t.js";import{S as de}from"./StyledCard-fRo-XxED.js";import{d as z}from"./Clear-CkvqAIGR.js";import{E as le}from"./EnhancedTable-BX9li6wm.js";import{v as ce}from"./variants-CUQepozP.js";import{A as ue}from"./Autocomplete-okLxTLSl.js";import"./Card-DZlrFGgg.js";import"./TableRow-BsCYnncP.js";import"./TableBody-Bv-WiDt9.js";import"./Popper-ijWchD3c.js";import"./Chip-Bc7mlkaj.js";var P={},pe=L;Object.defineProperty(P,"__esModule",{value:!0});var W=P.default=void 0,me=pe(B()),he=t;W=P.default=(0,me.default)((0,he.jsx)("path",{d:"M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3m-3 11H8v-5h8zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1m-1-9H6v4h12z"}),"Print");var D={},xe=L;Object.defineProperty(D,"__esModule",{value:!0});var H=D.default=void 0,ye=xe(B()),fe=t;H=D.default=(0,ye.default)((0,fe.jsx)("path",{d:"M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"}),"KeyboardArrowDown");const Me=()=>{const U=ae(),N=oe("(max-width:450px)"),[h,d]=c.useState(0),[p,Q]=c.useState(5),[r,x,G]=ne({startDate:v().startOf("month").format("YYYY-MM-DD"),endDate:v().endOf("month").format("YYYY-MM-DD"),reportType:"salesSummary",userId:"",productId:"",categoryId:"",supplierId:"",paymentMethod:"",cashSessionId:""}),S=new URLSearchParams({page:h,limit:p,...r.startDate&&{startDate:r.startDate},...r.endDate&&{endDate:r.endDate},...r.productId&&{productId:r.productId},...r.supplierId&&{supplierId:r.supplierId}}).toString(),A=new URLSearchParams({page:h,limit:p,...r.startDate&&{startDate:r.startDate},...r.endDate&&{endDate:r.endDate},...r.productId&&{productId:r.productId},...r.supplierId&&{supplierId:r.supplierId}}).toString(),[f,K]=c.useState(!1),{data:l}=y("stock","/stock",!0),{data:C}=y("suppliers","/suppliers",!0),{data:n,isFetching:V}=y(["purchasesDetails",S],`/purchasesdetails?${S}`,!0,0,{keepPreviousData:!0}),{data:s,isFetching:X}=y(["salesDetails",A],`/salesdetails?${A}`,!0,0,{keepPreviousData:!0}),F=[{value:"salesSummary",label:"Ventas"},{value:"purchasesSummary",label:"Compras"}],g=e=>{x(e),d(0)},M=e=>{x({target:{name:e,value:""}}),d(0)},J=()=>{G(),d(0)},Z=()=>{const e=window.open("","_blank");e.document.write("<html><head><title>Informe de Movimientos</title>"),e.document.write("<style>"),e.document.write("body { font-family: Arial, sans-serif; margin: 20px; }"),e.document.write("h1 { text-align: center; margin-bottom: 20px; }"),e.document.write("table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }"),e.document.write("th, td { border: 1px solid black; padding: 8px; text-align: left; }"),e.document.write("th { background-color: lightgray; }"),e.document.write("@media print { .no-print { display: none; } }"),e.document.write("</style>"),e.document.write("</head><body>"),e.document.write("<h1>Informe de Movimientos de Productos</h1>"),e.document.write("<table>"),e.document.write("<thead><tr>"),b.forEach(a=>{e.document.write(`<th>${a.label}</th>`)}),e.document.write("</tr></thead>"),e.document.write("<tbody>"),T.forEach(a=>{e.document.write("<tr>"),b.forEach(u=>{e.document.write(`<td>${a[u.id]}</td>`)}),e.document.write("</tr>")}),e.document.write("</tbody>"),e.document.write("</table>"),e.document.write("</body></html>"),e.document.close(),e.print(),setTimeout(()=>{e.close()},100),e.onafterprint=function(){e.close()}},b=c.useMemo(()=>[{id:"date",label:"Fecha"},{id:"product",label:"Producto"},{id:"description",label:"Descripción"},{id:"supplier",label:"Proveedor"},{id:"type",label:"Tipo de Movimiento"},{id:"quantity",label:"Cantidad"},{id:"unit_cost",label:"Costo Unitario"},{id:"total_cost",label:"Costo Total"}],[]),T=c.useMemo(()=>{let e=[];return r.reportType==="salesSummary"?e=Array.isArray(s==null?void 0:s.rows)?s.rows:[]:r.reportType==="purchasesSummary"&&(e=Array.isArray(n==null?void 0:n.rows)?n.rows:[]),e.map(a=>{var _,R,k,$;const u=r.reportType==="salesSummary",i=a.stock||((_=l==null?void 0:l.data)==null?void 0:_.find(re=>re.id===a.stock_id));return{id:a.id,date:v(u?(R=a.sale)==null?void 0:R.createdAt:(k=a.purchase)==null?void 0:k.createdAt).format("DD/MM/YYYY"),product:(i==null?void 0:i.name)||"N/A",description:(i==null?void 0:i.description)||"N/A",supplier:(($=i==null?void 0:i.supplier)==null?void 0:$.nombre)||"N/A",type:u?"Venta/Egreso":"Ingreso",quantity:a.quantity,unit_cost:`$ ${parseFloat(u?a.price:a.cost||0).toFixed(2)}`,total_cost:`$ ${parseFloat((u?a.price:a.cost)*a.quantity||0).toFixed(2)}`}})},[n,s,l,r.reportType]),j=c.useMemo(()=>r.reportType==="salesSummary"?(s==null?void 0:s.count)||0:r.reportType==="purchasesSummary"&&(n==null?void 0:n.count)||0,[s,n,r.reportType]);c.useEffect(()=>{const e=Math.max(0,Math.ceil(j/p)-1);h>e&&d(0)},[j,p]);const ee=(e,a)=>{d(a)},te=e=>{Q(parseInt(e.target.value,10)),d(0)};return t.jsxs(se.div,{initial:"hidden",animate:"enter",exit:"exit",variants:ce,transition:{duration:1.5,type:"easeInOut"},className:"relative",children:[t.jsxs(Y,{elevation:3,sx:{p:{xs:2,sm:3},mb:3,mt:2,background:e=>e.palette.background.componentHeaderBackground,color:U.palette.primary.contrastText},children:[t.jsx(w,{variant:N?"h5":"h4",gutterBottom:!0,children:"Informe de Movimientos de Productos"}),t.jsx(w,{variant:"body1",sx:{opacity:.9},children:"Aquí puedes ver todos los movimientos de tus productos."})]}),t.jsxs(de,{sx:{p:2,mb:3},children:[t.jsxs(o,{container:!0,justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[t.jsx(w,{variant:"h6",children:"Filtros de Búsqueda"}),t.jsx(I,{disableRipple:!0,size:"small",onClick:()=>K(!f),sx:{p:0},children:t.jsx(H,{sx:{transition:"0.5s",transform:f?"rotate(-180deg)":"rotate(0)",backgroundColor:"primary.main",color:"primary.contrastText",borderRadius:"50%"}})})]}),t.jsx(ie,{sx:{height:f?"auto":0,overflow:"hidden",transition:"height 0.3s ease-in-out"},children:t.jsxs(o,{container:!0,spacing:2,sx:{justifyContent:"center",padding:2},children:[t.jsx(o,{item:!0,sx:{width:"clamp(250px, 30%, 400px)"},children:t.jsxs(o,{container:!0,direction:"column",spacing:2,children:[t.jsx(o,{item:!0,children:t.jsx(m,{label:"Fecha Desde",type:"date",name:"startDate",value:r.startDate?r.startDate.substr(0,10):"",onChange:g,fullWidth:!0,autoComplete:"off",InputLabelProps:{shrink:!0},InputProps:{startAdornment:t.jsx(q,{position:"start",children:t.jsx(I,{size:"small",onClick:()=>M("startDate"),children:t.jsx(z,{fontSize:"small",color:"error"})})})}})}),t.jsx(o,{item:!0,children:t.jsx(m,{label:"Fecha Hasta",type:"date",name:"endDate",value:r.endDate?r.endDate.substr(0,10):"",onChange:g,fullWidth:!0,autoComplete:"off",InputLabelProps:{shrink:!0},InputProps:{startAdornment:t.jsx(q,{position:"start",children:t.jsx(I,{size:"small",onClick:()=>M("endDate"),children:t.jsx(z,{fontSize:"small",color:"error"})})})}})})]})}),t.jsx(o,{item:!0,sx:{width:"clamp(250px, 30%, 400px)"},children:t.jsxs(o,{container:!0,direction:"column",spacing:2,children:[t.jsx(o,{item:!0,children:t.jsx(O,{options:Array.isArray(l==null?void 0:l.products)?l.products:[],getOptionLabel:e=>e.name,onChange:(e,a)=>{x({target:{name:"productId",value:a==null?void 0:a.id}}),d(0)},renderInput:e=>t.jsx(m,{...e,label:"Producto",fullWidth:!0})})}),t.jsx(o,{item:!0,children:t.jsx(O,{options:Array.isArray(C)?C:[],getOptionLabel:e=>e.nombre,onChange:(e,a)=>{x({target:{name:"supplierId",value:a==null?void 0:a.id}}),d(0)},renderInput:e=>t.jsx(m,{...e,label:"Proveedor",fullWidth:!0})})}),t.jsx(o,{item:!0,children:t.jsx(ue,{fullWidth:!0,size:"small",options:F,getOptionLabel:e=>e.label,value:F.find(e=>e.value===r.reportType)||null,onChange:(e,a)=>g({target:{name:"reportType",value:a?a.value:""}}),renderInput:e=>t.jsx(m,{...e,label:"Tipo de Reporte"})})})]})}),t.jsx(o,{item:!0,sx:{width:"clamp(200px, 20%, 300px)"},children:t.jsxs(o,{container:!0,spacing:2,sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},children:[t.jsx(o,{item:!0,children:t.jsx(E,{variant:"outlined",color:"secondary",onClick:J,children:"Limpiar"})}),t.jsx(o,{item:!0,children:t.jsx(E,{variant:"contained",color:"primary",onClick:Z,startIcon:t.jsx(W,{}),children:"Imprimir Informe"})})]})})]})})]}),t.jsx(Y,{elevation:2,sx:{p:2,mb:3},children:t.jsx(le,{columns:b,data:T,pagination:!0,count:j,page:h,rowsPerPage:p,onPageChange:ee,onRowsPerPageChange:te,loading:V||X})})]})};export{Me as default};
