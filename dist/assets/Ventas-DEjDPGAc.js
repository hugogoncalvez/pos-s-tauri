import{z as Hn,E as Qn,r as d,F as Gn,_ as Un,H as dt,j as e,J as ft,K as Kn,L as De,N as Jn,O as nn,Q as Yn,V as Xn,W as ue,X as pe,x as mt,a as Ke,S as Je,D as Ye,B as F,I as K,g as Xe,T as P,h as H,i as ae,k as xt,l as J,o as Zn,s as Ft,G as S,C as cn,Y as eo,A as to,U as no,n as E,e as on,v as ge,f as an,t as sn,Z as oo,m as ao,P as rn,w as so}from"./index-C4A7YWMW.js";import{d as qt,v as ro}from"./SaveAs-t3VbbXSm.js";import{d as Q}from"./Clear-CkvqAIGR.js";import{S as ze}from"./StyledAutocomplete-D4kJFy6t.js";import{u as io}from"./useDelete-DGUJ3i20.js";import{c as ut,m as Ue}from"./ConfirmDelete-Bi1GYp2I.js";import{E as dn}from"./EnhancedTable-BX9li6wm.js";import{v as lo}from"./variants-CUQepozP.js";import{T as pt}from"./Tooltip-DOLZfSzw.js";import{S as un}from"./StyledCard-fRo-XxED.js";import{S as co,F as uo}from"./FormControlLabel-uRoXpuuy.js";import{D as ln}from"./Divider-DlgemNlS.js";import{C as ct}from"./Chip-Bc7mlkaj.js";import{G as de}from"./Grid2-BbvPN--I.js";import{L as po,a as mo}from"./ListItemText-DgPH-Vm9.js";import{L as fo}from"./ListItemButton-BNRfcwtR.js";import"./Autocomplete-okLxTLSl.js";import"./Popper-ijWchD3c.js";import"./TableRow-BsCYnncP.js";import"./TableBody-Bv-WiDt9.js";import"./Card-DZlrFGgg.js";import"./Stack-DYQPukkq.js";import"./useThemeProps-D8tK1Axd.js";function xo(o){return Qn("MuiSwitch",o)}const V=Hn("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),ho=["className","color","edge","size","sx"],go=o=>{const{classes:i,edge:l,size:m,color:y,checked:q,disabled:$}=o,u={root:["root",l&&`edge${De(l)}`,`size${De(m)}`],switchBase:["switchBase",`color${De(y)}`,q&&"checked",$&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},b=Jn(u,xo,i);return dt({},i,b)},yo=ft("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(o,i)=>{const{ownerState:l}=o;return[i.root,l.edge&&i[`edge${De(l.edge)}`],i[`size${De(l.size)}`]]}})({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"},variants:[{props:{edge:"start"},style:{marginLeft:-8}},{props:{edge:"end"},style:{marginRight:-8}},{props:{size:"small"},style:{width:40,height:24,padding:7,[`& .${V.thumb}`]:{width:16,height:16},[`& .${V.switchBase}`]:{padding:4,[`&.${V.checked}`]:{transform:"translateX(16px)"}}}}]}),bo=ft(co,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(o,i)=>{const{ownerState:l}=o;return[i.switchBase,{[`& .${V.input}`]:i.input},l.color!=="default"&&i[`color${De(l.color)}`]]}})(({theme:o})=>({position:"absolute",top:0,left:0,zIndex:1,color:o.vars?o.vars.palette.Switch.defaultColor:`${o.palette.mode==="light"?o.palette.common.white:o.palette.grey[300]}`,transition:o.transitions.create(["left","transform"],{duration:o.transitions.duration.shortest}),[`&.${V.checked}`]:{transform:"translateX(20px)"},[`&.${V.disabled}`]:{color:o.vars?o.vars.palette.Switch.defaultDisabledColor:`${o.palette.mode==="light"?o.palette.grey[100]:o.palette.grey[600]}`},[`&.${V.checked} + .${V.track}`]:{opacity:.5},[`&.${V.disabled} + .${V.track}`]:{opacity:o.vars?o.vars.opacity.switchTrackDisabled:`${o.palette.mode==="light"?.12:.2}`},[`& .${V.input}`]:{left:"-100%",width:"300%"}}),({theme:o})=>({"&:hover":{backgroundColor:o.vars?`rgba(${o.vars.palette.action.activeChannel} / ${o.vars.palette.action.hoverOpacity})`:nn(o.palette.action.active,o.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[...Object.entries(o.palette).filter(([,i])=>i.main&&i.light).map(([i])=>({props:{color:i},style:{[`&.${V.checked}`]:{color:(o.vars||o).palette[i].main,"&:hover":{backgroundColor:o.vars?`rgba(${o.vars.palette[i].mainChannel} / ${o.vars.palette.action.hoverOpacity})`:nn(o.palette[i].main,o.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${V.disabled}`]:{color:o.vars?o.vars.palette.Switch[`${i}DisabledColor`]:`${o.palette.mode==="light"?Yn(o.palette[i].main,.62):Xn(o.palette[i].main,.55)}`}},[`&.${V.checked} + .${V.track}`]:{backgroundColor:(o.vars||o).palette[i].main}}}))]})),vo=ft("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(o,i)=>i.track})(({theme:o})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:o.transitions.create(["opacity","background-color"],{duration:o.transitions.duration.shortest}),backgroundColor:o.vars?o.vars.palette.common.onBackground:`${o.palette.mode==="light"?o.palette.common.black:o.palette.common.white}`,opacity:o.vars?o.vars.opacity.switchTrack:`${o.palette.mode==="light"?.38:.3}`})),_o=ft("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(o,i)=>i.thumb})(({theme:o})=>({boxShadow:(o.vars||o).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),jo=d.forwardRef(function(i,l){const m=Gn({props:i,name:"MuiSwitch"}),{className:y,color:q="primary",edge:$=!1,size:u="medium",sx:b}=m,A=Un(m,ho),M=dt({},m,{color:q,edge:$,size:u}),N=go(M),x=e.jsx(_o,{className:N.thumb,ownerState:M});return e.jsxs(yo,{className:Kn(N.root,y),sx:b,ownerState:M,children:[e.jsx(bo,dt({type:"checkbox",icon:x,checkedIcon:x,ref:l,ownerState:M},A,{classes:dt({},N,{root:N.switchBase})})),e.jsx(vo,{className:N.track,ownerState:M})]})});var Mt={},ko=ue;Object.defineProperty(Mt,"__esModule",{value:!0});var Lt=Mt.default=void 0,Co=ko(pe()),So=e;Lt=Mt.default=(0,Co.default)((0,So.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}),"DeleteForever");var Et={},wo=ue;Object.defineProperty(Et,"__esModule",{value:!0});var Dt=Et.default=void 0,To=wo(pe()),Io=e;Dt=Et.default=(0,To.default)((0,Io.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit");var zt={},$o=ue;Object.defineProperty(zt,"__esModule",{value:!0});var pn=zt.default=void 0,Po=$o(pe()),Ao=e;pn=zt.default=(0,Po.default)((0,Ao.jsx)("path",{d:"M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2M1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2"}),"ShoppingCart");var Nt={},Fo=ue;Object.defineProperty(Nt,"__esModule",{value:!0});var Ne=Nt.default=void 0,qo=Fo(pe()),Mo=e;Ne=Nt.default=(0,qo.default)((0,Mo.jsx)("path",{d:"M18 17H6v-2h12zm0-4H6v-2h12zm0-4H6V7h12zM3 22l1.5-1.5L6 22l1.5-1.5L9 22l1.5-1.5L12 22l1.5-1.5L15 22l1.5-1.5L18 22l1.5-1.5L21 22V2l-1.5 1.5L18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2 7.5 3.5 6 2 4.5 3.5 3 2z"}),"Receipt");var Rt={},Lo=ue;Object.defineProperty(Rt,"__esModule",{value:!0});var mn=Rt.default=void 0,Eo=Lo(pe()),Do=e;mn=Rt.default=(0,Eo.default)((0,Do.jsx)("path",{d:"m14.5 14.2 2.9 1.7-.8 1.3L13 15v-5h1.5zM22 14c0 4.41-3.59 8-8 8-2.02 0-3.86-.76-5.27-2H4c-1.15 0-2-.85-2-2V9c0-1.12.89-1.96 2-2v-.5C4 4.01 6.01 2 8.5 2c2.34 0 4.24 1.79 4.46 4.08.34-.05.69-.08 1.04-.08 4.41 0 8 3.59 8 8M6 7h5v-.74C10.88 4.99 9.8 4 8.5 4 7.12 4 6 5.12 6 6.5zm14 7c0-3.31-2.69-6-6-6s-6 2.69-6 6 2.69 6 6 6 6-2.69 6-6"}),"LockClock");var Ot={},zo=ue;Object.defineProperty(Ot,"__esModule",{value:!0});var fn=Ot.default=void 0,No=zo(pe()),Ro=e;fn=Ot.default=(0,No.default)((0,Ro.jsx)("path",{d:"M17 2H7c-1.1 0-2 .9-2 2v2c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 4H7V4h10zm3 16H4c-1.1 0-2-.9-2-2v-1h20v1c0 1.1-.9 2-2 2m-1.47-11.81C18.21 9.47 17.49 9 16.7 9H7.3c-.79 0-1.51.47-1.83 1.19L2 18h20zM9.5 16h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5m0-2h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5m0-2h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5m3 4h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5m0-2h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5m0-2h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5m3 4h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5m0-2h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5m0-2h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5"}),"PointOfSale");const At=(o,i,l,m)=>{let y=o.html||o.text||"Esta acción no se puede revertir.";o.stockInfo!==void 0&&(y+=`<p>Stock Disponible: <strong>${o.stockInfo}</strong></p>`),mt.fire({title:o.title||"¿Estás seguro?",html:y,icon:o.icon||"warning",showCancelButton:!0,confirmButtonColor:i.palette.success.main,cancelButtonColor:i.palette.error.main,confirmButtonText:o.confirmButtonText||"Sí, continuar",cancelButtonText:o.cancelButtonText||"No, cancelar",background:i.palette.background.paper,color:i.palette.text.primary,reverseButtons:!0,customClass:{popup:"swal-higher-zindex"}}).then(q=>{q.isConfirmed?l&&l():q.dismiss===mt.DismissReason.cancel&&m&&m()})};var Bt={},Oo=ue;Object.defineProperty(Bt,"__esModule",{value:!0});var xn=Bt.default=void 0,Bo=Oo(pe()),Wo=e;xn=Bt.default=(0,Bo.default)((0,Wo.jsx)("path",{d:"M22 5v2h-3v3h-2V7h-3V5h3V2h2v3zm-3 14H5V5h6V3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6h-2zm-4-6v4h2v-4zm-4 4h2V9h-2zm-2 0v-6H7v6z"}),"Addchart");const Vo=({isPesableModalOpen:o,setIsPesableModalOpen:i,productToWeigh:l,weight:m,setWeight:y,weightInputRef:q,handleAddPesableProduct:$})=>{Ke();const u=()=>i(!1),b=v=>{v.key==="Enter"&&(v.preventDefault(),m&&parseFloat(m)>0&&$())},A=parseFloat(m),M=isNaN(A)?0:(A*1e3).toLocaleString("es-AR"),N=!isNaN(A)&&A>20,x=m?e.jsxs(P,{component:"span",variant:"caption",color:N?"warning.main":"text.secondary",children:["Equivale a: ",M," gramos ",N&&"(¡Valor muy alto!)"]}):"Ej: 0.500 para 500 gramos.";return e.jsxs(Je,{open:o,onClose:u,"aria-labelledby":"pesable-product-dialog-title",maxWidth:"xs",fullWidth:!0,children:[e.jsxs(Ye,{id:"pesable-product-dialog-title",sx:{backgroundColor:"background.dialog",color:"text.primary",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(F,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(xn,{sx:{mr:1,color:"info.main"}}),"Ingresar Peso"]}),e.jsx(K,{"aria-label":"close",onClick:u,sx:{color:"inherit"},children:e.jsx(Q,{})})]}),e.jsxs(Xe,{sx:{p:3,backgroundColor:"background.dialog",color:"text.primary"},children:[e.jsxs(P,{variant:"body1",sx:{mb:2,color:"text.secondary"},children:["Producto: ",e.jsx(P,{component:"span",variant:"body1",fontWeight:"bold",children:l==null?void 0:l.name}),(l==null?void 0:l.stock_id)&&e.jsxs(P,{component:"span",variant:"body2",sx:{ml:1,color:"text.secondary"},children:["(",l.quantity_in_base_units," unidades base)"]})]}),e.jsx(H,{label:"Peso",type:"number",name:"weight",value:m,onChange:v=>y(v.target.value),onKeyDown:b,inputRef:q,fullWidth:!0,autoFocus:!0,InputProps:{startAdornment:e.jsx(ae,{position:"start",children:e.jsx(K,{onClick:()=>y(""),children:e.jsx(Q,{color:"error"})})}),endAdornment:e.jsx(ae,{position:"end",children:"kg"})},autoComplete:"off",helperText:x,sx:{mb:1}})]}),e.jsxs(xt,{sx:{p:2,backgroundColor:"background.dialog",color:"text.primary",display:"flex",justifyContent:"space-between",gap:2},children:[e.jsx(J,{variant:"outlined",color:"error",onClick:u,startIcon:e.jsx(Q,{}),sx:{padding:"2px 12px",flex:1},children:"Cancelar"}),e.jsx(J,{variant:"contained",color:"primary",onClick:$,startIcon:e.jsx(qt,{}),disabled:!m||parseFloat(m)<=0,sx:{flex:1},children:"Agregar"})]})]})},Ho=({showPendingTickets:o,setShowPendingTickets:i,pendingTickets:l,handleLoadPendingTicket:m,handleDeletePendingTicket:y,allowLoading:q=!0})=>{Ke();const $=[{id:"name",label:"Nombre",align:"left",valueGetter:({row:u})=>u.name},{id:"customer",label:"Cliente",align:"center",valueGetter:({row:u})=>{var b;return((b=u.ticket_data.customer)==null?void 0:b.name)||"Consumidor Final"}},{id:"totalFinal",label:"Total",align:"center",valueGetter:({row:u})=>{var b;return`${(b=u.ticket_data.totalFinal)==null?void 0:b.toFixed(2)}`}},{id:"user",label:"Creado por",align:"center",valueGetter:({row:u})=>{var b;return((b=u.usuario)==null?void 0:b.nombre)||"N/A"}},{id:"date",label:"Fecha",align:"center",valueGetter:({row:u})=>Zn(u.createdAt).format("DD/MM/YYYY HH:mm")},{id:"actions",label:"Acciones",align:"center",valueGetter:({row:u})=>e.jsxs(F,{sx:{display:"flex",gap:1,justifyContent:"center"},children:[q&&e.jsx(J,{variant:"outlined",size:"small",onClick:()=>m(u),children:"Cargar"}),e.jsx(pt,{title:"Eliminar Ticket",children:e.jsx(K,{color:"error",size:"small",onClick:()=>y(u.id),children:e.jsx(Lt,{})})})]})}];return e.jsxs(Je,{open:o,onClose:()=>i(!1),"aria-labelledby":"pending-tickets-dialog-title",maxWidth:"md",fullWidth:!0,children:[e.jsxs(Ye,{id:"pending-tickets-dialog-title",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ne,{sx:{mr:1,color:"info.main"}}),"Tickets Pendientes (",l.length,")",e.jsx(K,{"aria-label":"close",onClick:()=>i(!1),sx:{position:"absolute",right:8,top:8,color:u=>u.palette.grey[500]},children:e.jsx(Q,{})})]}),e.jsx(Xe,{dividers:!0,children:l.length===0?e.jsxs(F,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:6,px:4,textAlign:"center"},children:[e.jsx(F,{sx:{width:"clamp(60px, 15vw, 80px)",height:"clamp(60px, 15vw, 80px)",borderRadius:"50%",bgcolor:"info.light",display:"flex",alignItems:"center",justifyContent:"center",mb:2},children:e.jsx(Ne,{sx:{fontSize:"clamp(30px, 8vw, 40px)",color:"info.main"}})}),e.jsx(P,{variant:"h6",color:"text.secondary",mb:1,children:"No hay tickets pendientes"}),e.jsx(P,{variant:"body2",color:"text.secondary",children:"Guarda una venta como pendiente para verla aquí."})]}):e.jsx(dn,{columns:$,data:l,pagination:!1})})]})};var Wt={},Qo=ue;Object.defineProperty(Wt,"__esModule",{value:!0});var Vt=Wt.default=void 0,Go=Qo(pe()),Uo=e;Vt=Wt.default=(0,Go.default)((0,Uo.jsx)("path",{d:"M14 10H3v2h11zm0-4H3v2h11zm4 8v-4h-2v4h-4v2h4v4h2v-4h4v-2zM3 16h7v-2H3z"}),"PlaylistAdd");const Ko=({isSummaryModalOpen:o,setIsSummaryModalOpen:i,tempTable:l,selectedCustomer:m,setSelectedCustomer:y,paymentOption:q,setPaymentOption:$,selectedSinglePaymentType:u,setSelectedSinglePaymentType:b,mixedPayments:A,setMixedPayments:M,ivaActivo:N,setIvaActivo:x,descuento:v,setDescuento:Ce,amountReceived:Se,setAmountReceived:we,handleSaveSale:Re,handleSavePendingTicket:Oe,setShowPendingTickets:Te,pendingTickets:ht,calcularTotal:O,validateMixedPayments:Ie,isConfirmButtonDisabled:gt,summaryError:yt,loadingSale:bt,paymentMethods:w,customers:vt,paymentLoading:Ze,customersLoading:j,amountReceivedInputRef:ye,inputRefCodigoBarra:Y,setCurrentTicketId:$e,setTempTable:Pe,setValues:Ae,setSelectedProduct:Be,confirmButtonRef:Fe})=>{var qe,_e;const _t=Ke(),{subtotal:be,impuesto:X,descuento:ve,totalFinal:me}=O(),te=()=>{i(!1),we("")},W=()=>{te(),setTimeout(()=>{ut(()=>{var C;Pe([]),Ae({}),Be(null),$e(null);const k=w==null?void 0:w.find(L=>{var R,G;return((R=L.method)==null?void 0:R.toLowerCase().includes("efectivo"))||((G=L.nombre)==null?void 0:G.toLowerCase().includes("efectivo"))});b(k||null),$("single"),M([{payment_method_id:null,amount:""},{payment_method_id:null,amount:""}]),y({id:1,name:"Consumidor Final"}),Ce(0),x(!1),localStorage.removeItem("tempTable"),we(""),(C=Y.current)==null||C.focus()},()=>{i(!0)},_t)},300)};return e.jsxs(Je,{open:o,onClose:te,"aria-labelledby":"summary-sale-dialog-title",maxWidth:"md",fullWidth:!0,children:[e.jsxs(Ye,{id:"summary-sale-dialog-title",sx:{display:"flex",alignItems:"center",backgroundColor:"background.dialog",color:"text.primary"},children:[e.jsx(Ne,{sx:{mr:1,color:"info.main"}}),"Resumen de la Venta",e.jsx(K,{"aria-label":"close",onClick:te,color:"error",sx:{position:"absolute",right:16,top:16},children:e.jsx(Q,{})})]}),e.jsxs(Xe,{sx:{p:0,backgroundColor:"background.paper"},children:[e.jsxs(F,{sx:{backgroundColor:"background.dialog",color:"text.primary",p:2},children:[yt&&e.jsx(Ft,{severity:"error",sx:{mb:1},children:yt}),e.jsxs(S,{container:!0,spacing:1,sx:{mt:0},children:[e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(ze,{value:m,onChange:(k,C)=>y(C),options:Array.isArray(vt)?vt:[],getOptionLabel:k=>k.name||k.nombre||"Sin nombre",isOptionEqualToValue:(k,C)=>k.id===C.id,loading:j,size:"small",renderInput:k=>e.jsx(H,{...k,label:"Cliente",variant:"outlined",size:"small",helperText:j?"Cargando clientes...":"",autoComplete:"off"})})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(ze,{value:q==="mixed"?{id:"mixed",method:"Mixto",nombre:"Mixto"}:u,onChange:(k,C)=>{C&&(C.method==="Mixto"||C.nombre==="Mixto")?($("mixed"),b(null)):($("single"),b(C),M([{payment_method_id:null,amount:""},{payment_method_id:null,amount:""}]))},options:Array.isArray(w)?[...w.filter(k=>k.method!=="Mixto"&&k.nombre!=="Mixto"),{id:"mixed",method:"Mixto",nombre:"Mixto"}]:[{id:"mixed",method:"Mixto",nombre:"Mixto"}],getOptionLabel:k=>k.method||k.nombre||"Sin método",isOptionEqualToValue:(k,C)=>k.id===C.id,loading:Ze,size:"small",renderInput:k=>e.jsx(H,{...k,label:"Método de Pago",variant:"outlined",size:"small",helperText:Ze?"Cargando métodos...":"",autoComplete:"off"})})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(uo,{control:e.jsx(jo,{checked:N,onChange:k=>x(k.target.checked),size:"small"}),label:"Aplicar IVA (21%)",componentsProps:{typography:{accessKey:void 0}}})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(H,{label:"Descuento",type:"number",value:v,onChange:k=>Ce(parseFloat(k.target.value)||0),InputProps:{startAdornment:e.jsx(ae,{position:"start",children:"$"})},size:"small",fullWidth:!0,autoComplete:"off"})})]}),e.jsx(ln,{sx:{my:1,borderColor:"rgba(255, 255, 255, 0.12)"}}),e.jsxs(S,{container:!0,spacing:1,children:[e.jsx(S,{item:!0,xs:6,children:e.jsx(P,{children:"Subtotal:"})}),e.jsx(S,{item:!0,xs:6,sx:{textAlign:"right"},children:e.jsxs(P,{children:["$",be.toFixed(2)]})}),N&&e.jsxs(e.Fragment,{children:[e.jsx(S,{item:!0,xs:6,children:e.jsx(P,{children:"IVA (21%):"})}),e.jsx(S,{item:!0,xs:6,sx:{textAlign:"right"},children:e.jsxs(P,{children:["$",X.toFixed(2)]})})]}),ve>0&&e.jsxs(e.Fragment,{children:[e.jsx(S,{item:!0,xs:6,children:e.jsx(P,{color:"error",children:"Descuento:"})}),e.jsx(S,{item:!0,xs:6,sx:{textAlign:"right"},children:e.jsxs(P,{color:"error",children:["-$",ve.toFixed(2)]})})]}),e.jsx(S,{item:!0,xs:12,children:e.jsx(ln,{sx:{my:0,borderColor:"rgba(255, 255, 255, 0.12)"}})}),e.jsx(S,{item:!0,xs:6,children:e.jsx(P,{variant:"h6",fontWeight:"bold",children:"Total:"})}),e.jsx(S,{item:!0,xs:6,sx:{textAlign:"right"},children:e.jsxs(P,{variant:"h6",fontWeight:"bold",children:["$",me.toFixed(2)]})})]})]}),e.jsx(F,{sx:{p:1},children:q==="single"?e.jsxs(S,{container:!0,spacing:1,sx:{mt:0,alignItems:"center"},children:[e.jsx(S,{item:!0,xs:12,sm:6,children:e.jsx(H,{label:"Monto Recibido",type:"number",value:Se,onChange:k=>we(parseFloat(k.target.value)||""),disabled:((qe=u==null?void 0:u.method)==null?void 0:qe.toLowerCase().includes("credito"))||((_e=u==null?void 0:u.nombre)==null?void 0:_e.toLowerCase().includes("credito")),InputProps:{startAdornment:e.jsx(ae,{position:"start",children:"$"})},size:"medium",fullWidth:!0,inputRef:ye,autoComplete:"off"})}),e.jsx(S,{item:!0,xs:12,sm:6,children:e.jsx(un,{sx:{p:1},children:e.jsxs(P,{variant:"h6",align:"center",sx:{fontWeight:"bold",color:"success.main"},children:["Cambio: $",Math.max(0,Se-me).toFixed(2)]})})})]}):e.jsxs(F,{sx:{mt:0},children:[e.jsx(P,{variant:"subtitle1",gutterBottom:!0,children:"Pagos Mixtos"}),e.jsx(S,{container:!0,spacing:1,children:A.map((k,C)=>e.jsxs(S,{item:!0,xs:12,sm:6,children:[e.jsx(ze,{value:k.payment_method_id?w==null?void 0:w.find(L=>L.id===k.payment_method_id):null,onChange:(L,R)=>{const G=[...A];G[C].payment_method_id=R?R.id:null,M(G)},options:Array.isArray(w)?w.filter(L=>L.id!==A[1-C].payment_method_id):[],getOptionLabel:L=>L.method||L.nombre||"",isOptionEqualToValue:(L,R)=>L.id===R.id,size:"small",renderInput:L=>e.jsx(H,{...L,label:`Método ${C+1}`,variant:"outlined",size:"small",autoComplete:"off"})}),e.jsx(H,{label:"Monto",type:"number",value:k.amount,onChange:L=>{const R=[...A];R[C].amount=parseFloat(L.target.value)||"",M(R)},InputProps:{startAdornment:e.jsx(ae,{position:"start",children:"$"})},size:"small",fullWidth:!0,sx:{mt:1},autoComplete:"off"})]},C))}),Ie()!==!0&&e.jsx(Ft,{severity:"error",sx:{mt:2},children:Ie()})]})})]}),e.jsx(xt,{children:e.jsxs(S,{container:!0,spacing:2,justifyContent:"center",children:[e.jsx(S,{item:!0,children:e.jsxs(F,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx(J,{variant:"contained",color:"success",onClick:Re,disabled:gt(),startIcon:bt?e.jsx(cn,{size:20}):e.jsx(qt,{}),ref:Fe,children:bt?"Guardando...":"Confirmar Venta"}),e.jsx(ct,{label:"Alt + V",size:"small",sx:{mt:.5}})]})}),e.jsx(S,{item:!0,children:e.jsxs(F,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx(J,{variant:"contained",color:"primary",onClick:Oe,disabled:l.length===0,startIcon:e.jsx(Vt,{}),children:"Guardar Pendiente"}),e.jsx(ct,{label:"Alt + P",size:"small",sx:{mt:.5}})]})}),e.jsx(S,{item:!0,children:e.jsxs(F,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsxs(J,{sx:{padding:"3px 12px"},variant:"outlined",color:"info",onClick:()=>Te(!0),startIcon:e.jsx(Ne,{}),children:["Tickets Pendientes (",ht.length,")"]}),e.jsx(ct,{label:"Alt + M",size:"small",sx:{mt:.5}})]})}),e.jsx(S,{item:!0,children:e.jsxs(F,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx(J,{variant:"contained",color:"error",onClick:W,startIcon:e.jsx(Q,{}),children:"Cancelar"}),e.jsx(ct,{label:"Alt + C",size:"small",sx:{mt:.5}})]})})]})})]})},Jo=({showManualEntryModal:o,handleCloseManualEntryModal:i,editingItem:l,formValues:m,handleInputChange:y,manualProductNameRef:q,showAdditionalManualFields:$,setShowAdditionalManualFields:u,categories:b,units:A,handleManualEntrySubmit:M})=>{const N=Ke();return e.jsxs(Je,{open:o,onClose:i,"aria-labelledby":"manual-entry-dialog-title",maxWidth:"sm",fullWidth:!0,children:[e.jsxs(Ye,{id:"manual-entry-dialog-title",sx:{backgroundColor:"background.dialog",color:"text.primary",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(F,{sx:{display:"flex",alignItems:"center"},children:[l?e.jsx(Dt,{sx:{mr:1,color:"info.main"}}):e.jsx(Vt,{sx:{mr:1,color:"info.main"}}),l?"Editar Producto":"Agregar Producto Manual"]}),e.jsx(K,{"aria-label":"close",onClick:i,sx:{color:"inherit"},children:e.jsx(Q,{})})]}),e.jsx(Xe,{sx:{p:3,backgroundColor:"background.dialog",color:"text.primary"},children:e.jsxs(S,{sx:{pt:1},container:!0,spacing:2,justifyContent:"center",children:[e.jsx(S,{item:!0,xs:12,children:e.jsx(H,{fullWidth:!0,size:"small",label:"Nombre del Producto *",name:"name",value:m.name||"",onChange:y,autoFocus:!0,required:!0,inputRef:q,autoComplete:"new-password",disabled:!!(l!=null&&l.stock_id),InputProps:{startAdornment:e.jsx(ae,{position:"start",children:e.jsx(K,{onClick:()=>y({target:{name:"name",value:""}}),children:e.jsx(Q,{color:"error"})})})}})}),e.jsx(S,{item:!0,xs:12,sm:6,children:e.jsx(H,{fullWidth:!0,size:"small",label:"Precio Unitario *",name:"price",type:"number",value:m.price||"",onChange:y,InputProps:{startAdornment:e.jsxs(ae,{position:"start",children:[e.jsx(K,{onClick:()=>y({target:{name:"price",value:""}}),children:e.jsx(Q,{color:"error"})}),"$"]})},required:!0,autoComplete:"off"})}),e.jsx(S,{item:!0,xs:12,sm:6,children:e.jsx(H,{fullWidth:!0,size:"small",label:"Cantidad *",name:"quantityPerUnits",type:"number",value:m.quantityPerUnits||"",onChange:y,required:!0,autoComplete:"off",InputProps:{startAdornment:e.jsx(ae,{position:"start",children:e.jsx(K,{onClick:()=>y({target:{name:"quantityPerUnits",value:""}}),children:e.jsx(Q,{color:"error"})})})}})}),(l||$)&&e.jsx(S,{item:!0,xs:12,children:e.jsx(H,{fullWidth:!0,size:"small",label:"Descripción",name:"description",value:m.description||"",onChange:y,multiline:!0,rows:2,autoComplete:"off",disabled:!!(l!=null&&l.stock_id),InputProps:{startAdornment:e.jsx(ae,{position:"start",children:e.jsx(K,{onClick:()=>y({target:{name:"description",value:""}}),children:e.jsx(Q,{color:"error"})})})}})}),(l||$)&&e.jsx(S,{item:!0,xs:12,sm:6,children:e.jsx(ze,{options:Array.isArray(b)?b:[],getOptionLabel:x=>x.name,onChange:(x,v)=>y({target:{name:"category_id",value:v==null?void 0:v.id}}),size:"small",renderInput:x=>e.jsx(H,{...x,label:"Categoría",variant:"outlined",size:"small",autoComplete:"off"}),disabled:!!(l!=null&&l.stock_id)})}),(l||$)&&e.jsx(S,{item:!0,xs:12,sm:6,children:e.jsx(ze,{options:Array.isArray(A)?A:[],getOptionLabel:x=>x.name,onChange:(x,v)=>y({target:{name:"units_id",value:v==null?void 0:v.id}}),size:"small",renderInput:x=>e.jsx(H,{...x,label:"Unidad",variant:"outlined",size:"small",autoComplete:"off"}),disabled:!!(l!=null&&l.stock_id)})}),!l&&e.jsx(S,{item:!0,xs:12,sx:{mt:2,alignSelf:"center"},children:e.jsx(J,{variant:"outlined",onClick:()=>u(x=>!x),children:$?"Menos Detalles":"Más Detalles"})}),m.price&&m.quantityPerUnits&&e.jsx(S,{item:!0,xs:12,children:e.jsx(un,{sx:{p:2,boxShadow:N.shadows[3]},children:e.jsxs(P,{variant:"h6",align:"center",sx:{fontWeight:"bold",color:"primary.main"},children:["💰 Total: $",((parseFloat(m.price)||0)*(parseFloat(m.quantityPerUnits)||0)).toFixed(2)]})})})]})}),e.jsxs(xt,{sx:{p:2,backgroundColor:"background.dialog",color:"text.primary"},children:[e.jsx(J,{variant:"outlined",color:"error",onClick:i,startIcon:e.jsx(Q,{}),sx:{padding:"2px 12px"},children:"Cancelar"}),e.jsx(J,{variant:"contained",color:"primary",onClick:M,startIcon:e.jsx(qt,{}),disabled:!m.name||!m.price||!m.quantityPerUnits,children:l?"Guardar Cambios":"Agregar Producto"})]})]})};var Ht={},Yo=ue;Object.defineProperty(Ht,"__esModule",{value:!0});var hn=Ht.default=void 0,Xo=Yo(pe()),Zo=e;hn=Ht.default=(0,Xo.default)((0,Zo.jsx)("path",{d:"m21.41 11.58-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42M5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7"}),"LocalOffer");const ea=({open:o,onClose:i,product:l,onSelectPresentation:m})=>{const[y,q]=d.useState(0),$=d.useRef(null);return d.useEffect(()=>{o&&q(0)},[o]),d.useEffect(()=>{if(!o||!(l!=null&&l.presentations))return;const u=b=>{const A=l.presentations.length;A!==0&&(b.key==="ArrowDown"?(b.preventDefault(),q(M=>(M+1)%A)):b.key==="ArrowUp"?(b.preventDefault(),q(M=>(M-1+A)%A)):b.key==="Enter"?(b.preventDefault(),y>=0&&y<A&&m(l.presentations[y])):b.key==="Escape"&&(b.preventDefault(),i()))};return window.addEventListener("keydown",u),()=>{window.removeEventListener("keydown",u)}},[o,y,l,m,i]),d.useEffect(()=>{if(o&&$.current){const u=$.current.children[y];u&&u.scrollIntoView({behavior:"smooth",block:"nearest"})}},[y,o]),l?e.jsxs(Je,{open:o,onClose:i,maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ye,{sx:{backgroundColor:"background.dialog",color:"text.primary",display:"flex",alignItems:"center",justifyContent:"space-between"},children:e.jsxs(de,{container:!0,sx:{display:"flex",alignItems:"center",justifyContent:"center",FlexDirection:"column"},children:[e.jsxs(de,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(hn,{sx:{mr:1,mb:0,color:"primary.main"}}),e.jsx(P,{variant:"h6",component:"span",fontWeight:"bold",sx:{ml:1},children:"Seleccionar Presentación para:"})]}),e.jsx(P,{component:"span",fontWeight:"bold",sx:{ml:1},children:l.name})]})}),e.jsx(Xe,{sx:{p:3,backgroundColor:"background.dialog",color:"text.primary"},children:e.jsx(eo,{ref:$,children:l.presentations.map((u,b)=>e.jsx(po,{disablePadding:!0,children:e.jsx(fo,{onClick:()=>m(u),selected:y===b,children:e.jsx(mo,{primary:u.name,secondary:u.price?`Precio: ${parseFloat(u.price).toFixed(2)}`:null})})},u.id||b))})}),e.jsx(xt,{sx:{p:2,backgroundColor:"background.dialog"},children:e.jsx(J,{sx:{padding:"2px 12px"},variant:"outlined",color:"error",onClick:i,startIcon:e.jsx(Q,{}),children:"Cancelar"})})]}):null},ta=(o,i)=>{const l=o.map(m=>({...m,cost:m.original_cost!==void 0?m.original_cost:m.cost,original_cost:m.original_cost!==void 0?m.original_cost:m.cost,promotion:null}));return!i||i.length===0?o.map(({original_cost:m,...y})=>y):(i.forEach(m=>{const y=new Set;m.stocks&&m.stocks.forEach(u=>y.add(u.id)),m.presentations&&m.presentations.forEach(u=>y.add(u.id));let q=0;const $=m.required_quantity;!$||$<=0||l.forEach(u=>{const b=u.presentation_id||u.stock_id;if(!y.has(b))return;const A=parseFloat(u.original_cost),M=parseInt(u.quantity,10);if(isNaN(A)||isNaN(M)||M<=0)return;const N=A/M;let x=0;for(let v=0;v<u.quantity;v++)q++,q%$===0?m.type==="BOGO"||(m.type==="PERCENT_DISCOUNT_ON_NTH"?x+=N*(1-parseFloat(m.discount_value)/100):m.type==="FIXED_PRICE_ON_NTH"?x+=parseFloat(m.discount_value):x+=N):x+=N;!isNaN(x)&&x<u.cost&&(u.cost=x,u.promotion=m)})}),l.map(({original_cost:m,...y})=>y))},za=()=>{const o=Ke(),{usuario:i}=d.useContext(to),{data:l,isLoading:m,isError:y,refetch:q}=no(["activeCashSession",i==null?void 0:i.id],`/cash-sessions/active/${i==null?void 0:i.id}`,!!(i!=null&&i.id)),$=(l==null?void 0:l.hasActiveSession)||!1,u=(l==null?void 0:l.session)||null,[b,A]=d.useState(!1),M=()=>{A(!0)},N=()=>{A(!1),q()};d.useEffect(()=>{y&&E("No se pudo verificar el estado de la caja. Intente recargar la página.",o)},[y]);const[x,v]=d.useState(()=>{const t=localStorage.getItem("tempTable");return t?JSON.parse(t):[]}),[Ce,Se]=d.useState(!1),[we,Re]=d.useState(null),[Oe,Te]=d.useState(!1),[ht,O]=d.useState(null),[Ie,gt,yt,bt,w]=on({}),[vt,Ze]=d.useState(0),[j,ye]=d.useState(null),[Y,$e]=d.useState({id:1,name:"Consumidor Final"}),[Pe,Ae]=d.useState(!1),[Be,Fe]=d.useState(0),[_t,be]=d.useState(""),[X,ve]=d.useState(!1),[me,te]=d.useState(!1),[W,qe]=d.useState(null),[_e,k]=d.useState(null),[C,L]=d.useState(!1),[R,G]=d.useState(""),[et,je]=d.useState(null),[We,fe]=d.useState(!1),[Qt,Ve]=d.useState("full"),[ne,se]=d.useState(!1),[xe,Me]=d.useState(""),[gn,tt]=d.useState(""),[jt,Gt]=d.useState(null),[yn,bn]=d.useState(!1),[ee,nt]=d.useState("single"),[Le,ot]=d.useState([{payment_method_id:null,amount:""},{payment_method_id:null,amount:""}]),[He,re]=d.useState(!1),[oe,ke]=d.useState(null),[at,he]=d.useState(""),[Qe,ie]=d.useState(null),vn=d.useCallback(()=>{Se(!1),Re(null),ie(null),L(!1),G(""),setTimeout(()=>{var t;return(t=T.current)==null?void 0:t.focus()},100)},[]),T=d.useRef(null),kt=d.useRef(null),Ct=d.useRef(null),Ut=d.useRef(null),Kt=d.useRef(null),St=d.useRef(null),{data:D,refetch:_n,isLoading:na}=ge("stock","/stock"),{data:jn,isLoading:oa}=ge("categories","/category",!!i,0,{staleTime:1e3*60*60}),{data:kn,isLoading:aa}=ge("units","/units",!!i,0,{staleTime:1e3*60*60}),{data:z,isLoading:Cn}=ge("payment","/payment",!!i,0,{staleTime:1e3*60*60}),{data:Sn,isLoading:wn}=ge("customers","/customers",!!i,0,{staleTime:1e3*60*60}),{data:wt=[],refetch:Tt,isLoading:sa}=ge("pendingTickets","/pending-tickets"),{data:Jt,isLoading:ra}=ge("promotions","/promotions?is_active=true"),{data:st,isLoading:ia}=ge("combos","/combos?is_active=true"),[Yt,Tn,la,ca,Ge]=on(),{mutateAsync:In,isLoading:It}=an(),{mutateAsync:$n,isLoading:da}=an(),{mutateAsync:Xt,isLoading:ua}=io(),rt=d.useMemo(()=>ta(x,Jt),[x,Jt]),Ee=d.useCallback(()=>{let t=0;rt.forEach(r=>{t+=parseFloat(r.cost||0)});const n=Pe?t*.21:0,a=Be||0,p=t+n-a;return{subtotal:t,impuesto:n,descuento:a,totalFinal:p}},[rt,Pe,Be]),{subtotal:pa,impuesto:ma,descuento:fa,totalFinal:Z}=d.useMemo(()=>Ee(),[Ee]),it=d.useCallback(()=>{var s,h,c,_;const[t,n]=Le,a=Le.reduce((f,g)=>f+parseFloat(g.amount||0),0);if(!t.payment_method_id||!n.payment_method_id)return"Debe seleccionar ambos métodos de pago para el pago mixto.";if(t.payment_method_id===n.payment_method_id)return"Los métodos de pago mixtos no pueden ser iguales.";const p=((h=(s=z==null?void 0:z.find(f=>f.id===t.payment_method_id))==null?void 0:s.method)==null?void 0:h.toLowerCase())||"",r=((_=(c=z==null?void 0:z.find(f=>f.id===n.payment_method_id))==null?void 0:c.method)==null?void 0:_.toLowerCase())||"";if((p.includes("credito")||r.includes("credito"))&&Y.id===1)return"No se puede otorgar crédito al Consumidor Final. Por favor, seleccione otro cliente o método de pago.";if(Math.abs(a-Z)>.01){const f=Z-a;let g="La suma de los montos no coincide.";return f>0?g+=` Faltan $ ${f.toFixed(2)} para completar el total.`:g+=` Hay un excedente de $ ${(-f).toFixed(2)}.`,g}return!0},[Le,Z,z,Y]),Zt=async()=>{var n,a,p,r,s;if(x.length===0){E("No hay productos en la venta");return}if(ee==="single"&&((n=j==null?void 0:j.method)!=null&&n.toLowerCase().includes("credito")||(a=j==null?void 0:j.nombre)!=null&&a.toLowerCase().includes("credito"))&&Y.id===1){tt("No se puede otorgar crédito al Consumidor Final. Por favor, seleccione otro cliente.");return}let t=[];if(ee==="single"){if(!j){E("Debe seleccionar un método de pago.",o);return}const h=((p=j.method)==null?void 0:p.toLowerCase().includes("credito"))||((r=j.nombre)==null?void 0:r.toLowerCase().includes("credito"));if(!h&&xe!==""&&xe<Z){E("El monto recibido es insuficiente.",o);return}t.push({payment_method_id:j.id,amount:h?Z:xe!==""?xe:Z})}else{const h=it();if(h!==!0){E(h,o);return}t=Le.filter(c=>c.payment_method_id!==null&&c.amount>0)}try{const{subtotal:h,descuento:c,totalFinal:_}=Ee(),f=i==null?void 0:i.id;if(!f){E("No se pudo identificar al usuario. Por favor, inicie sesión de nuevo.",o);return}const g={total_amount:h,promotion_discount:c,total_neto:_,customer_id:Y.id,user_id:f,payments:t,tempValues:rt.map(I=>{var B;return{id:I.id,stock_id:I.stock_id,presentation_id:I.presentation_id||null,promotion_id:((B=I.promotion)==null?void 0:B.id)||null,quantity:I.quantity_for_stock_deduction||I.quantity,price:I.price,final_price:I.cost,force_sale:I.force_sale||!1,is_manual_entry:I.is_manual_entry||!1,type:I.type}})},U=await In({url:"/sales",values:g,showSuccessAlert:!1});if(U&&U.id){if(et)try{await Xt({url:`/pending-tickets/${et}`}),Tt()}catch(B){console.error("Error al eliminar el ticket pendiente después de la venta:",B),E("La venta se completó, pero no se pudo eliminar el ticket pendiente.",o)}v([]),w({}),O(null),je(null),se(!1),Me("");const I=z==null?void 0:z.find(B=>{var le,ce;return((le=B.method)==null?void 0:le.toLowerCase().includes("efectivo"))||((ce=B.nombre)==null?void 0:ce.toLowerCase().includes("efectivo"))});ye(I||null),nt("single"),ot([{payment_method_id:null,amount:""},{payment_method_id:null,amount:""}]),$e({id:1,name:"Consumidor Final"}),Fe(0),Ae(!1),localStorage.removeItem("tempTable"),_n(),Gt(U.id)}else E("Error al guardar la venta: No se recibió un ID de venta válido.",o)}catch(h){console.error("Error al guardar la venta:",h),h.response&&h.response.status===403?E(h.response.data.message||"No tienes permiso o una caja activa para realizar esta acción.",o):E("Error al guardar la venta: "+(h.message||"Error desconocido"),o),(s=T.current)==null||s.focus()}},$t=async()=>{if(x.length===0){E("No hay productos en la venta",o);return}se(!1);const{value:t}=await mt.fire({title:"Guardar Ticket Pendiente",input:"text",inputLabel:"Por favor, ingrese un nombre para el ticket pendiente (ej: Pedido de Ana):",inputValue:"",showCancelButton:!0,confirmButtonText:"Guardar",cancelButtonText:"Cancelar",inputValidator:n=>{if(!n)return"¡Necesitas escribir algo!"},background:o.palette.background.paper,color:o.palette.text.primary,customClass:{popup:"swal-higher-zindex"},didOpen:()=>{const n=mt.getPopup().querySelector(".swal2-input-label");n&&(n.style.marginLeft="20px",n.style.textAlign="left")}});if(t===void 0){se(!0),Ue("La operación ha sido cancelada.",o);return}if(t.trim()===""){Ue("La operación ha sido cancelada.",o);return}try{const{subtotal:n,impuesto:a,descuento:p,totalFinal:r}=Ee(),s={tempTable:[...x],customer:Y,paymentType:j,paymentOption:ee,mixedPayments:Le,subtotal:n,impuesto:a,descuento:p,totalFinal:r,ivaActivo:Pe},h={name:t.trim(),ticket_data:s,user_id:i==null?void 0:i.id,cash_session_id:u==null?void 0:u.id};await $n({url:"/pending-tickets",values:h,showSuccessAlert:!0,successMessage:"Ticket guardado correctamente"}),v([]),w({}),O(null),je(null),localStorage.removeItem("tempTable"),se(!1),Tt(),setTimeout(()=>{var c;return(c=T.current)==null?void 0:c.focus()},100)}catch(n){console.error("Error al guardar ticket pendiente:",n),E("Error al guardar el ticket pendiente: "+(n.message||"Error desconocido"),o)}};d.useEffect(()=>{localStorage.setItem("tempTable",JSON.stringify(x)),Ze(Ee().totalFinal)},[x]),d.useEffect(()=>{const t=()=>{if(!st||st.length===0||!x)return;let a=JSON.parse(JSON.stringify(x)),p,r=!1;do{p=!1;for(const s of st){const c=a.filter(f=>f.type==="product"||!f.type).reduce((f,g)=>(f[g.stock_id]=(f[g.stock_id]||0)+g.quantity,f),{});if(s.combo_items.every(f=>(c[f.stock_id]||0)>=f.quantity)){r=!0,p=!0;for(const g of s.combo_items){let U=g.quantity;a=a.map(I=>{if((I.type==="product"||!I.type)&&I.stock_id===g.stock_id&&U>0){const B=Math.min(I.quantity,U);I.quantity-=B,I.cost=I.quantity*parseFloat(I.price),U-=B}return I}).filter(I=>I.quantity>0)}const f=a.find(g=>g.type==="combo"&&g.id===s.id);f?(f.quantity+=1,f.cost=f.quantity*parseFloat(s.price)):a.unshift({temp_id:Date.now()+Math.random(),id:s.id,name:s.name,price:s.price,quantity:1,cost:parseFloat(s.price),type:"combo",description:s.combo_items.map(g=>{const U=parseFloat(g.quantity);return`${U%1===0?U:U.toFixed(3)}x ${g.stock.name}`}).join(", ")});break}}}while(p);r&&v(s=>JSON.stringify(s)!==JSON.stringify(a)?a:s)},n=setTimeout(()=>{t()},500);return()=>clearTimeout(n)},[x,st]);const en=d.useCallback(()=>It||x.length===0?!0:ee==="single"?j?(j.method||j.nombre||"").toLowerCase().includes("credito")?!1:xe===""||parseFloat(xe)<Z:!0:it()!==!0,[It,x.length,ee,j,xe,Z,it]);d.useEffect(()=>{const t=n=>{var r,s;if(!n.key)return;const a=n.key.toLowerCase();if(n.altKey&&a==="m")return n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),ne&&(Ve("infoOnly"),fe(!0)),!1;if(ne){if(n.altKey&&a==="v"){n.preventDefault(),St.current&&St.current.click();return}if(n.altKey&&a==="p"){n.preventDefault(),$t();return}if(n.altKey&&a==="c"){n.preventDefault(),se(!1),setTimeout(()=>{ut(()=>{var c;v([]),w({}),O(null),je(null);const h=z==null?void 0:z.find(_=>{var f,g;return((f=_.method)==null?void 0:f.toLowerCase().includes("efectivo"))||((g=_.nombre)==null?void 0:g.toLowerCase().includes("efectivo"))});ye(h||null),nt("single"),ot([{payment_method_id:null,amount:""},{payment_method_id:null,amount:""}]),$e({id:1,name:"Consumidor Final"}),Fe(0),Ae(!1),localStorage.removeItem("tempTable"),Me(""),(c=T.current)==null||c.focus()},()=>{se(!0)},o)},300);return}if(n.altKey&&a==="t"){n.preventDefault(),console.log("Alt+T presionado dentro de SummarySaleModal."),console.log("Antes de setPendingTicketsModalMode y setShowPendingTickets."),Ve("infoOnly"),fe(!0),console.log("Después de setPendingTicketsModalMode y setShowPendingTickets.");return}if(n.altKey&&a==="t"){n.preventDefault(),Ve("infoOnly"),fe(!0);return}}const p=b||me||We||He||ne||Ce;if(n.altKey&&a==="f"){n.preventDefault(),x.length>0?se(!0):E("No hay productos en la venta para finalizar.",o);return}p||(n.altKey&&a==="b"&&(n.preventDefault(),(r=kt.current)==null||r.focus()),n.altKey&&a==="x"&&(n.preventDefault(),te(!0),Ge({}),O(null)),n.altKey&&a==="c"&&(n.preventDefault(),L(!0),G(""),w(h=>({...h,barcode:""})),(s=T.current)==null||s.focus()))};return document.addEventListener("keydown",t,{capture:!0,passive:!1}),()=>{document.removeEventListener("keydown",t,{capture:!0,passive:!1})}},[x,b,me,We,He,ne,Ce,Zt,$t,Z,z,Y,en]),d.useEffect(()=>{if(He){const t=setTimeout(()=>{var n;(n=Ut.current)==null||n.focus()},100);return()=>clearTimeout(t)}},[He]),d.useEffect(()=>{if(ne&&ee==="single"){const t=((j==null?void 0:j.method)||(j==null?void 0:j.nombre)||"").toLowerCase();if(t.includes("credito"))Me("0");else if(t.includes("efectivo")){Me("");const n=setTimeout(()=>{Ct.current&&Ct.current.focus()},100);return()=>clearTimeout(n)}else j&&Me(Z.toFixed(2))}},[j,Z,ne,ee]),d.useEffect(()=>{if(me){const t=setTimeout(()=>{var n;(n=Kt.current)==null||n.focus()},100);return()=>clearTimeout(t)}},[me]),d.useEffect(()=>{!We&&T.current&&T.current.focus()},[We]),d.useEffect(()=>{if(z&&Array.isArray(z)&&z.length>0&&!j&&ee==="single"){const t=z.find(n=>{var a,p;return((a=n.method)==null?void 0:a.toLowerCase().includes("efectivo"))||((p=n.nombre)==null?void 0:p.toLowerCase().includes("efectivo"))});t&&ye(t)}},[z]),d.useEffect(()=>{jt&&sn(`Venta #${jt} registrada correctamente`,o).then(()=>{setTimeout(()=>{var t;(t=T.current)==null||t.focus()},100),Gt(null)})},[jt]),d.useEffect(()=>{ne&&ee==="single"&&((j==null?void 0:j.method)||(j==null?void 0:j.nombre)||"").toLowerCase().includes("credito")&&(Y==null?void 0:Y.id)===1?tt("No se puede otorgar crédito al Consumidor Final. Por favor, seleccione un cliente válido."):tt("")},[ne,ee,j,Y]);const Pn=t=>{const n=()=>{setTimeout(()=>{var r;ne||(r=T.current)==null||r.focus()},100)};ut(()=>{v(r=>r.filter(s=>s.temp_id!==t)),je(null),n()},()=>{n()},o)},An=t=>{const n=t.presentation_id!==void 0&&t.presentation_id!==null;let a=t.price,p=t.quantity;n&&(a=t.price/t.quantity),Ge({stock_id:t.stock_id,name:t.name,description:t.description,price:a,quantity:p,category_id:t.category_id,units_id:t.units_id,cost:t.cost})},Fn=t=>{const n=x.find(p=>p.temp_id===t);if(!n)return;const a=x.findIndex(p=>p.temp_id===t);An(n),O(n),qe(n),k(a),te(!0),v(p=>p.filter(r=>r.temp_id!==t))},Pt=(t,n=!1)=>{v(a=>{let p;return W&&_e!==null?(p=[...a],p.splice(_e,0,{...t,force_sale:n})):p=[{...t,force_sale:n},...a],p}),qe(null),k(null),Ge({}),O(null),te(!1),L(!1),G(""),Te(!1),w(a=>({...a,barcode:""})),setTimeout(()=>{var a;(a=T.current)==null||a.focus()},100)},qn=()=>{var f,g,U,I;const{quantityPerUnits:t,price:n,name:a,description:p,category_id:r,units_id:s,stock_id:h}=Yt;if(!a||!n||!t){E("Por favor complete los campos obligatorios: Nombre, Precio y Cantidad",o);return}let c={temp_id:(W==null?void 0:W.temp_id)||Date.now()+Math.random(),stock_id:h||null,presentation_id:(W==null?void 0:W.presentation_id)||null,quantity:parseFloat(t)||1,name:a.trim(),description:(p==null?void 0:p.trim())||(W?W.description:"Producto manual"),category_id:r||null,units_id:s||null,is_manual_entry:!h};if(c.presentation_id!==void 0&&c.presentation_id!==null){c.price=parseFloat(n)||0,c.cost=c.quantity*c.price;const B=(U=(g=(f=D==null?void 0:D.products)==null?void 0:f.find(le=>le.id===c.stock_id))==null?void 0:g.presentations)==null?void 0:U.find(le=>le.id===c.presentation_id);B?c.quantity_for_stock_deduction=c.quantity*B.quantity_in_base_units:c.quantity_for_stock_deduction=c.quantity}else c.price=parseFloat(n)||0,c.cost=c.quantity*c.price,c.quantity_for_stock_deduction=c.quantity;if(c.stock_id){const B=(I=D==null?void 0:D.products)==null?void 0:I.find(ce=>ce.id===c.stock_id),le=B?B.stock:0;le<c.quantity_for_stock_deduction?(te(!1),setTimeout(()=>{At({title:"Stock Insuficiente",html:`
              <p>Producto: <strong>${c.name}</strong></p>
              <p>Cantidad Solicitada: <strong>${c.quantity_for_stock_deduction}</strong></p>
              <br/>
              <p>¿Desea continuar la venta y dejar el stock en negativo?</p>
            `,stockInfo:le,icon:"warning",confirmButtonText:"Sí, continuar",cancelButtonText:"No, cancelar"},o,()=>{Pt(c,!0)},()=>{te(!0),Ge(W),w(ce=>({...ce,barcode:""})),setTimeout(()=>{var ce;(ce=T.current)==null||ce.focus()},100)})},300)):Pt(c,!1)}else Pt(c,!1)},Mn=()=>{W&&_e!==null&&v(t=>{const n=[...t];return n.splice(_e,0,W),n}),te(!1),Ge({}),O(null),qe(null),k(null),Te(!1),w(t=>({...t,barcode:""})),setTimeout(()=>{var t;(t=T.current)==null||t.focus()},100)},Ln=t=>{const n=t.ticket_data;v(n.tempTable),$e(n.customer),ye(n.paymentType),nt(n.paymentOption||"single"),ot(n.mixedPayments||[{payment_method_id:null,amount:""},{payment_method_id:null,amount:""}]),Ae(n.ivaActivo),Fe(n.descuento),je(t.id),fe(!1),localStorage.setItem("tempTable",JSON.stringify(n.tempTable))},En=t=>{ut(async()=>{try{await Xt({url:`/pending-tickets/${t}`}),et===t&&(v([]),w({}),O(null),je(null),localStorage.removeItem("tempTable")),sn("El ticket pendiente ha sido eliminado.",o),Tt(),fe(!1),setTimeout(()=>{var n;return(n=T.current)==null?void 0:n.focus()},100)}catch(n){console.error("Error al eliminar ticket:",n),E("No se pudo eliminar el ticket.",o)}},()=>{},o)},Dn=t=>{const n=we;if(!n){E("Error: Producto base no encontrado.",o);return}if(t.id==="base_product_sale")t.tipo_venta==="pesable"?(ke(n),re(!0),he("")):lt(n,Qe||1);else{const a=n.presentations.find(p=>p.id===t.id);if(!a){E("Error: Datos de la presentación no encontrados.",o);return}if(n.tipo_venta==="pesable"){const p={...a,stock_id:n.id};ke(p),re(!0),he("")}else{const p=Qe||1,r=a.price,s=p*r,h=p*a.quantity_in_base_units,c=x.findIndex(_=>_.stock_id===n.id&&_.presentation_id===a.id);if(c!==-1)v(_=>{const f=[..._],g={...f[c]};return g.quantity+=p,g.cost+=s,g.quantity_for_stock_deduction+=h,f[c]=g,f});else{const _={temp_id:Date.now()+Math.random(),stock_id:n.id,presentation_id:a.id,quantity:p,price:r,name:`${n.name} (${a.name})`,description:n.description,category_id:n.category_id,units_id:n.units_id,cost:s,force_sale:!1,is_manual_entry:!1,quantity_for_stock_deduction:h,type:"presentation"};v(f=>[_,...f])}}}Se(!1),Re(null),ie(null),L(!1),G(""),setTimeout(()=>{var a;(a=T.current)==null||a.focus()},100)},lt=(t,n)=>{var c;const a=x.find(_=>_.stock_id===t.id),r=(a?a.quantity:0)+n,s=(c=D==null?void 0:D.products)==null?void 0:c.find(_=>_.id===t.id),h=s?s.stock:0;h<r?At({title:"Stock Insuficiente",html:`
          <p>Producto: <strong>${t.name}</strong></p>
          <p>Stock Disponible: <strong>${h}</strong></p>
          <p>Stock Solicitado: <strong>${r}</strong></p>
          <br/>
          <p>¿Desea continuar la venta y dejar el stock en negativo?</p>
        `,icon:"warning",confirmButtonText:"Sí, continuar",cancelButtonText:"No, cancelar"},o,()=>{tn(t,n,!0)}):tn(t,n,!1)},tn=(t,n,a=!1)=>{const p=x.findIndex(r=>r.stock_id===t.id&&r.type==="product");if(p!==-1)v(r=>{const s=[...r],h={...s[p]};return h.quantity+=n,h.cost=h.quantity*parseFloat(h.price),h.quantity_for_stock_deduction=h.quantity,a&&(h.force_sale=!0),s[p]=h,s});else{const r={temp_id:Date.now()+Math.random(),stock_id:t.id,quantity:n,price:t.price,name:t.name,description:t.description,category_id:t.category_id,units_id:t.units_id,cost:n*parseFloat(t.price),force_sale:a,quantity_for_stock_deduction:n,type:"product"};v(s=>[r,...s])}O(null),L(!1),G(""),setTimeout(()=>{var r;(r=T.current)==null||r.focus()},100)},zn=()=>{var r;if(!oe||!at||parseFloat(at)<=0){E("Por favor, ingrese un peso válido.",o);return}const t=parseFloat(at);let n,a;if(oe.stock_id){if(a=(r=D==null?void 0:D.products)==null?void 0:r.find(c=>c.id===oe.stock_id),!a){E("Error: Producto base no encontrado para la presentación pesable.",o);return}const s=oe.price/oe.quantity_in_base_units,h=t*s;n={temp_id:Date.now()+Math.random(),stock_id:oe.stock_id,presentation_id:oe.id,quantity:t,price:s,name:`${a.name} (${oe.name})`,description:a.description,category_id:a.category_id,units_id:a.units_id,cost:h,force_sale:!1,is_manual_entry:!1,quantity_for_stock_deduction:t,type:"presentation"}}else{a=oe;const s=t*a.price;n={temp_id:Date.now()+Math.random(),stock_id:a.id,quantity:t,price:a.price,name:a.name,description:a.description,category_id:a.category_id,units_id:a.units_id,cost:s,force_sale:!1,is_manual_entry:!1,quantity_for_stock_deduction:t,type:"product"}}const p=a?a.stock:0;p<n.quantity_for_stock_deduction?(re(!1),setTimeout(()=>{At({title:"Stock Insuficiente",html:`
              <p>Producto: <strong>${n.name}</strong></p>
              <p>Stock Disponible: <strong>${p}</strong></p>
              <p>Cantidad Solicitada: <strong>${n.quantity_for_stock_deduction}</strong></p>
              <br/>
              <p>¿Desea continuar la venta y dejar el stock en negativo?</p>
            `,icon:"warning",confirmButtonText:"Sí, continuar",cancelButtonText:"No, corregir"},o,()=>{v(s=>[{...n,force_sale:!0},...s]),ke(null),he(""),ie(null),w(s=>({...s,barcode:""})),setTimeout(()=>{var s;return(s=T.current)==null?void 0:s.focus()},100)},()=>{re(!0)})},300)):(v(s=>[n,...s]),re(!1),ke(null),he(""),ie(null),w(s=>({...s,barcode:""})),setTimeout(()=>{var s;(s=T.current)==null||s.focus()},100))},Nn=t=>{var a;const n=parseFloat(t);return!isNaN(n)&&n>0?(ie(n),G(t),w(p=>({...p,barcode:""})),(a=T.current)==null||a.focus(),!0):(E("Ingrese una cantidad válida para la cantidad personalizada.",o),!1)},Rn=t=>{const n=parseFloat(t);return!isNaN(n)&&n>0?(ie(n),ve(!1),be(""),!0):(E("Ingrese una cantidad válida.",o),!1)},On=async t=>{var n,a,p;if(!ro.isNumeric(t)||t.length!==13){E("Código de barras inválido. Debe ser numérico y de 13 dígitos.",o),w(r=>({...r,barcode:""})),(n=T.current)==null||n.focus();return}try{const{data:r}=await so.get(`/stock/barcode/${t}`);if(!r){Ue('Producto o combo no encontrado. Presione "Alt+x" para ingresar manualmente',o),Te(!0),w({}),O(null),(a=T.current)==null||a.focus();return}const s=Qe||1;if(r.type==="combo"){const h=x.findIndex(c=>c.id===r.id&&c.type==="combo");if(h!==-1)v(c=>{const _=[...c],f={..._[h]};return f.quantity+=s,f.cost=f.quantity*parseFloat(f.price),_[h]=f,_});else{const c={temp_id:Date.now()+Math.random(),id:r.id,name:r.name,price:r.price,quantity:s,cost:s*parseFloat(r.price),type:"combo",description:r.combo_items.map(_=>{const f=parseFloat(_.quantity);return`${f%1===0?f:f.toFixed(3)}x ${_.stock.name}`}).join(", ")};v(_=>[c,..._])}}else if(r.type==="presentation")if(r.stock&&r.stock.tipo_venta==="pesable")ke(r),re(!0),he("");else{const h=s*r.quantity_in_base_units,c=x.findIndex(_=>_.presentation_id===r.id);if(c!==-1)v(_=>{const f=[..._],g={...f[c]};return g.quantity+=s,g.cost+=s*parseFloat(r.price),g.quantity_for_stock_deduction+=h,f[c]=g,f});else{const _={temp_id:Date.now()+Math.random(),stock_id:r.stock_id,presentation_id:r.id,quantity:s,price:r.price,name:`${r.stock.name} (${r.name})`,description:r.stock.description,category_id:r.stock.category_id,units_id:r.stock.units_id,cost:s*parseFloat(r.price),force_sale:!1,is_manual_entry:!1,quantity_for_stock_deduction:h,type:"presentation"};v(f=>[_,...f])}}else r.type==="product"&&(r.tipo_venta==="pesable"?(ke(r),re(!0),he("")):lt(r,s));ie(null),w(h=>({...h,barcode:""})),L(!1),G(""),T.current.focus()}catch(r){r.response&&r.response.status===404?(Ue('Producto o combo no encontrado. Presione "Alt+x" para ingresar manualmente',o),Te(!0),w({}),O(null)):(E("Error al buscar el producto.",o),console.error(r)),(p=T.current)==null||p.focus()}},Bn=async t=>{const n=t.target.value.trim();if(t.key==="Enter"&&n===""){t.preventDefault();return}t.key==="Enter"?(t.preventDefault(),C&&!R?Nn(n):X?Rn(n):Oe||On(n)):t.key==="q"||t.key==="Q"?(t.preventDefault(),ve(!0),be(""),Ue("Modo Cantidad Rápida. Ingrese la cantidad y presione Enter.",o)):X&&(t.key==="Escape"?(ve(!1),be("")):(!isNaN(parseFloat(t.key))||t.key===".")&&be(a=>a+t.key))},Wn=d.useMemo(()=>[{id:"name",label:"Producto",align:"left",valueGetter:({row:t})=>e.jsxs(F,{children:[e.jsx(P,{children:t.name}),t.promotion&&e.jsx(P,{variant:"caption",color:"success.main",children:t.promotion.name})]})},{id:"description",label:"Descripción",align:"left",valueGetter:({row:t})=>t.description},{id:"quantity",label:"Cantidad",align:"center",valueGetter:({row:t})=>{const n=parseFloat(t.quantity);return isNaN(n)?"":n%1===0?n:n.toFixed(3)}},{id:"price",label:"Precio Unitario",align:"center",valueGetter:({row:t})=>`${parseFloat(t.price).toFixed(2)}`},{id:"cost",label:"Costo Total",align:"center",valueGetter:({row:t})=>`${parseFloat(t.cost).toFixed(2)}`},{id:"actions",label:"Acciones",align:"center",valueGetter:({row:t})=>e.jsxs(F,{sx:{display:"flex",gap:1,justifyContent:"center"},children:[e.jsx(pt,{title:"Editar",children:e.jsx(K,{color:"primary",size:"small",onClick:()=>Fn(t.temp_id),children:e.jsx(Dt,{})})}),e.jsx(pt,{title:"Eliminar",children:e.jsx(K,{color:"error",size:"small",onClick:()=>Pn(t.temp_id),children:e.jsx(Lt,{})})})]})}],[x]),Vn=d.useCallback((t,n,a,p)=>{var _,f;if(t&&t.type==="keydown"&&t.key==="Enter"&&(t.preventDefault(),t.stopPropagation(),(_=kt.current)==null||_.blur()),a!=="selectOption"||!p||!p.option){w({}),O(null),setTimeout(()=>{var g;(g=T.current)==null||g.focus()},100);return}const r=p.option.id,s=(f=D==null?void 0:D.products)==null?void 0:f.find(g=>g.id===r);if(!s){E("Error: No se pudo encontrar el producto seleccionado.",o),setTimeout(()=>{var g;(g=T.current)==null||g.focus()},100);return}const h=s.presentations&&s.presentations.length>0;let c=!1;if(h){const g={id:"base_product_sale",name:s.tipo_venta==="pesable"?`Vender por Peso (Minorista a ${s.price}/kg)`:`Vender por Unidad (a ${s.price})`,price:s.price,quantity_in_base_units:1,tipo_venta:s.tipo_venta};Re({...s,presentations:[g,...s.presentations]}),Se(!0),c=!0}else s.tipo_venta==="pesable"?(ke(s),re(!0),he(""),c=!0):(lt(s,Qe||1),ie(null));O(null),w({}),c||setTimeout(()=>{var g;return(g=T.current)==null?void 0:g.focus()},100)},[D,o,Qe,lt]);return m?e.jsxs(F,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh"},children:[e.jsx(cn,{}),e.jsx(P,{sx:{ml:2,color:o.palette.text.primary},children:"Verificando estado de la caja..."})]}):$?e.jsxs(ao.div,{initial:"hidden",animate:"enter",exit:"exit",variants:lo,transition:{duration:.5,type:"easeInOut"},children:[e.jsxs(F,{sx:t=>({display:"flex",flexDirection:"column",height:`calc(100vh - ${t.mixins.toolbar.minHeight}px - ${t.spacing(1)})`,overflow:"hidden"}),children:[e.jsxs(F,{sx:{p:1},children:[e.jsxs(de,{container:!0,sx:{display:"flex",justifyContent:"center",alignContent:"center",flexDirection:"column"},children:[et&&e.jsx(F,{sx:{bgcolor:"rgba(99, 179, 237, 0.2)",border:"1px solid #63b3ed",borderRadius:2,px:2,py:1,mb:2,mt:1,display:"flex",alignItems:"center",justifyContent:"center",maxWidth:"400px",mx:"auto"},children:e.jsx(P,{variant:"body2",sx:{color:"#63b3ed",fontWeight:"medium"},children:"📝 Editando Ticket Pendiente"})}),e.jsx(F,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsxs(J,{variant:"outlined",color:"info",onClick:()=>{Ve("full"),fe(!0)},startIcon:e.jsx(Ne,{}),size:"small",sx:{mt:1,color:o.palette.info.main,borderColor:o.palette.info.main,"&:hover":{borderColor:o.palette.info.main,color:o.palette.info.main}},children:["Tickets Pendientes (",wt.length,")"]})})]}),e.jsxs(de,{container:!0,rowSpacing:2,columnSpacing:2,sx:{display:"flex",justifyContent:"center",alignContent:"center"},children:[(Oe||X||C)&&e.jsx(de,{sx:{width:"100%",maxWidth:"400px",mb:2},children:e.jsxs(F,{sx:{bgcolor:X?"rgba(33, 150, 243, 0.1)":C?"rgba(156, 39, 176, 0.1)":"rgba(255, 152, 0, 0.1)",border:"1px solid",borderColor:X?o.palette.info.main:C?o.palette.secondary.main:o.palette.warning.main,borderRadius:2,px:1,py:.5,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(P,{variant:"body2",sx:{color:X?o.palette.info.dark:C?o.palette.secondary.dark:o.palette.warning.dark,fontWeight:"medium",pl:1},children:X?e.jsxs(e.Fragment,{children:["🔢 Cantidad Rápida: ",_t]}):C&&!R?e.jsx(e.Fragment,{children:"🔢 Ingrese cantidad"}):C&&R?e.jsxs(e.Fragment,{children:["✅ Cantidad: ",R," - Escanee código"]}):e.jsx(e.Fragment,{children:'✏️ Entrada Manual - Presione "Alt+x"'})}),(C||X)&&e.jsx(pt,{title:"Cancelar modo cantidad",children:e.jsx(K,{size:"small",onClick:()=>{var t;ve(!1),be(""),L(!1),G(""),ie(null),(t=T.current)==null||t.focus()},children:e.jsx(Q,{color:"error"})})})]})}),e.jsxs(de,{container:!0,spacing:2,sx:{width:"100%",maxWidth:"800px",justifyContent:"center"},children:[e.jsx(de,{size:{xs:12,sm:6},children:e.jsx(H,{autoFocus:!0,size:"small",sx:{mb:2,width:"100%"},InputProps:{startAdornment:e.jsx(ae,{position:"start",children:e.jsx(K,{size:"small",onClick:()=>{var t;w(n=>({...n,barcode:""})),(t=T.current)==null||t.focus()},children:e.jsx(Q,{color:"error"})})})},onInput:t=>{!X&&(!C||C&&R)&&(t.target.value=t.target.value.toString().slice(0,13))},type:"number",value:(Ie==null?void 0:Ie.barcode)||"",name:"barcode",autoComplete:"off",onKeyDown:Bn,onChange:gt,label:C&&!R||X?"Ingrese Cantidad":"Codigo de Barras",helperText:!Oe&&!X&&!C?"Alt+X: entrada manual, Alt+C: cantidad personalizada":C&&!R?"Ingrese cantidad - Luego presione Enter":C&&R?"Escanee código de barras":"",inputRef:T})}),e.jsx(de,{size:{xs:12,sm:6},children:e.jsx(ze,{value:ht,isOptionEqualToValue:(t,n)=>t.id===(n==null?void 0:n.id),clearText:"Limpiar",size:"small",sx:{mb:2,width:"100%"},onChange:Vn,options:Array.isArray(D==null?void 0:D.products)?D.products:[],getOptionLabel:t=>`${t.name} - ${t.description}`,renderInput:t=>e.jsx(H,{...t,label:"Selecciona un producto",variant:"outlined",size:"small",helperText:"Alt+B: Busque y seleccione un producto del inventario",inputRef:kt,autoComplete:"off"})})})]}),x.length>0&&e.jsx(de,{sx:{width:"30%",maxWidth:"800px"},children:e.jsx(rn,{elevation:2,sx:{backgroundColor:o.palette.background.tableHeader,color:"primary.contrastText",display:"flex",mt:-.5},children:e.jsxs(F,{sx:{display:"flex",justifyContent:"space-evenly",alignItems:"center",width:"100%",m:0,p:0},children:[e.jsx(P,{variant:"h6",sx:{fontWeight:"medium"},children:"TOTAL:"}),e.jsxs(P,{variant:"h5",sx:{fontWeight:"bold"},children:["$",Z.toFixed(2)]})]})})})]})]}),e.jsx(F,{sx:{flexGrow:1,overflowY:"auto",minHeight:0,px:2},children:x.length>0&&e.jsx(rn,{sx:{borderRadius:2},children:e.jsx(dn,{columns:Wn,data:rt,pagination:!1})})}),e.jsx(F,{sx:{p:2},children:x.length>0&&e.jsx(F,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(J,{variant:"contained",color:"success",onClick:()=>se(!0),startIcon:e.jsx(pn,{}),size:"large",sx:{fontSize:"clamp(0.9rem, 2vw, 1.1rem)",padding:"clamp(8px, 2vw, 12px) clamp(16px, 4vw, 24px)",borderRadius:"8px",boxShadow:"0 4px 12px rgba(76, 175, 80, 0.4)","&:hover":{boxShadow:"0 6px 16px rgba(76, 175, 80, 0.6)"}},children:"Finalizar Venta (Alt + F)"})})})]}),e.jsxs(e.Fragment,{children:[e.jsx(Ko,{isSummaryModalOpen:ne,setIsSummaryModalOpen:se,tempTable:x,selectedCustomer:Y,setSelectedCustomer:$e,paymentOption:ee,setPaymentOption:nt,selectedSinglePaymentType:j,setSelectedSinglePaymentType:ye,mixedPayments:Le,setMixedPayments:ot,ivaActivo:Pe,setIvaActivo:Ae,descuento:Be,setDescuento:Fe,amountReceived:xe,setAmountReceived:Me,handleSaveSale:Zt,handleSavePendingTicket:$t,setShowPendingTickets:()=>{Ve("infoOnly"),fe(!0)},pendingTickets:wt,calcularTotal:Ee,validateMixedPayments:it,isConfirmButtonDisabled:en,summaryError:gn,loadingSale:It,paymentMethods:z,customers:Sn,paymentLoading:Cn,customersLoading:wn,amountReceivedInputRef:Ct,inputRefCodigoBarra:T,setCurrentTicketId:je,setTempTable:v,setValues:w,setSelectedProduct:O,confirmButtonRef:St}),e.jsx(Jo,{showManualEntryModal:me,handleCloseManualEntryModal:Mn,editingItem:W,formValues:Yt,handleInputChange:Tn,manualProductNameRef:Kt,showAdditionalManualFields:yn,setShowAdditionalManualFields:bn,categories:jn,units:kn,handleManualEntrySubmit:qn}),e.jsx(Ho,{showPendingTickets:We,setShowPendingTickets:fe,pendingTickets:wt,handleLoadPendingTicket:Qt==="full"?Ln:null,handleDeletePendingTicket:En,allowLoading:Qt==="full"}),e.jsx(Vo,{isPesableModalOpen:He,setIsPesableModalOpen:re,productToWeigh:oe,weight:at,setWeight:he,weightInputRef:Ut,handleAddPesableProduct:zn}),e.jsx(ea,{open:Ce,onClose:vn,product:we,onSelectPresentation:Dn})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(F,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"80vh",textAlign:"center",p:3},children:[e.jsx(mn,{sx:{fontSize:80,color:"warning.main",mb:2}}),e.jsx(P,{variant:"h4",gutterBottom:!0,sx:{color:o.palette.text.primary},children:"Caja Cerrada"}),e.jsx(Ft,{severity:"warning",sx:{mb:3,maxWidth:"500px",bgcolor:"rgba(255, 152, 0, 0.1)",border:"1px solid rgba(255, 152, 0, 0.5)"},children:"Para poder registrar ventas, primero necesitas iniciar tu sesión de caja."}),e.jsx(J,{variant:"contained",size:"large",startIcon:e.jsx(fn,{}),onClick:M,children:"Abrir Caja"})]}),b&&e.jsx(oo,{open:b,onClose:N,userId:i==null?void 0:i.id})]})};export{za as default};
