import{d as we,j as e,a as We,e as ie,U as H,f as xe,r as i,S as ge,D as je,I as l,g as fe,B as V,G as I,h as u,i as p,k as be,l as _,C as ze,n as Pe,o as le,P as gt,T as G,p as P,M as jt,q as ft,s as bt,t as qe}from"./index-C4A7YWMW.js";import{d as Pt,v as N}from"./SaveAs-t3VbbXSm.js";import{S as me}from"./StyledAutocomplete-D4kJFy6t.js";import{S as De}from"./StyledCard-fRo-XxED.js";import{M as Ct,E as he}from"./EnhancedTable-BX9li6wm.js";import{D as Oe,S as vt,N as yt}from"./NewSupplierModal-Ch5Ne8nJ.js";import{d as A}from"./Clear-CkvqAIGR.js";import{d as kt}from"./Close-C6Pm4Hrr.js";import{A as Ne,c as St}from"./Autocomplete-okLxTLSl.js";import{u as It}from"./useDelete-DGUJ3i20.js";import{c as At}from"./ConfirmDelete-Bi1GYp2I.js";import{T as X}from"./Tooltip-DOLZfSzw.js";import{E as Le}from"./Edit-B8GMNmyj.js";import{G as o}from"./Grid2-BbvPN--I.js";import{K as Ft}from"./KeyboardArrowDown-BYcTFmFP.js";import{F as Ut}from"./FormControlLabel-uRoXpuuy.js";import{C as _t}from"./Checkbox-N2zSSZ7X.js";import{D as Et}from"./Divider-DlgemNlS.js";import"./Card-DZlrFGgg.js";import"./TableRow-BsCYnncP.js";import"./TableBody-Bv-WiDt9.js";import"./Popper-ijWchD3c.js";import"./Chip-Bc7mlkaj.js";import"./useThemeProps-D8tK1Axd.js";import"./Stack-DYQPukkq.js";const Mt=we(e.jsx("path",{d:"M22 5v2h-3v3h-2V7h-3V5h3V2h2v3zm-3 14H5V5h6V3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6h-2zm-4-6v4h2v-4zm-4 4h2V9h-2zm-2 0v-6H7v6z"}),"Addchart"),qt=we(e.jsx("path",{d:"M14 10H3v2h11zm0-4H3v2h11zm4 8v-4h-2v4h-4v2h4v4h2v-4h4v-2zM3 16h7v-2H3z"}),"PlaylistAdd"),Dt=({open:k,handleClose:$,onProductAdded:S,initialName:L=""})=>{const Z=We(),[g,j,d,,C]=ie({name:L}),{data:w}=H("categories","/category",!0,2*60*1e3),{data:W}=H("units","/units",!0,2*60*1e3),{mutate:ee,status:q}=xe("newProductStock"),[Y,F]=i.useState(!1);i.useEffect(()=>{k&&C({name:L,description:"",barcode:"",category_id:"",units_id:"",stock:0,cost:"",price:"",min_stock:0})},[k,L,C]),i.useEffect(()=>{F(q==="pending")},[q]);const E=()=>{const{cost:c,description:s,name:f,stock:K,category_id:T,units_id:b,price:M}=g;if(!Object.values({cost:c,description:s,name:f,stock:K,category_id:T,units_id:b,price:M}).every(m=>m!=null&&!N.isEmpty(m.toString(),{ignore_whitespace:!0}))){Pe("Por favor, complete todos los campos requeridos.",Z);return}ee({url:"/stock",values:g},{onSuccess:m=>{S(m.data),d(),$()},onError:m=>{console.error("Error al guardar el producto:",m),Pe("Hubo un error al guardar el producto. Verifique que el nombre no esté repetido.",Z)}})},z=()=>{d(),$()};return e.jsxs(ge,{fullWidth:!0,maxWidth:"md",open:k,onClose:z,children:[e.jsxs(je,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:"background.dialog",color:"text.primary"},children:["Agregar Nuevo Producto",e.jsx(l,{onClick:z,children:e.jsx(kt,{color:"error"})})]}),e.jsx(fe,{sx:{p:0,backgroundColor:"background.paper"},children:e.jsx(V,{sx:{backgroundColor:"background.dialog",color:"text.primary",p:3},children:e.jsxs(I,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(I,{item:!0,xs:6,sm:6,md:4,lg:3,children:e.jsx(u,{autoFocus:!0,name:"name",label:"Nombre del Producto",fullWidth:!0,value:g.name||"",onChange:j,required:!0,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(l,{onClick:()=>d("name"),children:e.jsx(A,{color:"error"})})})}})}),e.jsx(I,{item:!0,xs:6,sm:6,md:4,lg:3,children:e.jsx(u,{name:"description",label:"Descripción",fullWidth:!0,value:g.description||"",onChange:j,required:!0,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(l,{onClick:()=>d("description"),children:e.jsx(A,{color:"error"})})})}})}),e.jsx(I,{item:!0,xs:6,sm:6,md:4,lg:3,children:e.jsx(u,{name:"barcode",label:"Código de Barras",fullWidth:!0,type:"number",onInput:c=>{c.target.value=c.target.value.toString().slice(0,13)},value:g.barcode||"",onChange:j,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(l,{onClick:()=>d("barcode"),children:e.jsx(A,{color:"error"})})})}})}),e.jsx(I,{item:!0,xs:6,sm:6,md:4,lg:3,children:e.jsx(Ne,{options:w||[],getOptionLabel:c=>c.name||"",value:(w==null?void 0:w.find(c=>c.id===g.category_id))||null,onChange:(c,s)=>j({target:{name:"category_id",value:s?s.id:""}}),isOptionEqualToValue:(c,s)=>c.id===s.id,renderInput:c=>e.jsx(u,{...c,label:"Categoría",fullWidth:!0,required:!0,InputProps:{...c.InputProps,startAdornment:e.jsx(p,{position:"start",children:e.jsx(l,{onClick:()=>j({target:{name:"category_id",value:""}}),children:e.jsx(A,{color:"error"})})})}})})}),e.jsx(I,{item:!0,xs:6,sm:6,md:4,lg:3,children:e.jsx(Ne,{options:W||[],getOptionLabel:c=>c.name||"",value:(W==null?void 0:W.find(c=>c.id===g.units_id))||null,onChange:(c,s)=>j({target:{name:"units_id",value:s?s.id:""}}),isOptionEqualToValue:(c,s)=>c.id===s.id,renderInput:c=>e.jsx(u,{...c,label:"Unidad de Medida",fullWidth:!0,required:!0,InputProps:{...c.InputProps,startAdornment:e.jsx(p,{position:"start",children:e.jsx(l,{onClick:()=>j({target:{name:"units_id",value:""}}),children:e.jsx(A,{color:"error"})})})}})})}),e.jsx(I,{item:!0,xs:6,sm:6,md:4,lg:3,children:e.jsx(u,{name:"stock",label:"Stock Inicial",type:"number",fullWidth:!0,value:g.stock||"",onChange:j,required:!0,helperText:"Este será el stock inicial.",InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(l,{onClick:()=>d("stock"),children:e.jsx(A,{color:"error"})})})}})}),e.jsx(I,{item:!0,xs:6,sm:6,md:4,lg:3,children:e.jsx(u,{name:"cost",label:"Precio de Costo",type:"number",fullWidth:!0,value:g.cost||"",onChange:j,required:!0,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(l,{onClick:()=>d("cost"),children:e.jsx(A,{color:"error"})})})}})}),e.jsx(I,{item:!0,xs:6,sm:6,md:4,lg:3,children:e.jsx(u,{name:"price",label:"Precio de Venta",type:"number",fullWidth:!0,value:g.price||"",onChange:j,required:!0,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(l,{onClick:()=>d("price"),children:e.jsx(A,{color:"error"})})})}})}),e.jsx(I,{item:!0,xs:6,sm:6,md:4,lg:3,children:e.jsx(u,{name:"min_stock",label:"Stock Mínimo",type:"number",fullWidth:!0,value:g.min_stock||"",onChange:j,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(l,{onClick:()=>d("min_stock"),children:e.jsx(A,{color:"error"})})})}})})]})})}),e.jsxs(be,{sx:{p:2,backgroundColor:"background.dialog"},children:[e.jsx(_,{onClick:z,color:"error",startIcon:e.jsx(A,{}),children:"Cancelar"}),e.jsx(_,{onClick:E,color:"primary",variant:"contained",disabled:Y,startIcon:Y?e.jsx(ze,{size:20}):e.jsx(Pt,{}),children:"Guardar"})]})]})};le.locale("es");const cr=()=>{const k=We(),[$,S]=i.useState(0),[L,Z]=i.useState(5),[g,j]=i.useState(0),[d,C,w]=ie({factura:"",supplier:"",startDate:"",endDate:"",stock_id:""}),[W,ee]=i.useState(!1),[q,Y]=i.useState(!1),[F,E,z,,c]=ie(),[s,f,K,,T]=ie(),[b,M]=i.useState([]),[te,Q]=i.useState(null),[m,D]=i.useState(null),[Ce,U]=i.useState(""),[ce,Te]=i.useState(!1),[Be,de]=i.useState(!1),[Re,Ge]=i.useState([]),[Ve,ue]=i.useState(!1),[He,ve]=i.useState(""),[$e,Ye]=i.useState(!1),[Ke,Ot]=i.useState(""),[re,Qe]=i.useState({createdAt:!0,factura:!0,supplier:!0,cost:!0,actions:!0}),[ye,ke]=i.useState(null),Se=i.useMemo(()=>b.reduce((t,r)=>t+parseFloat(r.cost||0),0),[b]),{data:se,isLoading:Je,refetch:Xe}=H("suppliers","/suppliers",!0,0),{data:h,isLoading:Ze,refetch:Ie}=H("stock","/stock?limit=1000",!0,0),{data:ne,isLoading:Nt}=H("units","/units",!0,0),Ae=new URLSearchParams({page:$+1,limit:L,...d.factura&&{factura:d.factura},...d.supplier&&{supplier:d.supplier},...d.startDate&&{startDate:d.startDate},...d.endDate&&{endDate:d.endDate},...d.stock_id&&{stock_id:d.stock_id}}).toString(),{data:B,isLoading:et,refetch:Fe}=H(["purchases",Ae],`/purchases?${Ae}`,!0),oe=i.useMemo(()=>{var t;return(t=ne==null?void 0:ne.find(r=>r.name==="Kilogramo"))==null?void 0:t.id},[ne]),J=i.useMemo(()=>m&&m.units_id===oe&&m.tipo_venta==="pesable",[m,oe]),{mutateAsync:tt,isLoading:Ue}=xe("newPurchase"),{mutateAsync:rt,isLoading:_e}=xe("updatePurchase"),{mutateAsync:st,isLoading:Lt}=It("deletePurchase");i.useEffect(()=>{var t;B&&j(((t=B.pagination)==null?void 0:t.total)||0)},[B]),i.useEffect(()=>{if(J){const t=parseFloat(s.quantity||0),r=parseFloat(s.cost||0)/(t||1);T(n=>({...n,totalPerUnits:t,costPerUnits:isFinite(r)?r.toFixed(3):0}))}else if(Object.hasOwn(s,"boxes")||Object.hasOwn(s,"unitsPerBox")||Object.hasOwn(s,"quantityPerUnits")||Object.hasOwn(s,"cost")){const t=(parseFloat(s.boxes||0)||1)*(parseFloat(s.unitsPerBox||0)||1)*(parseFloat(s.quantityPerUnits||0)||1),r=parseFloat(s.cost||0)/(t||1);T(n=>({...n,totalPerUnits:t,costPerUnits:isFinite(r)?r.toFixed(3):0}))}},[s.boxes,s.unitsPerBox,s.quantityPerUnits,s.cost,s.quantity,J]);const Ee=(t=null)=>{t?(Y(!0),c(t),M(t.details.map(r=>{const n=h==null?void 0:h.products.find(x=>x.id===r.stock_id),a=n&&oe&&n.units_id===oe&&n.tipo_venta==="pesable";return{stock_id:r.stock_id,name:r.stock.name,description:r.stock.description,cost:r.cost*r.quantity,costPerUnits:r.cost,...a?{quantity:parseFloat(r.quantity),totalPerUnits:parseFloat(r.quantity)}:{boxes:1,unitsPerBox:1,quantityPerUnits:r.quantity,totalPerUnits:r.quantity}}})||[])):(Y(!1),z(),K(),M([]),Q(null),D(null)),U(""),ee(!0)},ae=i.useCallback(()=>{ee(!1)},[]),nt=t=>{const r=t.map(n=>({id:n.id,producto:n.stock.name,description:n.stock.description,cantidad:n.quantity,precio:R(n.cost),total:R(n.cost*n.quantity)}));Ge(r),de(!0)},ot=t=>{console.log("handleDeletePurchase: purchase object:",t),console.log("handleDeletePurchase: purchase.id:",t.id),At(async()=>{var r,n;try{await st({url:"/delPurchase/",id:t.id}),qe("Compra eliminada con éxito!",k),Fe()}catch(a){Pe(((n=(r=a.response)==null?void 0:r.data)==null?void 0:n.message)||"Hubo un error al eliminar la compra.",k)}},"¿Estás seguro de eliminar esta compra?",k)},at=()=>{let t={...s};J||((!t.boxes||parseFloat(t.boxes)<=0)&&(t.boxes=1),(!t.unitsPerBox||parseFloat(t.unitsPerBox)<=0)&&(t.unitsPerBox=1));let r=!1;if(J){const{quantity:a,cost:x}=t;r=m&&N.isNumeric(a==null?void 0:a.toString())&&a>0&&N.isNumeric(x==null?void 0:x.toString())&&x>0}else{const{boxes:a,unitsPerBox:x,quantityPerUnits:v,cost:O}=t;r=m&&N.isNumeric(a==null?void 0:a.toString())&&a>0&&N.isNumeric(x==null?void 0:x.toString())&&x>0&&N.isNumeric(v==null?void 0:v.toString())&&v>0&&N.isNumeric(O==null?void 0:O.toString())&&O>0}if(!r){U("Por favor, comprueba los campos del item. Producto, Cant/Unidad y Costo son requeridos y deben ser mayores a 0.");return}const n={...t,name:m.name,description:m.description};if(te!==null){const a=[...b];a[te]=n,M(a),Q(null)}else M([...b,n]);K(),D(null),U("")},it=t=>{const r=b[t];Q(t),T(r);const n=h==null?void 0:h.products.find(a=>a.id===r.stock_id);D(n)},lt=t=>{M(b.filter((r,n)=>n!==t))},ct=async()=>{var v,O;if(b.length===0){U("Debes agregar al menos un item a la compra.");return}const{createdAt:t,factura:r,supplier:n}=F;if(!t||!r||!n){U("Completa los campos Fecha, Factura y Proveedor.");return}const a=le(t,"YYYY-MM-DD",!0);if(!a.isValid()||a.year()<2e3){U("La fecha de la factura no es válida. Por favor, usa el formato AAAA-MM-DD y un año razonable.");return}if(a.isAfter(le())){U("La fecha de la factura no puede ser en el futuro.");return}const x={...F,cost:Se,tempValues:b.map(y=>({stock_id:y.stock_id,totalPerUnits:y.totalPerUnits,costPerUnits:parseFloat(y.costPerUnits)}))};console.log("handleSavePurchase: isEditingPurchase =",q),q&&console.log("handleSavePurchase: purchaseValues.id =",F.id);try{console.log("handleSavePurchase: Starting try block.");let y;q?(y=await rt({url:`/purchases/${F.id}`,values:x,method:"put"}),console.log("handleSavePurchase: updatePurchase resolved successfully.",y)):(y=await tt({url:"/purchases/full",values:x}),console.log("handleSavePurchase: newPurchase resolved successfully.",y)),qe("Compra guardada con éxito!",k),console.log("handleSavePurchase: mostrarExito called."),z(),K(),M([]),Q(null),D(null),U(""),ae(),console.log("handleSavePurchase: handleClosePurchaseModal called."),await Fe(),console.log("handleSavePurchase: refetchPurchases completed."),await Ie(),console.log("handleSavePurchase: refetchStock completed."),console.log("handleSavePurchase: End of try block.")}catch(y){console.error("handleSavePurchase: Caught an error!",y),U(((O=(v=y.response)==null?void 0:v.data)==null?void 0:O.message)||"Hubo un error al guardar la compra.")}},pe=i.useMemo(()=>[{id:"createdAt",label:"Fecha",align:"center",valueGetter:({row:t})=>le.utc(t.createdAt).format("DD/MM/YYYY")},{id:"factura",label:"Factura",align:"center"},{id:"supplier",label:"Proveedor",align:"center"},{id:"cost",label:"Total",align:"center",valueGetter:({row:t})=>R(t.cost)},{id:"actions",label:"Acciones",align:"center",valueGetter:({row:t})=>e.jsxs(e.Fragment,{children:[e.jsx(X,{title:"Ver Detalle",children:e.jsx(l,{size:"small",color:"secondary",onClick:()=>nt(t.details),children:e.jsx(Mt,{fontSize:"small"})})}),e.jsx(X,{title:"Editar Compra",children:e.jsx(l,{size:"small",color:"info",onClick:()=>Ee(t),children:e.jsx(Le,{fontSize:"small"})})}),e.jsx(X,{title:"Eliminar Compra",children:e.jsx(l,{size:"small",color:"warning",onClick:()=>ot(t),children:e.jsx(Oe,{fontSize:"small"})})})]})}],[]),dt=[{id:"name",label:"Producto",align:"center"},{id:"totalPerUnits",label:"Cantidad",align:"center",valueGetter:({row:t})=>Me(t.totalPerUnits)},{id:"cost",label:"Costo Total",align:"center",valueGetter:({row:t})=>R(t.cost)},{id:"actions",label:"Acciones",align:"center"}],ut=i.useMemo(()=>pe.filter(t=>re[t.id]),[pe,re]),R=t=>{const r=parseFloat(t);return isNaN(r)?"":r.toLocaleString("es-AR",{style:"currency",currency:"ARS"})},Me=(t,r=2)=>{const n=parseFloat(t);return isNaN(n)?"":n.toFixed(r)},pt=(t,r)=>S(r),mt=t=>{Z(parseInt(t.target.value,10)),S(0)},ht=et||Je||Ze,xt=[{id:"producto",label:"Producto"},{id:"description",label:"Descripcion"},{id:"cantidad",label:"Cantidad",valueGetter:({row:t})=>Me(t.cantidad)},{id:"precio",label:"Costo Unitario"},{id:"total",label:"Total"}];return e.jsxs(V,{sx:{p:1},children:[e.jsx(gt,{elevation:3,sx:{p:{xs:2,sm:3},mb:3,mt:2,background:t=>t.palette.background.componentHeaderBackground,color:k.palette.primary.contrastText},children:e.jsxs(o,{container:!0,justifyContent:"space-between",alignItems:"center",children:[e.jsxs(o,{children:[e.jsx(G,{variant:"h4",gutterBottom:!0,children:"Gestión de Compras"}),e.jsx(G,{variant:"body1",sx:{opacity:.9},children:"Administra las compras de tu negocio"})]}),e.jsx(o,{children:e.jsx(_,{variant:"outlined",color:"primary",onClick:()=>Ee(),startIcon:e.jsx(vt,{}),children:"Nueva Compra"})})]})}),e.jsxs(De,{sx:{p:2,mb:3},children:[e.jsxs(o,{container:!0,justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[e.jsx(G,{variant:"h6",children:"Filtros de Búsqueda"}),e.jsx(l,{disableRipple:!0,size:"small",onClick:()=>Te(!ce),sx:{p:0},children:e.jsx(Ft,{sx:{transition:"0.5s",transform:ce?"rotate(-180deg)":"rotate(0)",backgroundColor:"primary.main",color:"primary.contrastText",borderRadius:"50%"}})})]}),e.jsx(V,{sx:{height:ce?"auto":0,overflow:"hidden",transition:"height 0.3s ease-in-out"},children:e.jsx(o,{container:!0,spacing:2,justifyContent:"center",alignItems:"flex-start",children:e.jsx(o,{xs:12,children:e.jsxs(V,{sx:{border:`1px solid ${k.palette.divider}`,borderRadius:1,p:2,height:"100%"},children:[e.jsx(G,{variant:"subtitle1",gutterBottom:!0,children:"Filtrar Tabla"}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsx(o,{xs:12,sm:6,md:3,children:e.jsx(u,{label:"Nº de Factura",name:"factura",value:d.factura||"",onChange:t=>{C(t),S(0)},InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(l,{onClick:()=>C({target:{name:"factura",value:""}}),children:e.jsx(P,{color:"error"})})})}})}),e.jsx(o,{xs:12,sm:6,md:3,children:e.jsx(u,{label:"Proveedor",name:"supplier",value:d.supplier||"",onChange:t=>{C(t),S(0)},InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(l,{onClick:()=>C({target:{name:"supplier",value:""}}),children:e.jsx(P,{color:"error"})})})}})}),e.jsx(o,{xs:12,sm:6,md:3,children:e.jsx(u,{label:"Fecha Inicio",type:"date",name:"startDate",value:d.startDate||"",onChange:t=>{C(t),S(0)},InputLabelProps:{shrink:!0}})}),e.jsx(o,{xs:12,sm:6,md:3,children:e.jsx(u,{label:"Fecha Fin",type:"date",name:"endDate",value:d.endDate||"",onChange:t=>{C(t),S(0)},InputLabelProps:{shrink:!0}})}),e.jsx(o,{xs:12,sm:6,md:4,children:e.jsx(me,{options:Array.isArray(h==null?void 0:h.products)?h.products:[],getOptionLabel:t=>`${t.name} - ${t.description}`||"",isOptionEqualToValue:(t,r)=>t.id===r.id,onChange:(t,r)=>{C({target:{name:"stock_id",value:r?r.id:""}}),S(0)},value:(h==null?void 0:h.products.find(t=>t.id===d.stock_id))||null,renderInput:t=>e.jsx(u,{...t,label:"Filtrar por producto contenido",InputProps:{...t.InputProps,startAdornment:e.jsx(p,{position:"start",children:e.jsx(l,{onClick:()=>C({target:{name:"stock_id",value:""}}),children:e.jsx(P,{color:"error"})})})}})})}),e.jsx(o,{xs:12,sm:6,md:4,sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(_,{variant:"outlined",color:"secondary",onClick:()=>{w(),S(0)},children:"Limpiar Filtros"})})]})]})})})})]}),e.jsxs(De,{sx:{p:2},children:[e.jsxs(o,{container:!0,justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[e.jsx(o,{children:e.jsx(G,{variant:"h6",gutterBottom:!0,children:"Listado de Compras"})}),e.jsxs(o,{children:[e.jsx(_,{"aria-controls":"columns-menu","aria-haspopup":"true",onClick:t=>ke(t.currentTarget),variant:"outlined",children:"Mostrar/Ocultar Columnas"}),e.jsx(jt,{id:"columns-menu",anchorEl:ye,keepMounted:!0,open:!!ye,onClose:()=>ke(null),children:pe.map(t=>t.id!=="actions"&&e.jsx(Ct,{children:e.jsx(Ut,{control:e.jsx(_t,{checked:!!re[t.id],onChange:r=>{Qe({...re,[t.id]:r.target.checked})}}),label:t.label})},t.id))})]})]}),e.jsx(he,{columns:ut,data:(B==null?void 0:B.rows)||[],loading:ht,count:g,page:$,rowsPerPage:L,onPageChange:pt,onRowsPerPageChange:mt})]}),e.jsxs(ge,{open:W,onClose:ae,maxWidth:"xl",fullWidth:!0,children:[e.jsxs(je,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:"background.dialog",color:"text.primary"},children:[q?"Editar Compra":"Nueva Compra",e.jsx(l,{onClick:ae,children:e.jsx(ft,{color:"error"})})]}),e.jsx(fe,{sx:{p:0,backgroundColor:"background.paper"},children:e.jsxs(V,{sx:{backgroundColor:"background.dialog",p:3},children:[Ce&&e.jsx(bt,{severity:"error",sx:{mb:2},children:Ce}),e.jsxs(o,{container:!0,spacing:2,sx:{mt:0},justifyContent:"center",children:[e.jsx(o,{xs:12,md:4,children:e.jsx(u,{fullWidth:!0,label:"Fecha",type:"date",name:"createdAt",value:(F.createdAt||"").substr(0,10),onChange:E,InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(l,{onClick:()=>E({target:{name:"createdAt",value:""}}),children:e.jsx(P,{color:"error"})})})}})}),e.jsx(o,{xs:12,md:4,children:e.jsx(u,{fullWidth:!0,label:"Nº de Factura",name:"factura",value:F.factura||"",onChange:E,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(l,{onClick:()=>E({target:{name:"factura",value:""}}),children:e.jsx(P,{color:"error"})})})}})}),e.jsx(o,{xs:12,md:4,children:e.jsx(me,{freeSolo:!0,options:se||[],getOptionLabel:t=>typeof t=="string"?t:t.inputValue?t.nombre:t.nombre||"",value:(se==null?void 0:se.find(t=>t.nombre===F.supplier))||null,onChange:(t,r)=>{typeof r=="string"?(ve(r),ue(!0)):r&&r.inputValue?(ve(r.inputValue),ue(!0)):E({target:{name:"supplier",value:(r==null?void 0:r.nombre)||""}})},filterOptions:(t,r)=>{const n=St({stringify:v=>v.nombre})(t,r),{inputValue:a}=r,x=t.some(v=>a===v.nombre);return a!==""&&!x&&n.push({inputValue:a,nombre:`Agregar "${a}"`}),n},renderInput:t=>e.jsx(u,{...t,label:"Proveedor",InputProps:{...t.InputProps,startAdornment:e.jsx(p,{position:"start",children:e.jsx(l,{onClick:()=>E({target:{name:"supplier",value:""}}),children:e.jsx(P,{color:"error"})})})}}),renderOption:(t,r)=>{const{key:n,...a}=t;return e.jsx("li",{...a,children:r.nombre},n)}})})]}),e.jsx(Et,{sx:{my:3},children:"Añadir Items"}),e.jsxs(o,{container:!0,spacing:2,justifyContent:"center",children:[e.jsx(o,{xs:12,md:6,lg:4,children:e.jsx(me,{options:(h==null?void 0:h.products)||[],value:m,onChange:(t,r)=>{D(r),f({target:{name:"stock_id",value:(r==null?void 0:r.id)||""}})},getOptionLabel:t=>`${t.name} - ${t.description}`,renderInput:t=>e.jsx(u,{...t,label:"Selecciona un producto",InputProps:{...t.InputProps,startAdornment:e.jsx(p,{position:"start",children:e.jsx(l,{onClick:()=>D(null),children:e.jsx(P,{color:"error"})})})}})})}),J?e.jsx(o,{xs:6,md:3,lg:2,children:e.jsx(u,{fullWidth:!0,label:"Cantidad (Kg)",type:"number",name:"quantity",value:s.quantity||"",onChange:f,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(l,{onClick:()=>f({target:{name:"quantity",value:""}}),children:e.jsx(P,{color:"error"})})})}})}):e.jsxs(e.Fragment,{children:[e.jsx(o,{xs:6,md:3,lg:2,children:e.jsx(u,{fullWidth:!0,label:"Cajas/Bultos",type:"number",name:"boxes",value:s.boxes||"",onChange:f,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(l,{onClick:()=>f({target:{name:"boxes",value:""}}),children:e.jsx(P,{color:"error"})})})}})}),e.jsx(o,{xs:6,md:3,lg:2,children:e.jsx(u,{fullWidth:!0,label:"Unidades/Caja",type:"number",name:"unitsPerBox",value:s.unitsPerBox||"",onChange:f,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(l,{onClick:()=>f({target:{name:"unitsPerBox",value:""}}),children:e.jsx(P,{color:"error"})})})}})}),e.jsx(o,{xs:6,md:3,lg:2,children:e.jsx(u,{fullWidth:!0,label:"Cant/Unidad",type:"number",name:"quantityPerUnits",value:s.quantityPerUnits||"",onChange:f,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(l,{onClick:()=>f({target:{name:"quantityPerUnits",value:""}}),children:e.jsx(P,{color:"error"})})})}})})]}),e.jsx(o,{xs:6,md:3,lg:2,children:e.jsx(u,{fullWidth:!0,label:"Costo Total",type:"number",name:"cost",value:s.cost||"",onChange:f,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(l,{onClick:()=>f({target:{name:"cost",value:""}}),children:e.jsx(P,{color:"error"})})})}})}),e.jsx(o,{xs:6,md:3,lg:2,children:e.jsx(u,{fullWidth:!0,label:"Total Unidades",type:"number",name:"totalPerUnits",value:s.totalPerUnits||0,InputProps:{readOnly:!0}})}),e.jsx(o,{xs:6,md:3,lg:2,children:e.jsx(u,{fullWidth:!0,label:"Costo/Unidad",type:"number",name:"costPerUnits",value:s.costPerUnits||0,InputProps:{readOnly:!0}})}),e.jsx(o,{xs:12,md:2,sx:{display:"flex",alignItems:"center"},children:e.jsx(_,{fullWidth:!0,variant:"outlined",onClick:at,startIcon:e.jsx(qt,{}),children:te!==null?"Actualizar":"Agregar"})})]}),b.length>0&&e.jsxs(V,{sx:{mt:3},children:[e.jsx(he,{columns:dt,data:b,loading:!1,pagination:!1,renderRow:(t,r)=>e.jsxs("tr",{children:[e.jsx("td",{align:"center",children:t.name}),e.jsx("td",{align:"center",children:t.totalPerUnits}),e.jsx("td",{align:"center",children:R(t.cost)}),e.jsxs("td",{align:"center",children:[e.jsx(X,{title:"Editar Item",children:e.jsx(l,{size:"small",color:"info",onClick:()=>it(r),children:e.jsx(Le,{fontSize:"small"})})}),e.jsx(X,{title:"Eliminar Item",children:e.jsx(l,{size:"small",color:"warning",onClick:()=>lt(r),children:e.jsx(Oe,{fontSize:"small"})})})]})]},r)}),e.jsxs(G,{variant:"h6",align:"right",sx:{mt:2},children:["Total Compra: ",R(Se)]})]})]})}),e.jsxs(be,{sx:{p:2,backgroundColor:"background.dialog"},children:[e.jsx(_,{variant:"contained",color:"primary",onClick:ct,disabled:Ue||_e,children:Ue||_e?e.jsx(ze,{size:24}):"Guardar Compra"}),e.jsx(_,{variant:"outlined",color:"secondary",onClick:ae,sx:{padding:"2px 12px",ml:2},children:"Cancelar"})]})]}),e.jsxs(ge,{open:Be,onClose:()=>de(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(je,{children:"Detalle de la Compra"}),e.jsx(fe,{children:e.jsx(he,{columns:xt,data:Re,pagination:!1,loading:!1})}),e.jsx(be,{children:e.jsx(_,{onClick:()=>de(!1),children:"Cerrar"})})]}),e.jsx(yt,{open:Ve,handleClose:()=>ue(!1),initialName:He,onSupplierAdded:t=>{Xe(),c(r=>({...r,supplier:t.nombre}))}}),e.jsx(Dt,{open:$e,handleClose:()=>Ye(!1),initialName:Ke,onProductAdded:t=>{Ie(),D(t),T(r=>({...r,stock_id:t.id}))}})]})};export{cr as default};
