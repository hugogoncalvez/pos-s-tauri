import{d as Ke,j as e,R as We,a as Me,e as _e,r as o,v as ie,U as Ie,w as Ye,x as Xe,t as Ae,I as d,g as Re,s as Je,h as x,i as p,C as Se,p as g,T as D,l as Z,B as X,k as Ze,f as et,y as tt,o as Ge,P as rt,M as nt,S as at,D as ot,q as st,n as Le}from"./index-C4A7YWMW.js";import{S as we}from"./StyledAutocomplete-D4kJFy6t.js";import{S as Ne}from"./StyledCard-fRo-XxED.js";import{S as ze,a as Ee,E as Ue,M as it}from"./EnhancedTable-BX9li6wm.js";import{D as $e,S as lt,N as ct}from"./NewSupplierModal-Ch5Ne8nJ.js";import{v as dt}from"./SaveAs-t3VbbXSm.js";import{d as ut,S as pt}from"./Debounce-BcbV65M7.js";import{T as J}from"./Tooltip-DOLZfSzw.js";import{E as Ve}from"./Edit-B8GMNmyj.js";import{G as s}from"./Grid2-BbvPN--I.js";import{A as fe,c as mt}from"./Autocomplete-okLxTLSl.js";import{D as xt}from"./Divider-DlgemNlS.js";import{A as gt}from"./Autorenew-waNVMKCV.js";import{u as ht}from"./useDelete-DGUJ3i20.js";import{c as jt}from"./ConfirmDelete-Bi1GYp2I.js";import{K as bt}from"./KeyboardArrowDown-BYcTFmFP.js";import{F as Fe}from"./FormControlLabel-uRoXpuuy.js";import{C as Oe}from"./Checkbox-N2zSSZ7X.js";import"./Card-DZlrFGgg.js";import"./TableRow-BsCYnncP.js";import"./TableBody-Bv-WiDt9.js";import"./Close-C6Pm4Hrr.js";import"./Clear-CkvqAIGR.js";import"./Popper-ijWchD3c.js";import"./useThemeProps-D8tK1Axd.js";import"./Chip-Bc7mlkaj.js";import"./Stack-DYQPukkq.js";const ft=Ke(e.jsx("path",{d:"M11 18h2v-2h-2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4"}),"HelpOutline"),De=[{value:"unitario",label:"Unitario"},{value:"pesable",label:"Pesable"}],vt=We.memo(({initialProduct:h,onSaveProduct:Q,onCancel:ve,barcodeInputRef:K,setNewSupplierName:W,setSupplierDialogOpen:M,refetchSuppliers:Be,formatCurrency:R,updating:le,guardando:S})=>{const I=Me(),[a,ce,de,,m]=_e(h||{}),[v,L]=o.useState(""),[G,j]=o.useState(""),[Ce,ee]=o.useState(""),[C,_]=o.useState((h==null?void 0:h.presentations)||[]),[b,k,N,,Y]=_e(),[F,O]=o.useState(null),[ue,w]=o.useState(!1),[pe,z]=o.useState(1),{data:U,isLoading:te}=ie("categories","/category",!0,0,{keepPreviousData:!0}),{data:A,isLoading:Te}=ie("units","/units",!0,0,{keepPreviousData:!0}),{data:$,isLoading:qe}=ie("suppliers","/suppliers",!0,0,{keepPreviousData:!0}),[E,ke]=o.useState(null),{refetch:re,isFetching:V}=Ie(["checkBarcode",E],`/stock/check-barcode?barcode=${E}${a.id?`&productId=${a.id}`:""}`,!1,0,{onSuccess:t=>{t.exists?L("Este código de barras ya está en uso."):L("")},onError:t=>{console.error("Error al verificar código de barras:",t),L("Error al verificar el código de barras.")}}),B=o.useCallback(t=>{if(t.length!==12)throw new Error("Input must be 12 digits for EAN-13 check digit calculation.");let n=0;for(let l=0;l<12;l++)n+=parseInt(t[l])*(l%2===0?1:3);return((10-n%10)%10).toString()},[]),me=o.useCallback((t,n)=>{let c=0;return t.forEach(l=>{if(l&&l.startsWith(n)&&l.length===13){const P=l.substring(n.length,l.length-1),T=parseInt(P,10);!isNaN(T)&&T>c&&(c=T)}}),c+1},[]),H=o.useCallback(t=>{if(!t||t.length<8){L("");return}ke(t),setTimeout(()=>re(),0)},[re]),xe=o.useMemo(()=>ut(H,500),[H]),u=o.useCallback(t=>{G&&j(""),ce(t)},[ce,G]),ge=o.useCallback(t=>{const n=t.target.value.toString().slice(0,13);u({target:{name:"barcode",value:n}}),xe(n)},[u,xe]),he=o.useCallback(t=>{if(t.key==="Enter"){t.preventDefault();const n=t.target.value.trim();n&&H(n)}},[H]),Pe=o.useCallback(async()=>{w(!0),j("");const t="201";let n=pe,c="",l=!1,P=0;const T=100;for(;!l&&P<T;){P++;const q=n.toString().padStart(9,"0"),r=t+q,i=B(r);if(c=r+i,!C.some(f=>f.barcode===c))try{const{data:f}=await Ye.get(`/barcodes/validate/${c}`);f.exists?n++:l=!0}catch(f){console.error("Error al validar el código de barras con el backend:",f),j("Error al validar el código de barras con el servidor."),w(!1);return}else n++}l?(Y(q=>({...q,barcode:c})),z(n+1)):j("No se pudo generar un código de barras único después de varios intentos."),w(!1)},[pe,C,B,Y,z,j,w]),je=o.useCallback(()=>{const{name:t,quantity_in_base_units:n,price:c}=b;if(!t||!n||!c){j("Completa los campos Nombre, Cantidad y Precio de la presentación.");return}const l={...b};if(F!==null){const P=[...C];P[F]=l,_(P),O(null)}else _([...C,l]);N(),j(""),(a==null?void 0:a.tipo_venta)==="pesable"&&k({target:{name:"quantity_in_base_units",value:1}})},[b,F,C,N,a==null?void 0:a.tipo_venta,_,O,j,k]),ne=o.useCallback(t=>{const n=C[t];n&&(Y({id:n.id,name:n.name,quantity_in_base_units:parseFloat(n.quantity_in_base_units),price:parseFloat(n.price),barcode:n.barcode}),O(t))},[C,Y,O]),be=o.useCallback(t=>{Xe.fire({title:"¿Estás seguro?",text:"¡No podrás revertir esto!",icon:"warning",showCancelButton:!0,confirmButtonColor:I.palette.primary.main,cancelButtonColor:I.palette.error.main,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar",background:I.palette.background.paper,color:I.palette.text.primary,didOpen:()=>{const n=document.querySelector(".swal2-container");n&&(n.style.zIndex="1400")}}).then(n=>{n.isConfirmed&&(_(C.filter((c,l)=>l!==t)),Ae("Presentación eliminada correctamente.",I))})},[C,_,I]),ye=o.useCallback(async()=>{if(v){j("Corrige el error del código de barras antes de guardar.");return}if(V){j("Verificando código de barras, por favor espera.");return}const t={...a,presentations:C},n={cost:t.cost,name:t.name,stock:t.stock,category_id:t.category_id,units_id:t.units_id,price:t.price,tipo_venta:t.tipo_venta||"unitario",min_stock:t.min_stock};if(!Object.values(n).every(l=>l!=null&&!dt.isEmpty(l.toString(),{ignore_whitespace:!0}))){j("Por favor, comprueba los campos del producto. Todos los campos marcados con * son requeridos.");return}Q(t)},[v,V,a,C,Q,j]);o.useEffect(()=>{if(h){m(h),_(h.presentations||[]);const t=(h.presentations||[]).map(c=>c.barcode).filter(Boolean),n=me(t,"201");z(n)}else de(),_([]),z(1);L(""),j(""),ee(""),N(),O(null)},[h,m,_,de,N,L,j,ee,O,me]),o.useEffect(()=>{(a==null?void 0:a.tipo_venta)==="pesable"&&k({target:{name:"quantity_in_base_units",value:1}})},[a==null?void 0:a.tipo_venta,k]),o.useEffect(()=>{K.current&&K.current.focus()},[K]),o.useEffect(()=>{if(Ce){const t=setTimeout(()=>{ee("")},1500);return()=>clearTimeout(t)}},[Ce]);const ae=o.useMemo(()=>[{id:"name",label:"Nombre",align:"left"},{id:"quantity_in_base_units",label:"Cant. Base",align:"right",valueGetter:({row:t})=>{const n=parseFloat(t.quantity_in_base_units);return isNaN(n)?"":n%1===0?n:n.toFixed(2)}},{id:"price",label:"Precio",align:"right",valueGetter:({row:t})=>R(t.price)},{id:"barcode",label:"Código",align:"left"},{id:"actions",label:"Acciones",align:"center"}],[R]),oe=o.useCallback((t,n)=>e.jsx(ze,{hover:!0,role:"checkbox",tabIndex:-1,children:ae.map(c=>{if(c.id==="actions")return e.jsxs(Ee,{align:c.align||"center",children:[e.jsx(J,{title:"Editar Presentación",children:e.jsx(d,{size:"small",color:"info",onClick:()=>ne(n),children:e.jsx(Ve,{fontSize:"small"})})}),e.jsx(J,{title:"Eliminar Presentación",children:e.jsx(d,{size:"small",color:"warning",onClick:()=>be(n),children:e.jsx($e,{fontSize:"small"})})})]},c.id);const l=c.valueGetter?c.valueGetter({row:t}):t[c.id];return e.jsx(Ee,{align:c.align||"center",children:l??""},c.id)})},t.id||n),[ae,ne,be]);return e.jsxs(e.Fragment,{children:[e.jsxs(Re,{children:[G&&e.jsx(Je,{severity:"error",sx:{mb:2},children:G}),e.jsxs(s,{container:!0,spacing:2,sx:{mt:0},justifyContent:"center",children:[e.jsx(s,{sx:{width:"clamp(200px, 15vw, 220px)"},children:e.jsx(x,{inputRef:K,autoFocus:!0,label:"Código de Barras",name:"barcode",value:(a==null?void 0:a.barcode)||"",onChange:ge,onKeyDown:he,inputProps:{maxLength:13},onInput:t=>{t.target.value=t.target.value.toString().slice(0,13)},error:!!v,helperText:v||(V?"Verificando...":""),InputProps:{startAdornment:e.jsx(p,{position:"start",children:V?e.jsx(Se,{size:20}):e.jsx(d,{onClick:()=>ge({target:{name:"barcode",value:""}}),children:e.jsx(g,{color:"error"})})})}})}),e.jsx(s,{sx:{width:"clamp(200px, 15vw, 220px)"},children:e.jsx(x,{label:"Nombre",name:"name",value:(a==null?void 0:a.name)||"",onChange:u,required:!0,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(d,{onClick:()=>u({target:{name:"name",value:""}}),children:e.jsx(g,{color:"error"})})})}})}),e.jsx(s,{sx:{width:"clamp(200px, 20vw, 300px)"},children:e.jsx(x,{label:"Descripción",name:"description",value:(a==null?void 0:a.description)||"",onChange:u,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(d,{onClick:()=>u({target:{name:"description",value:""}}),children:e.jsx(g,{color:"error"})})})}})}),e.jsx(s,{sx:{width:"clamp(200px, 15vw, 220px)"},children:e.jsx(fe,{options:U||[],getOptionLabel:t=>t.name||"",value:(U==null?void 0:U.find(t=>t.id===(a==null?void 0:a.category_id)))||null,onChange:(t,n)=>u({target:{name:"category_id",value:n?n.id:""}}),isOptionEqualToValue:(t,n)=>t.id===n.id,renderInput:t=>e.jsx(x,{...t,label:"Categoría",name:"category_id",required:!0,InputProps:{...t.InputProps,startAdornment:e.jsx(p,{position:"start",children:e.jsx(d,{onClick:()=>u({target:{name:"category_id",value:""}}),children:e.jsx(g,{color:"error"})})})}})})}),e.jsx(s,{sx:{width:"clamp(150px, 10vw, 180px)"},children:e.jsx(x,{label:"Stock",name:"stock",type:"number",value:(a==null?void 0:a.stock)||"",onChange:u,required:!0,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(d,{onClick:()=>u({target:{name:"stock",value:""}}),children:e.jsx(g,{color:"error"})})})}})}),e.jsx(s,{sx:{width:"clamp(200px, 15vw, 220px)"},children:e.jsx(fe,{options:De,getOptionLabel:t=>t.label,value:De.find(t=>t.value===(a==null?void 0:a.tipo_venta))||null,onChange:(t,n)=>u({target:{name:"tipo_venta",value:n?n.value:""}}),isOptionEqualToValue:(t,n)=>t.value===n.value,renderInput:t=>e.jsx(x,{...t,label:"Tipo de Venta",name:"tipo_venta",required:!0,InputProps:{...t.InputProps,startAdornment:e.jsx(p,{position:"start",children:e.jsx(d,{onClick:()=>u({target:{name:"tipo_venta",value:""}}),children:e.jsx(g,{color:"error"})})})}})})}),e.jsx(s,{sx:{width:"clamp(200px, 15vw, 220px)"},children:e.jsx(fe,{options:A||[],getOptionLabel:t=>t.name||"",value:(A==null?void 0:A.find(t=>t.id===(a==null?void 0:a.units_id)))||null,onChange:(t,n)=>u({target:{name:"units_id",value:n?n.id:""}}),isOptionEqualToValue:(t,n)=>t.id===n.id,renderInput:t=>e.jsx(x,{...t,label:"Unidad de medida",name:"units_id",required:!0,InputProps:{...t.InputProps,startAdornment:e.jsx(p,{position:"start",children:e.jsx(d,{onClick:()=>u({target:{name:"units_id",value:""}}),children:e.jsx(g,{color:"error"})})})}})})}),e.jsx(s,{sx:{width:"clamp(200px, 15vw, 220px)"},children:e.jsx(we,{options:Array.isArray($)?$:[],getOptionLabel:t=>typeof t=="string"?t:t.inputValue?t.nombre:t.nombre||"",isOptionEqualToValue:(t,n)=>t.id===n.id,onChange:(t,n)=>{G&&j(""),typeof n=="string"?(W(n),M(!0)):n&&n.inputValue?(W(n.inputValue),M(!0)):u({target:{name:"supplier_id",value:n?n.id:null}})},value:($==null?void 0:$.find(t=>t.id===(a==null?void 0:a.supplier_id)))||null,filterOptions:(t,n)=>{const l=mt({stringify:q=>q.nombre})(t,n),{inputValue:P}=n,T=t.some(q=>P===q.nombre);return P!==""&&!T&&l.push({inputValue:P,nombre:`Agregar "${P}"`}),l},selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,freeSolo:!0,renderOption:(t,n)=>{const{key:c,...l}=t;return e.jsx("li",{...l,children:n.nombre},c)},renderInput:t=>e.jsx(x,{...t,label:"Proveedor",InputProps:{...t.InputProps,startAdornment:e.jsx(p,{position:"start",children:e.jsx(d,{onClick:()=>u({target:{name:"supplier_id",value:""}}),children:e.jsx(g,{color:"error"})})})}})})}),e.jsx(s,{sx:{width:"clamp(200px, 15vw, 220px)"},children:e.jsx(x,{label:"Precio de Compra",name:"cost",type:"number",value:(a==null?void 0:a.cost)||"",onChange:u,required:!0,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(d,{onClick:()=>u({target:{name:"cost",value:""}}),children:e.jsx(g,{color:"error"})})})}})}),e.jsx(s,{sx:{width:"clamp(200px, 15vw, 220px)"},children:e.jsx(x,{label:"Precio de Venta",name:"price",type:"number",value:(a==null?void 0:a.price)||"",onChange:u,required:!0,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(d,{onClick:()=>u({target:{name:"price",value:""}}),children:e.jsx(g,{color:"error"})})})}})}),e.jsx(s,{sx:{width:"clamp(200px, 15vw, 220px)"},children:e.jsx(x,{label:"Stock mínimo",name:"min_stock",type:"number",value:(a==null?void 0:a.min_stock)||"",onChange:u,required:!0,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(d,{onClick:()=>u({target:{name:"min_stock",value:""}}),children:e.jsx(g,{color:"error"})})})}})})]}),e.jsx(xt,{sx:{my:3}}),e.jsx(D,{color:I.palette.text.titlePrimary,variant:"h6",gutterBottom:!0,children:"Presentaciones de Venta"}),e.jsxs(s,{container:!0,spacing:2,justifyContent:"center",alignItems:"center",children:[e.jsx(s,{sx:{width:"clamp(200px, 15vw, 250px)"},children:e.jsx(x,{label:"Nombre Presentación",name:"name",value:(b==null?void 0:b.name)||"",onChange:k,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(d,{onClick:()=>k({target:{name:"name",value:""}}),children:e.jsx(g,{color:"error"})})})}})}),e.jsx(s,{sx:{width:"clamp(200px, 15vw, 250px)"},children:e.jsx(x,{label:"Cantidad en Unidades Base",name:"quantity_in_base_units",type:"number",value:(b==null?void 0:b.quantity_in_base_units)??"",onChange:k,disabled:(a==null?void 0:a.tipo_venta)==="pesable",InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(d,{onClick:()=>k({target:{name:"quantity_in_base_units",value:""}}),children:e.jsx(g,{color:"error"})})}),endAdornment:(a==null?void 0:a.tipo_venta)==="pesable"&&e.jsx(p,{position:"end",children:e.jsx(J,{title:"Para pesables, la cantidad es siempre 1 (ej: 1 horma). El stock se descuenta por peso en la venta.",children:e.jsx(d,{tabIndex:-1,sx:{color:I.palette.info.main},children:e.jsx(ft,{})})})})}})}),e.jsx(s,{sx:{width:"clamp(200px, 15vw, 250px)"},children:e.jsx(x,{label:"Precio Presentación",name:"price",type:"number",value:(b==null?void 0:b.price)||"",onChange:k,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(d,{onClick:()=>k({target:{name:"price",value:""}}),children:e.jsx(g,{color:"error"})})})}})}),e.jsx(s,{sx:{width:"clamp(200px, 15vw, 250px)"},children:e.jsx(x,{label:"Código de Barras (Presentación)",name:"barcode",value:(b==null?void 0:b.barcode)||"",onChange:k,onInput:t=>{t.target.value=t.target.value.toString().slice(0,13)},inputProps:{maxLength:13,readOnly:!0},InputProps:{readOnly:!0,startAdornment:e.jsx(p,{position:"start",children:e.jsx(d,{onClick:()=>k({target:{name:"barcode",value:""}}),children:e.jsx(g,{color:"error"})})}),endAdornment:e.jsx(p,{position:"end",children:e.jsx(J,{title:"Generar Código de Barras",children:e.jsx(d,{onClick:Pe,disabled:ue,children:ue?e.jsx(Se,{size:24}):e.jsx(gt,{})})})})}})}),e.jsx(s,{sx:{width:"clamp(150px, 10vw, 180px)"},children:e.jsx(Z,{variant:"contained",color:"primary",onClick:je,children:F!==null?"Actualizar Presentación":"Agregar Presentación"})})]}),C.length>0&&e.jsxs(X,{sx:{mt:3},children:[e.jsx(D,{variant:"subtitle1",gutterBottom:!0,children:"Presentaciones Agregadas:"}),e.jsx(Ue,{columns:ae,data:C,loading:!1,pagination:!1,renderRow:oe})]})]}),e.jsx(Ze,{children:e.jsxs(s,{container:!0,justifyContent:"flex-end",sx:{mt:2,p:2},children:[e.jsx(Z,{variant:"outlined",color:"secondary",onClick:ve,disabled:S,sx:{padding:"2px 12px",mr:2},children:"Cancelar"}),e.jsx(Z,{variant:"contained",color:"primary",disabled:S,onClick:ye,children:S?e.jsx(Se,{size:24,color:"inherit"}):le?"Actualizar Producto":"Guardar Producto"})]})})]})});Ge.locale("es");const Kt=()=>{const h=Me(),Q=o.useRef(null),[ve,K]=o.useState(!1),[W,M]=o.useState(!1),[Be,R]=o.useState(null),[le,S]=o.useState(0),[I,a]=o.useState(5),[ce,de]=o.useState(0),[m,v,L]=_e({name:"",barcode:"",category_id:"",supplier_id:"",tipo_venta:"",low_stock:!1}),[G,j]=o.useState(""),[Ce,ee]=o.useState(null),C=[{value:"",label:"Todos"},{value:"unitario",label:"Unitario"},{value:"pesable",label:"Pesable"}],[_,b]=o.useState(!1),[k,N]=o.useState(!1),[Y,F]=o.useState(!1),[O,ue]=o.useState(""),[w,pe]=o.useState({barcode:!0,categoryName:!0,name:!0,description:!1,stock:!0,min_stock:!0,unitName:!1,tipo_venta:!0,supplierName:!1,updatedAt:!0,cost:!1,price:!0,actions:!0}),[z,U]=o.useState(null),te=o.useCallback(()=>{N(!1),M(!1),R(null)},[N,M,R]),{data:A,isLoading:Te}=ie("categories","/category",!0,0,{keepPreviousData:!0}),{data:$,isLoading:qe}=Ie("units","/units"),{data:E,isLoading:ke,refetch:re}=ie("suppliers","/suppliers",!0,0,{keepPreviousData:!0}),V=new URLSearchParams({page:le+1,limit:I,...m.name&&{name:m.name},...m.barcode&&{barcode:m.barcode},...m.category_id&&{category_id:m.category_id},...m.supplier_id&&{supplier_id:m.supplier_id},...m.tipo_venta&&{tipo_venta:m.tipo_venta},...m.low_stock&&{low_stock:m.low_stock}}).toString(),{data:B,isLoading:me,refetch:H}=Ie(["stock",V],`/stock?${V}`,!0),{mutateAsync:xe,isLoading:u}=et("newProductStock"),{mutateAsync:ge,isLoading:he}=tt("updateProductStock"),{mutateAsync:Pe,isLoading:je}=ht("deleteProductStock");o.useEffect(()=>{var r;B&&de(((r=B.pagination)==null?void 0:r.total)||0)},[B]),o.useEffect(()=>{K(u||he||je)},[u,he,je]),o.useEffect(()=>{if(k){const r=setTimeout(()=>{Q.current&&Q.current.focus()},300);return()=>clearTimeout(r)}},[k]);const ne=(r=null)=>{r?(M(!0),R(r)):(M(!1),R(null)),N(!0)},be=r=>{if(r.key==="Enter"){r.preventDefault();const i=r.target.value.trim();i&&ee(i)}},ye=async r=>{var i,y;try{let f="";W?(await ge({url:`/upstock/${r.id}`,datos:r}),f="Producto actualizado con éxito!"):(await xe({url:"/stock",values:r}),f="Producto guardado con éxito!"),te(),H(),Ae(f,h)}catch(f){Le(((y=(i=f.response)==null?void 0:i.data)==null?void 0:y.message)||"Hubo un error al guardar el producto.",h)}},ae=r=>{jt(async()=>{var i,y;try{await Pe({url:`/stock/${r.id}`}),Ae("Producto eliminado con éxito!",h),H()}catch(f){Le(((y=(i=f.response)==null?void 0:i.data)==null?void 0:y.message)||"Hubo un error al eliminar el producto.",h)}})},oe=o.useMemo(()=>[{id:"barcode",label:"Código",align:"center"},{id:"name",label:"Producto",align:"center"},{id:"description",label:"Descripción",align:"center"},{id:"categoryName",label:"Categoría",align:"center"},{id:"stock",label:"Stock",align:"center",valueGetter:({row:r})=>n(r.stock,r.tipo_venta)},{id:"min_stock",label:"Mínimo",align:"center",valueGetter:({row:r})=>n(r.min_stock,r.tipo_venta)},{id:"unitName",label:"Medida",align:"center"},{id:"tipo_venta",label:"Tipo Venta",align:"center"},{id:"supplierName",label:"Proveedor",align:"center"},{id:"price",label:"Precio Venta",align:"center",valueGetter:({row:r})=>c(r.price)},{id:"cost",label:"Costo",align:"center",valueGetter:({row:r})=>c(r.cost)},{id:"updatedAt",label:"Actualizado",align:"center",valueGetter:({row:r})=>Ge(r.updatedAt).format("DD/MM/YYYY")},{id:"actions",label:"Acciones",align:"center",valueGetter:({row:r})=>e.jsxs(e.Fragment,{children:[e.jsx(J,{title:"Editar Producto",children:e.jsx(d,{size:"small",color:"info",onClick:()=>ne(r),children:e.jsx(Ve,{fontSize:"small"})})}),e.jsx(J,{title:"Eliminar Producto",children:e.jsx(d,{size:"small",color:"warning",onClick:()=>ae(r),children:e.jsx($e,{fontSize:"small"})})})]})}],[]),t=o.useMemo(()=>oe.filter(r=>w[r.id]),[oe,w]),n=(r,i)=>{const y=parseFloat(r);return isNaN(y)?"":i==="pesable"?y.toLocaleString("es-AR",{minimumFractionDigits:2,maximumFractionDigits:2}):y.toLocaleString("es-AR",{maximumFractionDigits:2})},c=r=>{const i=parseFloat(r);return isNaN(i)?"":i.toLocaleString("es-AR",{minimumFractionDigits:2,maximumFractionDigits:2})},l=(r,i)=>{S(i)},P=r=>{a(parseInt(r.target.value,10)),S(0)},T=(r,i)=>{const y=parseFloat(r.stock),f=parseFloat(r.min_stock),He=!isNaN(y)&&!isNaN(f)&&f>0&&y<=f;return e.jsx(ze,{hover:!0,role:"checkbox",tabIndex:-1,children:t.map(se=>{const Qe=se.valueGetter?se.valueGetter({row:r}):r[se.id];return e.jsx(Ee,{align:se.align||"center",sx:He?{color:h.palette.warning.dark}:{},children:Qe},se.id)})},r.id||i)},q=me||Te||qe||ke;return e.jsxs(X,{sx:{p:1},children:[e.jsx(rt,{elevation:3,sx:{p:{xs:2,sm:3},mb:3,mt:2,background:r=>r.palette.background.componentHeaderBackground,color:h.palette.primary.contrastText},children:e.jsxs(s,{container:!0,justifyContent:"space-between",alignItems:"center",children:[e.jsxs(s,{children:[e.jsx(D,{variant:"h4",gutterBottom:!0,children:"Gestión de Productos"}),e.jsx(D,{variant:"body1",sx:{opacity:.9},children:"Administra el inventario de tu negocio"})]}),e.jsx(s,{children:e.jsx(Z,{variant:"outlined",color:"primary",onClick:()=>ne(),startIcon:e.jsx(lt,{}),children:"Nuevo Producto"})})]})}),e.jsxs(Ne,{sx:{p:2,mb:3},children:[e.jsxs(s,{container:!0,justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[e.jsx(D,{variant:"h6",children:"Herramientas y Filtros"}),e.jsx(d,{disableRipple:!0,size:"small",onClick:()=>b(!_),sx:{p:0},children:e.jsx(bt,{sx:{transition:"0.5s",transform:_?"rotate(-180deg)":"rotate(0)",backgroundColor:"primary.main",color:"primary.contrastText",borderRadius:"50%"}})})]}),e.jsx(X,{sx:{height:_?"auto":0,overflow:"hidden",transition:"height 0.3s ease-in-out"},children:e.jsxs(s,{container:!0,spacing:2,justifyContent:"center",alignItems:"flex-start",children:[e.jsx(s,{xs:12,md:3,children:e.jsxs(X,{sx:{border:`1px solid ${h.palette.divider}`,borderRadius:1,p:2,height:"100%"},children:[e.jsx(D,{variant:"subtitle1",gutterBottom:!0,children:"Edición Rápida"}),e.jsx(x,{label:"Escanear Código para Editar",value:G,onChange:r=>j(r.target.value),onKeyDown:be,onInput:r=>{r.target.value=r.target.value.toString().slice(0,13)},inputProps:{maxLength:13},InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(pt,{})}),endAdornment:e.jsx(p,{position:"end",children:e.jsx(d,{onClick:()=>j(""),children:e.jsx(g,{color:"error"})})})}})]})}),e.jsx(s,{xs:12,md:9,children:e.jsxs(X,{sx:{border:`1px solid ${h.palette.divider}`,borderRadius:1,p:2,height:"100%"},children:[e.jsx(D,{variant:"subtitle1",gutterBottom:!0,children:"Filtrar Tabla"}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsx(s,{xs:12,sm:6,md:4,children:e.jsx(x,{label:"Nombre",name:"name",value:m.name||"",onChange:r=>{v(r),S(0)},InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(d,{onClick:()=>v({target:{name:"name",value:""}}),children:e.jsx(g,{color:"error"})})})}})}),e.jsx(s,{xs:12,sm:6,md:4,children:e.jsx(x,{label:"Código de Barras",name:"barcode",value:m.barcode||"",onChange:r=>{v(r),S(0)},InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(d,{onClick:()=>v({target:{name:"barcode",value:""}}),children:e.jsx(g,{color:"error"})})})}})}),e.jsx(s,{xs:12,sm:6,md:4,children:e.jsx(we,{options:Array.isArray(A)?A:[],getOptionLabel:r=>r.name||"",isOptionEqualToValue:(r,i)=>r.id===i.id,onChange:(r,i)=>{v({target:{name:"category_id",value:i?i.id:""}}),S(0)},value:(A==null?void 0:A.find(r=>r.id===m.category_id))||null,renderInput:r=>e.jsx(x,{...r,label:"Categoría",InputProps:{...r.InputProps,startAdornment:e.jsx(p,{position:"start",children:e.jsx(d,{onClick:()=>v({target:{name:"category_id",value:""}}),children:e.jsx(g,{color:"error"})})})}})})}),e.jsx(s,{xs:12,sm:6,md:4,children:e.jsx(we,{options:Array.isArray(E)?E:[],getOptionLabel:r=>r.nombre||"",isOptionEqualToValue:(r,i)=>r.id===i.id,onChange:(r,i)=>{v({target:{name:"supplier_id",value:i?i.id:""}}),S(0)},value:(E==null?void 0:E.find(r=>r.id===m.supplier_id))||null,renderInput:r=>e.jsx(x,{...r,label:"Proveedor",InputProps:{...r.InputProps,startAdornment:e.jsx(p,{position:"start",children:e.jsx(d,{onClick:()=>v({target:{name:"supplier_id",value:""}}),children:e.jsx(g,{color:"error"})})})}})})}),e.jsx(s,{xs:12,sm:6,md:4,children:e.jsx(fe,{options:C,getOptionLabel:r=>r.label,value:C.find(r=>r.value===m.tipo_venta)||null,onChange:(r,i)=>{v({target:{name:"tipo_venta",value:i?i.value:""}}),S(0)},isOptionEqualToValue:(r,i)=>r.value===i.value,renderInput:r=>e.jsx(x,{...r,label:"Tipo de Venta",name:"tipo_venta",InputProps:{...r.InputProps,startAdornment:e.jsx(p,{position:"start",children:e.jsx(d,{onClick:()=>v({target:{name:"tipo_venta",value:""}}),children:e.jsx(g,{color:"error"})})})}})})}),e.jsx(s,{xs:12,sm:6,md:4,children:e.jsx(Fe,{control:e.jsx(Oe,{checked:m.low_stock||!1,onChange:r=>v({target:{name:"low_stock",value:r.target.checked}})}),label:"Mostrar solo con stock bajo"})}),e.jsx(s,{xs:12,sm:6,md:4,sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Z,{variant:"outlined",color:"secondary",onClick:()=>{L(),S(0)},children:"Limpiar Filtros"})})]})]})})]})})]}),e.jsxs(Ne,{sx:{p:2},children:[e.jsxs(s,{container:!0,justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[e.jsx(s,{children:e.jsx(D,{variant:"h6",gutterBottom:!0,children:"Listado de Productos"})}),e.jsxs(s,{children:[e.jsx(Z,{"aria-controls":"columns-menu","aria-haspopup":"true",onClick:r=>U(r.currentTarget),variant:"outlined",children:"Mostrar/Ocultar Columnas"}),e.jsx(nt,{id:"columns-menu",anchorEl:z,keepMounted:!0,open:!!z,onClose:()=>U(null),children:oe.map(r=>r.id!=="actions"&&e.jsx(it,{children:e.jsx(Fe,{control:e.jsx(Oe,{checked:!!w[r.id],onChange:i=>{pe({...w,[r.id]:i.target.checked})}}),label:r.label})},r.id))})]})]}),e.jsx(Ue,{columns:t,data:(B==null?void 0:B.products)||[],loading:q,count:ce,page:le,rowsPerPage:I,onPageChange:l,onRowsPerPageChange:P,renderRow:T})]}),e.jsxs(at,{open:k,onClose:te,maxWidth:"lg",fullWidth:!0,children:[e.jsxs(ot,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:"background.dialog",color:"text.primary"},children:[W?"Editar Producto":"Nuevo Producto",e.jsx(d,{onClick:te,children:e.jsx(st,{color:"error"})})]}),e.jsx(Re,{sx:{p:0,backgroundColor:"background.paper"},children:e.jsx(X,{sx:{backgroundColor:"background.dialog",p:3},children:e.jsx(vt,{initialProduct:Be,onSaveProduct:ye,onCancel:te,barcodeInputRef:Q,categoriesData:A,unitsData:$,suppliersData:E,refetchSuppliers:re,setNewSupplierName:ue,setSupplierDialogOpen:F,formatCurrency:c,updating:W,guardando:ve})})})]}),e.jsx(ct,{open:Y,handleClose:()=>F(!1),initialName:O,onSupplierAdded:r=>{re(),handleInputChange({target:{name:"supplier_id",value:r.id}}),F(!1)}})]})};export{Kt as default};
