import{W as w,X as B,j as t,a as _,b as A,r,o as d,U as G,m as L,P as y,T as p,h as v,i as D,I as C,l as b,B as O}from"./index-C4A7YWMW.js";import{S as W}from"./StyledCard-fRo-XxED.js";import{d as F}from"./Clear-CkvqAIGR.js";import{E as z}from"./EnhancedTable-BX9li6wm.js";import{v as E}from"./variants-CUQepozP.js";import{G as n}from"./Grid2-BbvPN--I.js";import"./Card-DZlrFGgg.js";import"./TableRow-BsCYnncP.js";import"./TableBody-Bv-WiDt9.js";import"./useThemeProps-D8tK1Axd.js";var x={},Q=w;Object.defineProperty(x,"__esModule",{value:!0});var S=x.default=void 0,N=Q(B()),q=t;S=x.default=(0,N.default)((0,q.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search");function rt(){const o=_(),M=A(o.breakpoints.down("sm")),[c,h]=r.useState(0),[l,P]=r.useState(5),[i,u]=r.useState({startDate:d().startOf("month").format("YYYY-MM-DD"),endDate:d().endOf("day").format("YYYY-MM-DD")}),{data:a,isLoading:Y,refetch:I}=G("profitMarginData",`/reports/profit-margin?startDate=${i.startDate}&endDate=${i.endDate}`,!1),f=e=>{u(s=>({...s,[e.target.name]:e.target.value}))},g=e=>{u(s=>({...s,[e]:""}))},$=()=>{I()},k=()=>{u({startDate:d().startOf("month").format("YYYY-MM-DD"),endDate:d().endOf("day").format("YYYY-MM-DD")})},R=r.useMemo(()=>[{id:"productName",label:"Producto"},{id:"totalQuantitySold",label:"Cantidad Vendida"},{id:"totalCost",label:"Costo Total"},{id:"totalSales",label:"Venta Total"},{id:"profit",label:"Ganancia",valueGetter:({row:e})=>parseFloat(e.profit||0),cellStyle:e=>({color:parseFloat(e.profit||0)>=0?o.palette.success.main:o.palette.error.main,fontWeight:"bold"}),format:e=>`$ ${parseFloat(e||0).toFixed(2)}`}],[o.palette]),m=r.useMemo(()=>!a||!Array.isArray(a.report)?[]:a.report.map(e=>({productName:e.productName,totalQuantitySold:e.totalQuantitySold,totalCost:`$ ${parseFloat(e.totalCost||0).toFixed(2)}`,totalSales:`$ ${parseFloat(e.totalRevenue||0).toFixed(2)}`,profit:parseFloat(e.totalProfit||0)})),[a]),T=r.useMemo(()=>{const e=c*l;return m.slice(e,e+l)},[m,c,l]),j=r.useMemo(()=>!a||!a.summary?0:parseFloat(a.summary.overallProfit||0),[a]);return t.jsxs(L.div,{initial:"hidden",animate:"enter",exit:"exit",variants:E,transition:{duration:1.5,type:"easeInOut"},className:"relative",children:[t.jsxs(y,{elevation:3,sx:{p:{xs:2,sm:3},mb:3,mt:2,background:e=>e.palette.background.componentHeaderBackground,color:o.palette.primary.contrastText},children:[t.jsx(p,{variant:M?"h5":"h4",gutterBottom:!0,children:"Reporte de MÃ¡rgenes de Ganancia"}),t.jsx(p,{variant:"body1",sx:{opacity:.9},children:"Consulta la ganancia de tus productos en un rango de fechas."})]}),t.jsx(W,{elevation:2,sx:{p:2,mb:3},children:t.jsxs(n,{container:!0,spacing:2,sx:{justifyContent:"center",padding:2},children:[t.jsx(n,{sx:{width:"clamp(250px, 30%, 400px)"},children:t.jsx(v,{label:"Fecha Desde",type:"date",name:"startDate",value:i.startDate,onChange:f,fullWidth:!0,InputLabelProps:{shrink:!0},InputProps:{startAdornment:t.jsx(D,{position:"start",children:t.jsx(C,{size:"small",onClick:()=>g("startDate"),children:t.jsx(F,{fontSize:"small",color:"error"})})})}})}),t.jsx(n,{sx:{width:"clamp(250px, 30%, 400px)"},children:t.jsx(v,{label:"Fecha Hasta",type:"date",name:"endDate",value:i.endDate,onChange:f,fullWidth:!0,InputLabelProps:{shrink:!0},InputProps:{startAdornment:t.jsx(D,{position:"start",children:t.jsx(C,{size:"small",onClick:()=>g("endDate"),children:t.jsx(F,{fontSize:"small",color:"error"})})})}})}),t.jsx(n,{sx:{width:"clamp(200px, 20%, 300px)",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx(b,{variant:"contained",color:"primary",onClick:$,startIcon:t.jsx(S,{}),fullWidth:!0,children:"Consultar"})}),t.jsx(n,{sx:{width:"clamp(200px, 20%, 300px)",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx(b,{variant:"outlined",color:"secondary",onClick:k,fullWidth:!0,children:"Limpiar Filtros"})})]})}),t.jsxs(y,{elevation:2,sx:{p:2,mb:3},children:[t.jsx(p,{variant:"h6",gutterBottom:!0,sx:{mb:2},children:"Resultados del Reporte"}),t.jsx(z,{columns:R,data:T,loading:Y,count:m.length,page:c,rowsPerPage:l,onPageChange:(e,s)=>h(s),onRowsPerPageChange:e=>{P(parseInt(e.target.value,10)),h(0)}}),t.jsx(O,{sx:{mt:3,p:2,borderTop:`1px solid ${o.palette.divider}`,display:"flex",justifyContent:"flex-end"},children:t.jsxs(p,{variant:"h6",children:["Ganancia Total: ",t.jsx("span",{style:{color:j>=0?"green":"red"},children:`$ ${j.toFixed(2)}`})]})})]})]})}export{rt as default};
