import{E as ea,z as ta,_ as ut,a6 as la,H as U,d as _e,j as e,r,F as aa,a7 as da,J as Fe,K as pt,L as be,N as sa,a8 as ca,O as ge,U as He,w as Ie,A as na,a9 as pa,f as Wt,y as ua,x as tt,a as xa,b as Bt,u as ha,e as ma,R as Tt,B as v,I as y,m as at,P as ga,T as c,l as H,G as i,h as D,i as W,p as N,S as Se,D as ke,q as ja,g as ze,Y as st,k as $e,s as nt,aa as ba,ab as ya,ac as fa}from"./index-C4A7YWMW.js";import{S as De}from"./StyledCard-fRo-XxED.js";import{L as wt,F as Ht,E as va,M as je}from"./EnhancedTable-BX9li6wm.js";import{M as Ca}from"./MyFab-Dn2qIpS2.js";import{u as Pa}from"./useDelete-DGUJ3i20.js";import{d as Sa,S as ka}from"./Debounce-BcbV65M7.js";import{T as V}from"./Tooltip-DOLZfSzw.js";import{V as rt,H as Vt}from"./Visibility-DHbT0-LS.js";import{E as Ut}from"./Edit-B8GMNmyj.js";import{D as Gt,A as za}from"./Delete-BbxDntt0.js";import{K as $a}from"./KeyboardArrowDown-BYcTFmFP.js";import{A as it}from"./Autocomplete-okLxTLSl.js";import{D as Da}from"./Download-BcTDWGmv.js";import{P as Ia}from"./Person-CvRHMCEB.js";import{C as qt}from"./Chip-Bc7mlkaj.js";import{L as ot,a as lt}from"./ListItemText-DgPH-Vm9.js";import{C as dt}from"./CardContent-BDn6Cs8S.js";import{S as Qt}from"./Stack-DYQPukkq.js";import{P as we}from"./Print-CaR48mkG.js";import{D as _a}from"./Divider-DlgemNlS.js";import{S as Kt}from"./Snackbar-_OKSHQB7.js";import"./Card-DZlrFGgg.js";import"./TableRow-BsCYnncP.js";import"./TableBody-Bv-WiDt9.js";import"./Popper-ijWchD3c.js";import"./useThemeProps-D8tK1Axd.js";function Fa(a){return ea("MuiPagination",a)}ta("MuiPagination",["root","ul","outlined","text"]);const Ea=["boundaryCount","componentName","count","defaultPage","disabled","hideNextButton","hidePrevButton","onChange","page","showFirstButton","showLastButton","siblingCount"];function La(a={}){const{boundaryCount:s=1,componentName:o="usePagination",count:p=1,defaultPage:n=1,disabled:h=!1,hideNextButton:u=!1,hidePrevButton:f=!1,onChange:C,page:L,showFirstButton:A=!1,showLastButton:G=!1,siblingCount:z=1}=a,I=ut(a,Ea),[k,te]=la({controlled:L,default:n,name:o,state:"page"}),B=(b,w)=>{L||te(w),C&&C(b,w)},m=(b,w)=>{const q=w-b+1;return Array.from({length:q},(ae,g)=>b+g)},l=m(1,Math.min(s,p)),P=m(Math.max(p-s+1,s+1),p),d=Math.max(Math.min(k-z,p-s-z*2-1),s+2),R=Math.min(Math.max(k+z,s+z*2+2),P.length>0?P[0]-2:p-1),J=[...A?["first"]:[],...f?[]:["previous"],...l,...d>s+2?["start-ellipsis"]:s+1<p-s?[s+1]:[],...m(d,R),...R<p-s-1?["end-ellipsis"]:p-s>s?[p-s]:[],...P,...u?[]:["next"],...G?["last"]:[]],F=b=>{switch(b){case"first":return 1;case"previous":return k-1;case"next":return k+1;case"last":return p;default:return null}},T=J.map(b=>typeof b=="number"?{onClick:w=>{B(w,b)},type:"page",page:b,selected:b===k,disabled:h,"aria-current":b===k?"true":void 0}:{onClick:w=>{B(w,F(b))},type:b,page:F(b),selected:!1,disabled:h||b.indexOf("ellipsis")===-1&&(b==="next"||b==="last"?k>=p:k<=1)});return U({items:T},I)}function Aa(a){return ea("MuiPaginationItem",a)}const ee=ta("MuiPaginationItem",["root","page","sizeSmall","sizeLarge","text","textPrimary","textSecondary","outlined","outlinedPrimary","outlinedSecondary","rounded","ellipsis","firstLast","previousNext","focusVisible","disabled","selected","icon","colorPrimary","colorSecondary"]),Yt=_e(e.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"}),"NavigateBefore"),Jt=_e(e.jsx("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}),"NavigateNext"),Ra=["className","color","component","components","disabled","page","selected","shape","size","slots","type","variant"],ra=(a,s)=>{const{ownerState:o}=a;return[s.root,s[o.variant],s[`size${be(o.size)}`],o.variant==="text"&&s[`text${be(o.color)}`],o.variant==="outlined"&&s[`outlined${be(o.color)}`],o.shape==="rounded"&&s.rounded,o.type==="page"&&s.page,(o.type==="start-ellipsis"||o.type==="end-ellipsis")&&s.ellipsis,(o.type==="previous"||o.type==="next")&&s.previousNext,(o.type==="first"||o.type==="last")&&s.firstLast]},Na=a=>{const{classes:s,color:o,disabled:p,selected:n,size:h,shape:u,type:f,variant:C}=a,L={root:["root",`size${be(h)}`,C,u,o!=="standard"&&`color${be(o)}`,o!=="standard"&&`${C}${be(o)}`,p&&"disabled",n&&"selected",{page:"page",first:"firstLast",last:"firstLast","start-ellipsis":"ellipsis","end-ellipsis":"ellipsis",previous:"previousNext",next:"previousNext"}[f]],icon:["icon"]};return sa(L,Aa,s)},Ma=Fe("div",{name:"MuiPaginationItem",slot:"Root",overridesResolver:ra})(({theme:a,ownerState:s})=>U({},a.typography.body2,{borderRadius:32/2,textAlign:"center",boxSizing:"border-box",minWidth:32,padding:"0 6px",margin:"0 3px",color:(a.vars||a).palette.text.primary,height:"auto",[`&.${ee.disabled}`]:{opacity:(a.vars||a).palette.action.disabledOpacity}},s.size==="small"&&{minWidth:26,borderRadius:26/2,margin:"0 1px",padding:"0 4px"},s.size==="large"&&{minWidth:40,borderRadius:40/2,padding:"0 10px",fontSize:a.typography.pxToRem(15)})),Oa=Fe(ca,{name:"MuiPaginationItem",slot:"Root",overridesResolver:ra})(({theme:a,ownerState:s})=>U({},a.typography.body2,{borderRadius:32/2,textAlign:"center",boxSizing:"border-box",minWidth:32,height:32,padding:"0 6px",margin:"0 3px",color:(a.vars||a).palette.text.primary,[`&.${ee.focusVisible}`]:{backgroundColor:(a.vars||a).palette.action.focus},[`&.${ee.disabled}`]:{opacity:(a.vars||a).palette.action.disabledOpacity},transition:a.transitions.create(["color","background-color"],{duration:a.transitions.duration.short}),"&:hover":{backgroundColor:(a.vars||a).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${ee.selected}`]:{backgroundColor:(a.vars||a).palette.action.selected,"&:hover":{backgroundColor:a.vars?`rgba(${a.vars.palette.action.selectedChannel} / calc(${a.vars.palette.action.selectedOpacity} + ${a.vars.palette.action.hoverOpacity}))`:ge(a.palette.action.selected,a.palette.action.selectedOpacity+a.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:(a.vars||a).palette.action.selected}},[`&.${ee.focusVisible}`]:{backgroundColor:a.vars?`rgba(${a.vars.palette.action.selectedChannel} / calc(${a.vars.palette.action.selectedOpacity} + ${a.vars.palette.action.focusOpacity}))`:ge(a.palette.action.selected,a.palette.action.selectedOpacity+a.palette.action.focusOpacity)},[`&.${ee.disabled}`]:{opacity:1,color:(a.vars||a).palette.action.disabled,backgroundColor:(a.vars||a).palette.action.selected}}},s.size==="small"&&{minWidth:26,height:26,borderRadius:26/2,margin:"0 1px",padding:"0 4px"},s.size==="large"&&{minWidth:40,height:40,borderRadius:40/2,padding:"0 10px",fontSize:a.typography.pxToRem(15)},s.shape==="rounded"&&{borderRadius:(a.vars||a).shape.borderRadius}),({theme:a,ownerState:s})=>U({},s.variant==="text"&&{[`&.${ee.selected}`]:U({},s.color!=="standard"&&{color:(a.vars||a).palette[s.color].contrastText,backgroundColor:(a.vars||a).palette[s.color].main,"&:hover":{backgroundColor:(a.vars||a).palette[s.color].dark,"@media (hover: none)":{backgroundColor:(a.vars||a).palette[s.color].main}},[`&.${ee.focusVisible}`]:{backgroundColor:(a.vars||a).palette[s.color].dark}},{[`&.${ee.disabled}`]:{color:(a.vars||a).palette.action.disabled}})},s.variant==="outlined"&&{border:a.vars?`1px solid rgba(${a.vars.palette.common.onBackgroundChannel} / 0.23)`:`1px solid ${a.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,[`&.${ee.selected}`]:U({},s.color!=="standard"&&{color:(a.vars||a).palette[s.color].main,border:`1px solid ${a.vars?`rgba(${a.vars.palette[s.color].mainChannel} / 0.5)`:ge(a.palette[s.color].main,.5)}`,backgroundColor:a.vars?`rgba(${a.vars.palette[s.color].mainChannel} / ${a.vars.palette.action.activatedOpacity})`:ge(a.palette[s.color].main,a.palette.action.activatedOpacity),"&:hover":{backgroundColor:a.vars?`rgba(${a.vars.palette[s.color].mainChannel} / calc(${a.vars.palette.action.activatedOpacity} + ${a.vars.palette.action.focusOpacity}))`:ge(a.palette[s.color].main,a.palette.action.activatedOpacity+a.palette.action.focusOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${ee.focusVisible}`]:{backgroundColor:a.vars?`rgba(${a.vars.palette[s.color].mainChannel} / calc(${a.vars.palette.action.activatedOpacity} + ${a.vars.palette.action.focusOpacity}))`:ge(a.palette[s.color].main,a.palette.action.activatedOpacity+a.palette.action.focusOpacity)}},{[`&.${ee.disabled}`]:{borderColor:(a.vars||a).palette.action.disabledBackground,color:(a.vars||a).palette.action.disabled}})})),Wa=Fe("div",{name:"MuiPaginationItem",slot:"Icon",overridesResolver:(a,s)=>s.icon})(({theme:a,ownerState:s})=>U({fontSize:a.typography.pxToRem(20),margin:"0 -8px"},s.size==="small"&&{fontSize:a.typography.pxToRem(18)},s.size==="large"&&{fontSize:a.typography.pxToRem(22)})),Ba=r.forwardRef(function(s,o){const p=aa({props:s,name:"MuiPaginationItem"}),{className:n,color:h="standard",component:u,components:f={},disabled:C=!1,page:L,selected:A=!1,shape:G="circular",size:z="medium",slots:I={},type:k="page",variant:te="text"}=p,B=ut(p,Ra),m=U({},p,{color:h,disabled:C,selected:A,shape:G,size:z,type:k,variant:te}),l=da(),P=Na(m),R=(l?{previous:I.next||f.next||Jt,next:I.previous||f.previous||Yt,last:I.first||f.first||Ht,first:I.last||f.last||wt}:{previous:I.previous||f.previous||Yt,next:I.next||f.next||Jt,first:I.first||f.first||Ht,last:I.last||f.last||wt})[k];return k==="start-ellipsis"||k==="end-ellipsis"?e.jsx(Ma,{ref:o,ownerState:m,className:pt(P.root,n),children:"…"}):e.jsxs(Oa,U({ref:o,ownerState:m,component:u,disabled:C,className:pt(P.root,n)},B,{children:[k==="page"&&L,R?e.jsx(Wa,{as:R,ownerState:m,className:P.icon}):null]}))}),Ta=["boundaryCount","className","color","count","defaultPage","disabled","getItemAriaLabel","hideNextButton","hidePrevButton","onChange","page","renderItem","shape","showFirstButton","showLastButton","siblingCount","size","variant"],wa=a=>{const{classes:s,variant:o}=a;return sa({root:["root",o],ul:["ul"]},Fa,s)},Ha=Fe("nav",{name:"MuiPagination",slot:"Root",overridesResolver:(a,s)=>{const{ownerState:o}=a;return[s.root,s[o.variant]]}})({}),Va=Fe("ul",{name:"MuiPagination",slot:"Ul",overridesResolver:(a,s)=>s.ul})({display:"flex",flexWrap:"wrap",alignItems:"center",padding:0,margin:0,listStyle:"none"});function Ua(a,s,o){return a==="page"?`${o?"":"Go to "}page ${s}`:`Go to ${a} page`}const Xt=r.forwardRef(function(s,o){const p=aa({props:s,name:"MuiPagination"}),{boundaryCount:n=1,className:h,color:u="standard",count:f=1,defaultPage:C=1,disabled:L=!1,getItemAriaLabel:A=Ua,hideNextButton:G=!1,hidePrevButton:z=!1,renderItem:I=T=>e.jsx(Ba,U({},T)),shape:k="circular",showFirstButton:te=!1,showLastButton:B=!1,siblingCount:m=1,size:l="medium",variant:P="text"}=p,d=ut(p,Ta),{items:R}=La(U({},p,{componentName:"Pagination"})),J=U({},p,{boundaryCount:n,color:u,count:f,defaultPage:C,disabled:L,getItemAriaLabel:A,hideNextButton:G,hidePrevButton:z,renderItem:I,shape:k,showFirstButton:te,showLastButton:B,siblingCount:m,size:l,variant:P}),F=wa(J);return e.jsx(Ha,U({"aria-label":"pagination navigation",className:pt(F.root,h),ownerState:J,ref:o},d,{children:e.jsx(Va,{className:F.ul,ownerState:J,children:R.map((T,b)=>e.jsx("li",{children:I(U({},T,{color:u,"aria-label":A(T.type,T.page,T.selected),shape:k,size:l,variant:P}))},b))})}))}),Ga=_e(e.jsx("path",{d:"M4 10h3v7H4zm6.5 0h3v7h-3zM2 19h20v3H2zm15-9h3v7h-3zm-5-9L2 6v2h20V6z"}),"AccountBalance"),Zt=_e(e.jsx("path",{d:"M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2m0 14H4v-6h16zm0-10H4V6h16z"}),"Payment"),qa=_e(e.jsx("path",{d:"M18 17H6v-2h12zm0-4H6v-2h12zm0-4H6V7h12zM3 22l1.5-1.5L6 22l1.5-1.5L9 22l1.5-1.5L12 22l1.5-1.5L15 22l1.5-1.5L18 22l1.5-1.5L21 22V2l-1.5 1.5L18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2 7.5 3.5 6 2 4.5 3.5 3 2z"}),"Receipt"),ct=(a,s,o="")=>{var h;const p=window.open("","_blank");let n="<html><head><title>Recibo</title>";if(n+="<style>",n+="body { font-family: Arial, sans-serif; margin: 20px; font-size: 12px; }",n+="h1, h2, h3 { text-align: center; margin-bottom: 10px; }",n+="table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }",n+="th, td { border: 1px solid #ddd; padding: 5px; text-align: left; }",n+="th { background-color: #f2f2f2; }",n+=".text-right { text-align: right; }",n+=".text-center { text-align: center; }",n+=".header { margin-bottom: 20px; }",n+=".footer { margin-top: 30px; text-align: center; font-size: 10px; }",n+="@media print { .no-print { display: none; } }",n+="</style>",n+="</head><body>",s==="sale"){const u=a;n+=`<h1>Recibo de Venta #${u.id}</h1>`,n+='<div class="header">',n+=`<p><strong>Cliente:</strong> ${o||"Consumidor Final"}</p>`,n+=`<p><strong>Fecha:</strong> ${new Date(u.createdAt).toLocaleDateString()}</p>`,u.sale_payments&&u.sale_payments.length>1?(n+="<p><strong>Métodos de Pago:</strong></p><ul>",u.sale_payments.forEach(f=>{var C;n+=`<li>${(C=f.payment)==null?void 0:C.method}: ${parseFloat(f.amount).toFixed(2)}</li>`}),n+="</ul>"):u.sale_payments&&u.sale_payments.length===1&&(n+=`<p><strong>Método de Pago:</strong> ${(h=u.sale_payments[0].payment)==null?void 0:h.method}</p>`),n+=`<p><strong>Total Neto:</strong> ${parseFloat(u.total_neto).toFixed(2)}</p>`,n+="</div>",n+="<h3>Productos</h3>",n+="<table>",n+='<thead><tr><th>Producto</th><th class="text-center">Cant.</th><th class="text-right">Precio Unit.</th><th class="text-right">Subtotal</th></tr></thead>',n+="<tbody>",u.sale_details.forEach(f=>{var C;n+="<tr>",n+=`<td>${((C=f.stock)==null?void 0:C.name)||"Producto Desconocido"}</td>`,n+=`<td class="text-center">${f.quantity}</td>`,n+=`<td class="text-right">${parseFloat(f.price).toFixed(2)}</td>`,n+=`<td class="text-right">${(f.quantity*f.price).toFixed(2)}</td>`,n+="</tr>"}),n+="</tbody>",n+="</table>",n+=`<div class="text-right"><strong>Total: ${parseFloat(u.total_neto).toFixed(2)}</strong></div>`}else if(s==="payment"){const u=a;n+=`<h1>Recibo de Pago #${u.id}</h1>`,n+='<div class="header">',n+=`<p><strong>Cliente:</strong> ${o||"N/A"}</p>`,n+=`<p><strong>Fecha:</strong> ${new Date(u.payment_date).toLocaleDateString()}</p>`,n+=`<p><strong>Monto:</strong> ${parseFloat(u.amount).toFixed(2)}</p>`,n+=`<p><strong>Método de Pago:</strong> ${u.payment_method}</p>`,u.notes&&(n+=`<p><strong>Notas:</strong> ${u.notes}</p>`),n+="</div>"}n+='<div class="footer"><p>Gracias por su compra/pago.</p></div>',n+="</body></html>",p.document.write(n),p.document.close(),p.focus(),p.print(),p.onafterprint=function(){p.close()},setTimeout(()=>{p.closed||p.close()},500)},Qa=a=>{var q,ae;const[s,o]=r.useState([]),[p,n]=r.useState([]),[h,u]=r.useState({purchases:{page:1,limit:5,start_date:"",end_date:"",totalPages:1,totalItems:0},payments:{page:1,limit:5,start_date:"",end_date:"",totalPages:1,totalItems:0}}),[f,C]=r.useState(!1),[L,A]=r.useState(!1),[G,z]=r.useState(null),[I,k]=r.useState(null),[te,B]=r.useState([]),m=He(["customerPurchases",a,h.purchases.page,h.purchases.limit,h.purchases.start_date,h.purchases.end_date],async()=>a?(await Ie.get(`/customers/${a}/purchases?page=${h.purchases.page}&limit=${h.purchases.limit}&start_date=${h.purchases.start_date}&end_date=${h.purchases.end_date}`)).data:{success:!0,data:{purchases:[],pagination:{totalPages:0,totalItems:0}}},!!a&&!!h.purchases.page,0),l=He(["customerPayments",a,h.payments.page,h.payments.limit,h.payments.start_date,h.payments.end_date],async()=>a?(await Ie.get(`/customers/${a}/payments?page=${h.payments.page}&limit=${h.payments.limit}&start_date=${h.payments.start_date}&end_date=${h.payments.end_date}`)).data:{success:!0,data:{payments:[],pagination:{totalPages:0,totalItems:0}}},!!a&&!!h.payments.page,0);r.useEffect(()=>{var g,S;(g=m.data)!=null&&g.success&&(o(((S=m.data.data)==null?void 0:S.purchases)||[]),u(se=>{var M,O,X,$;return{...se,purchases:{...se.purchases,totalPages:((O=(M=m.data.data)==null?void 0:M.pagination)==null?void 0:O.totalPages)||1,totalItems:(($=(X=m.data.data)==null?void 0:X.pagination)==null?void 0:$.totalItems)||0}}}))},[m.data]),r.useEffect(()=>{var g,S;(g=l.data)!=null&&g.success&&(n(((S=l.data.data)==null?void 0:S.payments)||[]),u(se=>{var M,O,X,$;return{...se,payments:{...se.payments,totalPages:((O=(M=l.data.data)==null?void 0:M.pagination)==null?void 0:O.totalPages)||1,totalItems:(($=(X=l.data.data)==null?void 0:X.pagination)==null?void 0:$.totalItems)||0}}}))},[l.data]);const P=r.useCallback((g,S,se)=>{u(M=>({...M,[g]:{...M[g],[S]:se,...S!=="page"&&{page:1}}}))},[]),d=r.useCallback(()=>{h.purchases.start_date&&h.purchases.end_date&&m.refetch(),h.payments.start_date&&h.payments.end_date&&l.refetch()},[h,m,l]),R=r.useCallback(g=>{u(S=>({...S,[g]:{...S[g],start_date:"",end_date:"",page:1}})),g==="purchases"?m.refetch():g==="payments"&&l.refetch()},[m,l]),J=r.useCallback(g=>{console.log("handleViewPurchaseDetail called with purchase:",g),z(g),B(g.sale_details||[]),C(!0)},[]),F=r.useCallback(g=>{k(g),A(!0)},[]),T=r.useCallback((g,S)=>{ct(g,"sale",S)},[]),b=r.useCallback((g,S)=>{ct(g,"payment",S)},[]),w=r.useCallback((g,S)=>{ct(g,"payment",S)},[]);return{purchaseHistory:s,paymentHistory:p,loadingHistory:m.isLoading||l.isLoading,errorHistory:m.isError||l.isError?((q=m.error)==null?void 0:q.message)||((ae=l.error)==null?void 0:ae.message)||"Error al cargar historial":null,historyFilters:h,openPurchaseDetailDialog:f,setOpenPurchaseDetailDialog:C,openPaymentDetailDialog:L,setOpenPaymentDetailDialog:A,selectedPurchase:G,setSelectedPurchase:z,selectedPayment:I,setSelectedPayment:k,purchaseDetails:te,setPurchaseDetails:B,handleHistoryFilterChange:P,applyHistoryFilters:d,clearHistoryFilters:R,handleViewPurchaseDetail:J,handleViewPaymentDetail:F,handlePrintPurchase:T,handlePrintPayment:b,handlePrintDoublePaymentReceipt:w}},Ka=a=>{const{usuario:s}=r.useContext(na),o=pa(),[p,n]=r.useState([]),[h,u]=r.useState(""),[f,C]=r.useState(""),[L,A]=r.useState(""),[G,z]=r.useState(1),[I,k]=r.useState(1),[te,B]=r.useState(0),[m,l]=r.useState(5),[P,d]=r.useState(""),[R,J]=r.useState("name"),[F,T]=r.useState("ASC"),[b,w]=r.useState(""),[q,ae]=r.useState(""),[g,S]=r.useState("all"),[se,M]=r.useState(!1),[O,X]=r.useState("create"),[$,xe]=r.useState(null),[Ve,ye]=r.useState(!1),[Ee,Ue]=r.useState(!1),{data:oe,isLoading:fe,isError:he,error:le,refetch:re}=He(["customers",G,m,P,R,F,b,q,g],`/customers/all?page=${G}&limit=${m}&search=${P}&sortBy=${R}&sortOrder=${F}&start_date=${b}&end_date=${q}&debt_status=${g}`,!0,5e3),{data:Ge,isLoading:Le}=He(["singleCustomer",$==null?void 0:$.id],async()=>$!=null&&$.id?(await Ie.get(`/customers/${$.id}`)).data:null,!!($!=null&&$.id),0),ve=Wt("createCustomer"),Ce=ua("updateCustomer"),Ae=Pa("deleteCustomer"),Q=Wt("customerPayment");r.useEffect(()=>{var x,E;if(oe!=null&&oe.success){const _=(oe.data||[]).filter(Y=>Y.name!=="Consumidor Final"&&Y.id!==1);n(_),k(((x=oe.pagination)==null?void 0:x.totalPages)||1),B(((E=oe.pagination)==null?void 0:E.totalItems)||0),u("")}else he&&(u((le==null?void 0:le.message)||"Error al cargar los clientes"),n([]))},[oe,he,le]);const qe=r.useCallback(x=>{X("create"),M(!0),xe(null),x({}),A("")},[]),Re=r.useCallback(Sa(async(x,E,_=null)=>{if(x!=="dni"||!E){A("");return}try{const Y=new URLSearchParams({[x]:E});_&&Y.append("customerId",_);const pe=await Ie.get(`/customers/check-duplicate?${Y.toString()}`);A(pe.exists?"Ya existe un cliente con este DNI.":"")}catch(Y){console.error(`Error checking duplicate ${x}:`,Y),A("Error al verificar DNI.")}},500),[]),Qe=r.useCallback(x=>{xe(x),X("edit"),M(!0)},[]),Ne=r.useCallback(x=>{xe(x),X("view"),M(!0)},[]),K=r.useCallback((x,E)=>{if(u(""),L){u("El DNI ya está en uso. Por favor, corríjalo.");return}if(O==="create"&&!a("crear_cliente")){u("No tienes permiso para crear clientes.");return}if(O==="edit"&&!a("editar_cliente")){u("No tienes permiso para editar clientes.");return}const _=O==="create"?ve:Ce,Y={onSuccess:()=>{M(!1),E(),re(),O==="create"&&d(""),O==="edit"&&o.invalidateQueries(["singleCustomer",$.id]),A("")},onError:pe=>console.error("Error:",pe)};O==="create"?_.mutateAsync({url:"/customers",values:x},Y):_.mutateAsync({url:`/customers/${$.id}`,datos:x},Y)},[O,ve,Ce,$,re,L,o,a]),Ke=r.useCallback(x=>{tt.fire({title:"¿Está seguro?",text:`¿Está seguro de eliminar al cliente "${x.name}"? Esta acción no se puede deshacer.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"}).then(E=>{E.isConfirmed&&Ae.mutateAsync({url:"/customers/",id:x.id},{onSuccess:()=>{re(),tt.fire("¡Eliminado!","El cliente ha sido eliminado.","success")},onError:_=>{console.error("Error:",_),tt.fire("Error","Hubo un error al eliminar el cliente.","error")}})})},[Ae,re]),ie=r.useCallback((x,E,_)=>{if(!x.amount||x.amount<=0){u("El monto debe ser mayor a 0");return}Q.mutateAsync({url:`/customers/${E.id}/payments`,values:{...x,created_by:(s==null?void 0:s.nombre)||"Sistema"}},{onSuccess:()=>{ye(!1),C("Pago registrado exitosamente"),re(),o.invalidateQueries(["singleCustomer",E.id]),_({amount:"",payment_method:"efectivo",notes:""})},onError:Y=>console.error("Error:",Y)})},[Q,s,re,o]),Ye=r.useCallback(async()=>{try{const x=await Ie.get("/customers/export/csv",{responseType:"blob"}),E=window.URL.createObjectURL(new Blob([x.data])),_=document.createElement("a");_.href=E,_.download="clientes.csv",document.body.appendChild(_),_.click(),_.remove(),window.URL.revokeObjectURL(E),C("Archivo CSV descargado exitosamente")}catch(x){u("Error al exportar CSV"),console.error("Error:",x)}},[]),Me=r.useCallback((x,E)=>z(E+1),[]),Z=r.useCallback(x=>{l(parseInt(x.target.value,10)),z(1)},[]),Oe=r.useCallback(x=>{d(x),z(1)},[]),We=r.useCallback(x=>{J(x),z(1)},[]),Je=r.useCallback(x=>{T(x),z(1)},[]),Xe=r.useCallback(x=>{w(x),z(1)},[]),Be=r.useCallback(x=>{ae(x),z(1)},[]),Te=r.useCallback(x=>{S(x),z(1)},[]),Ze=r.useCallback(()=>{d(""),J("name"),T("ASC"),w(""),ae(""),S("all"),z(1)},[]);return{customers:p,isLoadingCustomers:fe,isErrorCustomers:he,queryErrorCustomers:le,refetchCustomers:re,page:G,totalPages:I,totalItems:te,limit:m,search:P,sortBy:R,sortOrder:F,startDate:b,endDate:q,debtStatus:g,openDialog:se,setOpenDialog:M,dialogMode:O,setDialogMode:X,selectedCustomer:$,setSelectedCustomer:xe,singleCustomerData:Ge,isLoadingSingleCustomer:Le,openPaymentDialog:Ve,setOpenPaymentDialog:ye,openHistoryDialog:Ee,setOpenHistoryDialog:Ue,handleCreate:qe,handleEdit:Qe,handleView:Ne,handleSave:K,handleDelete:Ke,handleRegisterPayment:ie,handleExportCSV:Ye,handleChangePage:Me,handleChangeRowsPerPage:Z,handleSearchChange:Oe,handleSortByChange:We,handleSortOrderChange:Je,handleStartDateChange:Xe,handleEndDateChange:Be,handleDebtStatusChange:Te,handleClearFilters:Ze,error:h,success:f,setError:u,setSuccess:C,checkDuplicate:Re,dniExistsError:L}},Ps=()=>{var gt,jt,bt,yt,ft,vt,Ct,Pt,St,kt,zt,$t,Dt,It,_t,Ft,Et,Lt;const{usuario:a}=r.useContext(na),s=xa(),o=Bt(s.breakpoints.down("sm"));Bt(s.breakpoints.down("md"));const{tienePermiso:p}=ha(),{customers:n,isLoadingCustomers:h,page:u,totalItems:f,limit:C,search:L,sortBy:A,sortOrder:G,startDate:z,endDate:I,debtStatus:k,openDialog:te,setOpenDialog:B,dialogMode:m,selectedCustomer:l,setSelectedCustomer:P,singleCustomerData:d,isLoadingSingleCustomer:R,openPaymentDialog:J,setOpenPaymentDialog:F,openHistoryDialog:T,setOpenHistoryDialog:b,handleCreate:w,handleEdit:q,handleView:ae,handleSave:g,handleDelete:S,handleRegisterPayment:se,handleExportCSV:M,handleChangePage:O,handleChangeRowsPerPage:X,handleSearchChange:$,handleSortByChange:xe,handleSortOrderChange:Ve,handleStartDateChange:ye,handleEndDateChange:Ee,handleDebtStatusChange:Ue,handleClearFilters:oe,error:fe,success:he,setError:le,setSuccess:re,checkDuplicate:Ge,dniExistsError:Le}=Ka(p),{purchaseHistory:ve,paymentHistory:Ce,errorHistory:Ae,historyFilters:Q,openPurchaseDetailDialog:qe,setOpenPurchaseDetailDialog:Re,openPaymentDetailDialog:Qe,setOpenPaymentDetailDialog:Ne,selectedPurchase:K,setSelectedPurchase:Ke,selectedPayment:ie,setSelectedPayment:Ye,purchaseDetails:Me,handleHistoryFilterChange:Z,applyHistoryFilters:Oe,clearHistoryFilters:We,handleViewPurchaseDetail:Je,handleViewPaymentDetail:Xe,handlePrintPurchase:Be,handlePrintPayment:Te,setSaleIdForDetail:Ze}=Qa(l==null?void 0:l.id),[x,E]=r.useState(!1),[_,Y]=r.useState({width:window.innerWidth,height:window.innerHeight}),[pe,ia]=r.useState(!1),xt=[{value:"name",label:"Nombre"},{value:"createdAt",label:"Fecha"},{value:"debt",label:"Deuda"}],ht=[{value:"ASC",label:"Ascendente"},{value:"DESC",label:"Descendente"}],mt=[{value:"all",label:"Todos"},{value:"with_debt",label:"Con Deuda"},{value:"no_debt",label:"Sin Deuda"}],[ne,de,et,Ya,ce]=ma(),[me,ue]=r.useState({amount:"",payment_method:"efectivo",notes:""});r.useEffect(()=>{var t,j,Pe,At,Rt,Nt,Mt,Ot;d!=null&&d.success&&(m==="edit"||m==="view")?ce({name:((t=d.data)==null?void 0:t.name)||"",email:((j=d.data)==null?void 0:j.email)||"",phone:((Pe=d.data)==null?void 0:Pe.phone)||"",address:((At=d.data)==null?void 0:At.address)||"",dni:((Rt=d.data)==null?void 0:Rt.dni)||"",discount_percentage:((Nt=d.data)==null?void 0:Nt.discount_percentage)||0,credit_limit:((Mt=d.data)==null?void 0:Mt.credit_limit)||0,debt:((Ot=d.data)==null?void 0:Ot.debt)||0}):m==="create"&&ce({name:"",email:"",phone:"",address:"",dni:"",discount_percentage:0,credit_limit:0,debt:0})},[d,m,ce]);const oa=Tt.useMemo(()=>[{id:"id",label:"ID",valueGetter:({row:t})=>t.id,align:"center"},{id:"name",label:"Nombre",valueGetter:({row:t})=>t.name,align:"left"},{id:"email",label:"Email",valueGetter:({row:t})=>t.email||"-",align:"left"},{id:"phone",label:"Teléfono",valueGetter:({row:t})=>t.phone||"-",align:"center"},{id:"dni",label:"DNI",valueGetter:({row:t})=>t.dni||"-",align:"center"},{id:"debt",label:"Deuda",valueGetter:({row:t})=>`${parseFloat((t==null?void 0:t.debt)||0).toFixed(2)}`,cellStyle:({row:t})=>({color:parseFloat((t==null?void 0:t.debt)||0)>0?"error.main":"text.secondary"}),align:"center"},{id:"actions",label:"Acciones",valueGetter:({row:t})=>e.jsxs(v,{sx:{display:"flex",gap:.5,justifyContent:"center"},children:[e.jsx(V,{title:"Ver detalles",children:e.jsx(y,{size:"small",onClick:()=>ae(t),color:"info",children:e.jsx(rt,{fontSize:"small"})})}),p("editar_cliente")&&e.jsx(V,{title:"Editar",children:e.jsx(y,{size:"small",onClick:()=>{q(t),ce(t)},color:"primary",children:e.jsx(Ut,{fontSize:"small"})})}),p("crear_venta")&&e.jsx(V,{title:"Registrar pago",children:e.jsx("span",{children:e.jsx(y,{size:"small",onClick:()=>{P(t),F(!0)},color:"success",disabled:parseFloat(t.debt||0)<=0,children:e.jsx(Zt,{fontSize:"small"})})})}),e.jsx(V,{title:"Historial",children:e.jsx(y,{size:"small",onClick:()=>{P(t),b(!0)},color:"secondary",children:e.jsx(Vt,{fontSize:"small"})})}),p("editar_cliente")&&!o&&e.jsx(V,{title:"Eliminar",children:e.jsx(y,{size:"small",onClick:()=>S(t),color:"error",children:e.jsx(Gt,{fontSize:"small"})})})]}),align:"center"}],[ae,q,ce,P,F,b,S,o,p]);return Tt.useMemo(()=>n.map(t=>({...t,email:t.email||"-",phone:t.phone||"-",dni:t.dni||"-",debt:`${parseFloat(t.debt||0).toFixed(2)}`,actions:e.jsxs(v,{sx:{display:"flex",gap:.5,justifyContent:"center"},children:[e.jsx(V,{title:"Ver detalles",children:e.jsx(y,{size:"small",onClick:()=>ae(t),color:"info",children:e.jsx(rt,{fontSize:"small"})})}),p("editar_cliente")&&e.jsx(V,{title:"Editar",children:e.jsx(y,{size:"small",onClick:()=>{q(t),ce(t)},color:"primary",children:e.jsx(Ut,{fontSize:"small"})})}),p("crear_venta")&&e.jsx(V,{title:"Registrar pago",children:e.jsx("span",{children:e.jsx(y,{size:"small",onClick:()=>{P(t),F(!0)},color:"success",disabled:parseFloat(t.debt||0)<=0,children:e.jsx(Zt,{fontSize:"small"})})})}),e.jsx(V,{title:"Historial",children:e.jsx(y,{size:"small",onClick:()=>{P(t),b(!0)},color:"secondary",children:e.jsx(Vt,{fontSize:"small"})})}),p("editar_cliente")&&!o&&e.jsx(V,{title:"Eliminar",children:e.jsx(y,{size:"small",onClick:()=>S(t),color:"error",children:e.jsx(Gt,{fontSize:"small"})})})]})})),[n,ae,q,ce,P,F,b,S,o,p]),e.jsxs(v,{sx:{p:{xs:1,sm:2,md:3}},children:[e.jsx(at.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsx(ga,{elevation:3,sx:{p:{xs:2,sm:3},mb:3,background:t=>t.palette.background.componentHeaderBackground,color:s.palette.primary.contrastText},children:e.jsxs(v,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(v,{children:[e.jsx(c,{variant:o?"h5":"h4",gutterBottom:!0,children:"Gestión de Clientes"}),e.jsx(c,{variant:"body1",sx:{opacity:.9},children:"Administra tu base de clientes, registra pagos y consulta historiales"})]}),p("crear_cliente")&&e.jsx(H,{variant:"outlined",startIcon:e.jsx(za,{}),onClick:()=>w(ce),size:o?"small":"medium",children:"Nuevo Cliente"})]})})}),e.jsx(at.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},children:e.jsxs(De,{elevation:2,sx:{p:1,mb:3},children:[e.jsxs(i,{container:!0,justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[e.jsx(c,{variant:"h6",children:"Filtros de Clientes"}),e.jsx(y,{disableRipple:!0,size:"small",onClick:()=>ia(!pe),sx:{p:0},children:e.jsx($a,{sx:{transition:"0.5s",transform:pe?"rotate(-180deg)":"rotate(0)",backgroundColor:"primary.main",color:"primary.contrastText",borderRadius:"50%"}})})]}),e.jsx(v,{sx:{height:pe?"auto":0,overflow:"hidden",transition:"height 0.3s ease-in-out"},children:e.jsxs(i,{container:!0,spacing:2,justifyContent:"center",alignItems:"flex-start",marginTop:1,children:[e.jsx(i,{item:!0,xs:12,children:e.jsxs(i,{container:!0,spacing:2,justifyContent:"center",alignItems:"flex-start",children:[e.jsx(i,{item:!0,sx:{width:"clamp(250px, 30%, 350px)"},children:e.jsxs(i,{container:!0,direction:"column",spacing:2,children:[e.jsx(i,{item:!0,children:e.jsx(D,{label:"Fecha Desde",type:"date",name:"startDate",value:z,onChange:t=>ye(t.target.value),fullWidth:!0,size:"small",autoComplete:"off",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(W,{position:"start",children:e.jsx(y,{size:"small",onClick:()=>ye(""),children:e.jsx(N,{fontSize:"small",color:"error"})})})}})}),e.jsx(i,{item:!0,children:e.jsx(D,{label:"Fecha Hasta",type:"date",name:"endDate",value:I,onChange:t=>Ee(t.target.value),fullWidth:!0,size:"small",autoComplete:"off",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(W,{position:"start",children:e.jsx(y,{size:"small",onClick:()=>Ee(""),children:e.jsx(N,{fontSize:"small",color:"error"})})})}})})]})}),e.jsx(i,{item:!0,sx:{width:"clamp(250px, 30%, 350px)"},children:e.jsxs(i,{container:!0,direction:"column",spacing:2,children:[e.jsx(i,{item:!0,children:e.jsx(D,{fullWidth:!0,size:"small",placeholder:"Buscar por nombre, email, etc.",value:L,onChange:t=>$(t.target.value),InputProps:{startAdornment:e.jsx(ka,{sx:{mr:1,color:"text.secondary"}}),endAdornment:L&&e.jsx(y,{size:"small",onClick:()=>$(""),children:e.jsx(N,{})})}})}),e.jsx(i,{item:!0,children:e.jsx(it,{fullWidth:!0,size:"small",options:xt,getOptionLabel:t=>t.label,value:xt.find(t=>t.value===A)||null,onChange:(t,j)=>xe(j?j.value:""),renderInput:t=>e.jsx(D,{...t,label:"Ordenar por"})})})]})}),e.jsx(i,{item:!0,sx:{width:"clamp(250px, 30%, 350px)"},children:e.jsxs(i,{container:!0,direction:"column",spacing:2,children:[e.jsx(i,{item:!0,children:e.jsx(it,{fullWidth:!0,size:"small",options:ht,getOptionLabel:t=>t.label,value:ht.find(t=>t.value===G)||null,onChange:(t,j)=>Ve(j?j.value:""),renderInput:t=>e.jsx(D,{...t,label:"Orden"})})}),e.jsx(i,{item:!0,children:e.jsx(it,{fullWidth:!0,size:"small",options:mt,getOptionLabel:t=>t.label,value:mt.find(t=>t.value===k)||null,onChange:(t,j)=>Ue(j?j.value:""),renderInput:t=>e.jsx(D,{...t,label:"Estado de Deuda"})})})]})})]})}),e.jsx(i,{item:!0,xs:12,children:e.jsxs(i,{container:!0,spacing:2,justifyContent:"center",alignItems:"center",children:[e.jsx(i,{item:!0,children:e.jsx(H,{variant:"outlined",color:"secondary",onClick:oe,children:"Limpiar Filtros"})}),e.jsx(i,{item:!0,children:e.jsx(H,{variant:"outlined",startIcon:e.jsx(Da,{}),onClick:()=>M(),size:o?"small":"medium",children:"Exportar CSV"})})]})})]})})]})}),e.jsx(at.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:h?e.jsx(v,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(c,{children:"Cargando clientes..."})}):n.length>0?e.jsx(De,{elevation:2,sx:{p:2,mb:3,maxWidth:"100%",overflow:"auto"},children:e.jsx(va,{columns:oa,data:n,loading:h,count:f,page:u,rowsPerPage:C,onPageChange:O,onRowsPerPageChange:X})}):e.jsx(v,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(c,{color:"text.secondary",children:fe?"Error al cargar datos. Verifique la conexión del servidor.":"No hay clientes registrados"})})}),e.jsx(Ca,{visibleFab:x,screenSize:_}),e.jsxs(Se,{open:te,onClose:()=>{B(!1),P(null),et()},maxWidth:"md",fullWidth:!0,fullScreen:o,children:[e.jsxs(ke,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:"background.dialog",color:"text.primary"},children:[e.jsxs(v,{children:[m==="create"&&"Nuevo Cliente",m==="edit"&&"Editar Cliente",m==="view"&&"Detalles del Cliente"]}),e.jsx(y,{onClick:()=>{B(!1),P(null),et()},children:e.jsx(ja,{color:"error"})})]}),e.jsx(ze,{sx:{backgroundColor:"background.dialog"},children:R?e.jsx(v,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(c,{children:"Cargando detalles del cliente..."})}):m==="create"||m==="edit"?e.jsx(v,{sx:{pt:2},children:e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(D,{fullWidth:!0,label:"Nombre *",value:ne.name||"",onChange:t=>de({target:{name:"name",value:t.target.value}}),margin:"normal",required:!0,InputProps:{startAdornment:e.jsx(W,{position:"start",children:e.jsx(y,{size:"small",onClick:()=>reset("name"),children:e.jsx(N,{fontSize:"small",color:"error"})})})}})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(D,{fullWidth:!0,label:"DNI",value:ne.dni||"",onChange:t=>{de({target:{name:"dni",value:t.target.value}}),Ge("dni",t.target.value,l==null?void 0:l.id)},margin:"normal",error:!!Le,helperText:Le,InputProps:{startAdornment:e.jsx(W,{position:"start",children:e.jsx(y,{size:"small",onClick:()=>reset("dni"),children:e.jsx(N,{fontSize:"small",color:"error"})})})}})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(D,{fullWidth:!0,label:"Teléfono",value:ne.phone||"",onChange:t=>de({target:{name:"phone",value:t.target.value}}),margin:"normal",InputProps:{startAdornment:e.jsx(W,{position:"start",children:e.jsx(y,{size:"small",onClick:()=>reset("phone"),children:e.jsx(N,{fontSize:"small",color:"error"})})})}})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(D,{fullWidth:!0,label:"Email",type:"email",value:ne.email||"",onChange:t=>de({target:{name:"email",value:t.target.value}}),margin:"normal",InputProps:{startAdornment:e.jsx(W,{position:"start",children:e.jsx(y,{size:"small",onClick:()=>reset("email"),children:e.jsx(N,{fontSize:"small",color:"error"})})})}})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(D,{fullWidth:!0,label:"Dirección",value:ne.address||"",onChange:t=>de({target:{name:"address",value:t.target.value}}),margin:"normal",InputProps:{startAdornment:e.jsx(W,{position:"start",children:e.jsx(y,{size:"small",onClick:()=>reset("address"),children:e.jsx(N,{fontSize:"small",color:"error"})})})}})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(D,{fullWidth:!0,label:"Porcentaje de Descuento",type:"text",value:String(ne.discount_percentage||""),onChange:t=>de({target:{name:"discount_percentage",value:t.target.value===""?0:parseFloat(t.target.value)}}),margin:"normal",inputProps:{inputMode:"numeric",pattern:"[0-9]*"},InputProps:{startAdornment:e.jsx(W,{position:"start",children:e.jsx(y,{size:"small",onClick:()=>reset("discount_percentage"),children:e.jsx(N,{fontSize:"small",color:"error"})})})}})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(D,{fullWidth:!0,label:"Límite de Crédito",type:"text",value:String(ne.credit_limit||""),onChange:t=>de({target:{name:"credit_limit",value:t.target.value===""?0:parseFloat(t.target.value)}}),margin:"normal",inputProps:{inputMode:"numeric",pattern:"[0-9]*"},InputProps:{startAdornment:e.jsx(W,{position:"start",children:e.jsx(y,{size:"small",onClick:()=>reset("credit_limit"),children:e.jsx(N,{fontSize:"small",color:"error"})})})}})}),m==="create"&&e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(D,{fullWidth:!0,label:"Deuda Inicial",type:"text",value:String(ne.debt||""),onChange:t=>de({target:{name:"debt",value:t.target.value===""?0:parseFloat(t.target.value)}}),margin:"normal",inputProps:{inputMode:"numeric",pattern:"[0-9]*"},InputProps:{startAdornment:e.jsx(W,{position:"start",children:e.jsx(y,{size:"small",onClick:()=>reset("debt"),children:e.jsx(N,{fontSize:"small",color:"error"})})})}})}),m==="edit"&&e.jsx(i,{item:!0,xs:12,children:e.jsx(D,{fullWidth:!0,label:"Deuda Actual",value:ne.debt||"",margin:"normal",InputProps:{readOnly:!0}})})]})}):d!=null&&d.success?e.jsx(v,{sx:{pt:2},children:e.jsxs(i,{container:!0,spacing:3,children:[e.jsxs(i,{item:!0,xs:12,sm:6,children:[e.jsxs(c,{variant:"h6",gutterBottom:!0,children:[e.jsx(Ia,{sx:{mr:1,verticalAlign:"middle"}}),"Información Personal"]}),e.jsxs(c,{variant:"body2",children:[e.jsx(c,{component:"span",fontWeight:"bold",children:"Nombre:"})," ",(gt=d.data)==null?void 0:gt.name]}),e.jsxs(c,{variant:"body2",children:[e.jsx(c,{component:"span",fontWeight:"bold",children:"DNI:"})," ",((jt=d.data)==null?void 0:jt.dni)||"No especificado"]}),e.jsxs(c,{variant:"body2",children:[e.jsx(c,{component:"span",fontWeight:"bold",children:"Teléfono:"})," ",((bt=d.data)==null?void 0:bt.phone)||"No especificado"]}),e.jsxs(c,{variant:"body2",children:[e.jsx(c,{component:"span",fontWeight:"bold",children:"Email:"})," ",((yt=d.data)==null?void 0:yt.email)||"No especificado"]}),e.jsxs(c,{variant:"body2",children:[e.jsx(c,{component:"span",fontWeight:"bold",children:"Dirección:"})," ",((ft=d.data)==null?void 0:ft.address)||"No especificada"]})]}),e.jsxs(i,{item:!0,xs:12,sm:6,children:[e.jsxs(c,{variant:"h6",gutterBottom:!0,children:[e.jsx(Ga,{sx:{mr:1,verticalAlign:"middle"}}),"Información Financiera"]}),e.jsxs(c,{variant:"body2",children:[e.jsx(c,{component:"span",fontWeight:"bold",children:"Descuento:"})," ",(vt=d.data)==null?void 0:vt.discount_percentage,"%"]}),e.jsxs(c,{variant:"body2",children:[e.jsx(c,{component:"span",fontWeight:"bold",children:"Límite de Crédito:"})," $",(Ct=d.data)==null?void 0:Ct.credit_limit]}),e.jsxs(v,{children:[e.jsx(c,{component:"span",variant:"body2",fontWeight:"bold",children:"Crédito Disponible:"}),e.jsx(qt,{label:`$ ${(parseFloat(((Pt=d.data)==null?void 0:Pt.credit_limit)||0)-parseFloat(((St=d.data)==null?void 0:St.debt)||0)).toFixed(2)}`,color:parseFloat(((kt=d.data)==null?void 0:kt.credit_limit)||0)-parseFloat(((zt=d.data)==null?void 0:zt.debt)||0)>=0?"success":"error",size:"small",sx:{ml:1}})]}),e.jsxs(v,{children:[e.jsx(c,{component:"span",variant:"body2",fontWeight:"bold",children:"Deuda Actual:"}),e.jsx(qt,{label:`$ ${($t=d.data)==null?void 0:$t.debt}`,color:parseFloat(((Dt=d.data)==null?void 0:Dt.debt)||0)>0?"error":"success",size:"small",sx:{ml:1}})]})]}),((It=d.data)==null?void 0:It.payments)&&d.data.payments.length>0&&e.jsxs(i,{item:!0,xs:12,children:[e.jsx(c,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:"Últimos Pagos"}),e.jsx(st,{dense:!0,children:d.data.payments.slice(0,5).map((t,j)=>e.jsx(ot,{children:e.jsx(lt,{primary:`${t.amount} - ${t.payment_method}`,secondary:new Date(t.payment_date).toLocaleDateString()})},j))})]})]})}):e.jsx(v,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(c,{color:"error",children:"Error al cargar los detalles del cliente."})})}),e.jsxs($e,{sx:{p:2,backgroundColor:"background.dialog"},children:[e.jsx(H,{variant:"outlined",color:"secondary",sx:{padding:"2px 12px"},onClick:()=>{B(!1)},children:"Cerrar"}),m!=="view"&&e.jsx(H,{onClick:()=>g(ne,et),variant:"contained",disabled:R||!String(ne.name||"").trim(),children:m==="create"?"Crear":"Actualizar"})]})]}),e.jsxs(Se,{open:J,onClose:()=>{F(!1),ue({amount:"",payment_method:"efectivo",notes:""})},maxWidth:"lg",fullWidth:!0,disableRestoreFocus:!0,"aria-labelledby":"payment-dialog-title","aria-describedby":"payment-dialog-description",slotProps:{backdrop:{invisible:!1,sx:{backgroundColor:"rgba(0, 0, 0, 0.5)"}}},TransitionProps:{onEntering:()=>{},onExited:()=>{}},children:[e.jsxs(ke,{id:"payment-dialog-title",children:["Registrar Pago - ",l==null?void 0:l.name]}),e.jsx(ze,{id:"payment-dialog-description",children:e.jsxs(v,{sx:{pt:2},children:[e.jsxs(nt,{severity:"info",sx:{mb:2},children:["Deuda actual: $",l==null?void 0:l.debt]}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(D,{fullWidth:!0,label:"Monto a Pagar *",type:"number",value:me.amount,onChange:t=>ue(j=>({...j,amount:t.target.value})),inputProps:{min:.01,max:(l==null?void 0:l.debt)||0,step:.01},required:!0,InputProps:{startAdornment:e.jsx(W,{position:"start",children:e.jsx(y,{size:"small",onClick:()=>ue(t=>({...t,amount:""})),children:e.jsx(N,{fontSize:"small",color:"error"})})})}})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsxs(ba,{fullWidth:!0,children:[e.jsx(ya,{children:"Método de Pago"}),e.jsxs(fa,{value:me.payment_method,onChange:t=>ue(j=>({...j,payment_method:t.target.value})),label:"Método de Pago",children:[e.jsx(je,{value:"efectivo",children:"Efectivo"}),e.jsx(je,{value:"tarjeta_debito",children:"Tarjeta de Débito"}),e.jsx(je,{value:"tarjeta_credito",children:"Tarjeta de Crédito"}),e.jsx(je,{value:"transferencia",children:"Transferencia"}),e.jsx(je,{value:"cheque",children:"Cheque"}),e.jsx(je,{value:"otro",children:"Otro"})]})]})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(D,{fullWidth:!0,label:"Notas (opcional)",value:me.notes,onChange:t=>ue(j=>({...j,notes:t.target.value})),multiline:!0,rows:3,InputProps:{startAdornment:e.jsx(W,{position:"start",children:e.jsx(y,{size:"small",onClick:()=>ue(t=>({...t,notes:""})),children:e.jsx(N,{fontSize:"small",color:"error"})})})}})})]})]})}),e.jsxs($e,{children:[e.jsx(H,{sx:{padding:"2px 12px"},onClick:()=>{F(!1)},children:"Cancelar"}),e.jsx(H,{onClick:()=>se(me,l,ue),variant:"contained",disabled:R||!me.amount||me.amount<=0,children:"Registrar Pago"})]})]}),e.jsxs(Se,{open:T,onClose:()=>{b(!1)},maxWidth:"xl",fullWidth:!0,fullScreen:o,disableRestoreFocus:!0,"aria-labelledby":"history-dialog-title","aria-describedby":"history-dialog-description",slotProps:{backdrop:{invisible:!1,sx:{backgroundColor:"rgba(0, 0, 0, 0.5)"}}},TransitionProps:{onEntering:()=>{},onExited:()=>{}},children:[e.jsxs(ke,{id:"history-dialog-title",children:["Historial - ",l==null?void 0:l.name]}),e.jsx(ze,{id:"history-dialog-description",children:e.jsx(v,{sx:{pt:2},children:e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{item:!0,xs:12,lg:6,children:e.jsx(De,{variant:"outlined",children:e.jsxs(dt,{children:[e.jsx(c,{variant:"h6",gutterBottom:!0,color:s.palette.text.titlePrimary,children:"Historial de Compras (Solo Crédito)"}),e.jsxs(c,{variant:"subtitle1",color:"text.secondary",sx:{mb:2},children:["Total Compras a Crédito: $",((Ft=(_t=d==null?void 0:d.data)==null?void 0:_t.totalCreditSales)==null?void 0:Ft.toFixed(2))||"0.00"]}),e.jsx(v,{sx:{mb:2,p:2,border:"1px solid",borderColor:"divider",borderRadius:1},children:e.jsxs(i,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(i,{item:!0,xs:12,sm:5,children:e.jsx(D,{fullWidth:!0,size:"small",label:"Fecha Desde",type:"date",value:Q.purchases.start_date,onChange:t=>Z("purchases","start_date",t.target.value),InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(W,{position:"start",children:e.jsx(y,{size:"small",onClick:()=>Z("purchases","start_date",""),children:e.jsx(N,{fontSize:"small",color:"error"})})})}})}),e.jsx(i,{item:!0,xs:12,sm:5,children:e.jsx(D,{fullWidth:!0,size:"small",label:"Fecha Hasta",type:"date",value:Q.purchases.end_date,onChange:t=>Z("purchases","end_date",t.target.value),InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(W,{position:"start",children:e.jsx(y,{size:"small",onClick:()=>Z("purchases","end_date",""),children:e.jsx(N,{fontSize:"small",color:"error"})})})}})}),e.jsx(i,{item:!0,xs:12,sm:2,children:e.jsx(Qt,{direction:"row",spacing:1,children:e.jsx(H,{size:"small",variant:"outlined",onClick:()=>We("purchases"),children:"Limpiar"})})})]})}),ve.length>0?e.jsxs(e.Fragment,{children:[e.jsx(st,{dense:!0,children:ve.map((t,j)=>e.jsx(ot,{secondaryAction:e.jsxs(v,{sx:{display:"flex",gap:.5},children:[e.jsx(V,{title:"Ver detalle",children:e.jsx(y,{size:"small",onClick:()=>Je(t),color:"info",children:e.jsx(rt,{fontSize:"small"})})}),e.jsx(V,{title:"Imprimir",children:e.jsx(y,{size:"small",onClick:()=>Be(t),color:"primary",children:e.jsx(we,{fontSize:"small"})})})]}),children:e.jsx(lt,{primary:`Venta #${t.id} - ${t.total_neto}`,secondary:new Date(t.createdAt).toLocaleDateString()})},j))}),e.jsx(v,{sx:{display:"flex",justifyContent:"center",mt:2},children:e.jsx(Xt,{count:Q.purchases.totalPages,page:Q.purchases.page,onChange:(t,j)=>{Z("purchases","page",j),Oe("purchases")},size:"small",color:"primary"})}),e.jsxs(c,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:["Total: ",Q.purchases.totalItems," compras"]})]}):e.jsx(c,{color:"text.secondary",children:"No hay compras a crédito registradas"})]})})}),e.jsx(i,{item:!0,xs:12,lg:6,children:e.jsx(De,{variant:"outlined",children:e.jsxs(dt,{children:[e.jsx(c,{variant:"h6",gutterBottom:!0,color:s.palette.text.titleSecondary,children:"Historial de Pagos"}),e.jsxs(c,{variant:"subtitle1",color:"text.secondary",sx:{mb:2},children:["Total Pagos Recibidos: $",((Lt=(Et=d==null?void 0:d.data)==null?void 0:Et.totalPaymentsReceived)==null?void 0:Lt.toFixed(2))||"0.00"]}),e.jsx(v,{sx:{mb:2,p:2,border:"1px solid",borderColor:"divider",borderRadius:1},children:e.jsxs(i,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(i,{item:!0,xs:12,sm:5,children:e.jsx(D,{fullWidth:!0,size:"small",label:"Fecha Desde",type:"date",value:Q.payments.start_date,onChange:t=>Z("payments","start_date",t.target.value),InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(W,{position:"start",children:e.jsx(y,{size:"small",onClick:()=>Z("payments","start_date",""),children:e.jsx(N,{fontSize:"small",color:"error"})})})}})}),e.jsx(i,{item:!0,xs:12,sm:5,children:e.jsx(D,{fullWidth:!0,size:"small",label:"Fecha Hasta",type:"date",value:Q.payments.end_date,onChange:t=>Z("payments","end_date",t.target.value),InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(W,{position:"start",children:e.jsx(y,{size:"small",onClick:()=>Z("payments","end_date",""),children:e.jsx(N,{fontSize:"small",color:"error"})})})}})}),e.jsx(i,{item:!0,xs:12,sm:2,children:e.jsx(Qt,{direction:"row",spacing:1,children:e.jsx(H,{size:"small",variant:"outlined",onClick:()=>We("payments"),children:"Limpiar"})})})]})}),Ce.length>0?e.jsxs(e.Fragment,{children:[e.jsx(st,{dense:!0,children:Ce.map((t,j)=>e.jsx(ot,{secondaryAction:e.jsxs(v,{sx:{display:"flex",gap:.5},children:[e.jsx(V,{title:"Ver detalle",children:e.jsx(y,{size:"small",onClick:()=>Xe(t),color:"info",children:e.jsx(qa,{fontSize:"small"})})}),e.jsx(V,{title:"Imprimir comprobante",children:e.jsx(y,{size:"small",onClick:()=>Te(t),color:"primary",children:e.jsx(we,{fontSize:"small"})})})]}),children:e.jsx(lt,{primary:`${t.amount} - ${t.payment_method}`,secondary:`${new Date(t.payment_date).toLocaleDateString()} ${t.notes?`- ${t.notes}`:""}`})},j))}),e.jsx(v,{sx:{display:"flex",justifyContent:"center",mt:2},children:e.jsx(Xt,{count:Q.payments.totalPages,page:Q.payments.page,onChange:(t,j)=>{Z("payments","page",j),Oe("payments")},size:"small",color:"secondary"})}),e.jsxs(c,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:["Total: ",Q.payments.totalItems," pagos"]})]}):e.jsx(c,{color:"text.secondary",children:"No hay pagos registrados"})]})})})]})})}),e.jsx($e,{children:e.jsx(H,{onClick:()=>{b(!1)},children:"Cerrar"})})]}),e.jsxs(Se,{open:qe,onClose:()=>{Re(!1),Ke(null),Ze(null)},maxWidth:"xl",fullWidth:!0,fullScreen:o,disableRestoreFocus:!0,"aria-labelledby":"purchase-detail-dialog-title","aria-describedby":"purchase-detail-dialog-description",slotProps:{backdrop:{invisible:!1,sx:{backgroundColor:"rgba(0, 0, 0, 0.5)"}}},TransitionProps:{onEntering:()=>{},onExited:()=>{}},children:[e.jsxs(ke,{id:"purchase-detail-dialog-title",children:["Detalle de Compra #",K==null?void 0:K.id]}),e.jsx(ze,{id:"purchase-detail-dialog-description",children:e.jsx(v,{sx:{pt:2},children:K&&e.jsxs(e.Fragment,{children:[e.jsxs(i,{container:!0,spacing:2,sx:{mb:3},children:[e.jsxs(i,{item:!0,xs:12,sm:6,children:[e.jsxs(c,{children:[e.jsx("strong",{children:"Cliente:"})," ",l==null?void 0:l.name]}),e.jsxs(c,{children:[e.jsx("strong",{children:"Fecha:"})," ",new Date(K.createdAt).toLocaleDateString()]})]}),e.jsxs(i,{item:!0,xs:12,sm:6,children:[e.jsxs(c,{children:[e.jsx("strong",{children:"Método de Pago:"})," ",K.sale_payments&&K.sale_payments.length>0?K.sale_payments.map(t=>{var j;return`${(j=t.payment)==null?void 0:j.method}: ${t.amount}`}).join(" / "):"No especificado"]}),e.jsxs(c,{children:[e.jsx("strong",{children:"Total:"})," $",K.total_neto]})]})]}),e.jsx(_a,{sx:{mb:2}}),e.jsx(c,{variant:"h6",gutterBottom:!0,children:"Productos"}),Me.length>0?e.jsx(v,{sx:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:s.palette.primary.main},children:[e.jsx("th",{style:{border:`1px solid ${s.palette.divider}`,padding:"8px",textAlign:"left",color:s.palette.primary.contrastText},children:"Producto"}),e.jsx("th",{style:{border:`1px solid ${s.palette.divider}`,padding:"8px",textAlign:"center",color:s.palette.primary.contrastText},children:"Cantidad"}),e.jsx("th",{style:{border:`1px solid ${s.palette.divider}`,padding:"8px",textAlign:"right",color:s.palette.primary.contrastText},children:"Precio Unit."}),e.jsx("th",{style:{border:`1px solid ${s.palette.divider}`,padding:"8px",textAlign:"right",color:s.palette.primary.contrastText},children:"Subtotal"})]})}),e.jsx("tbody",{children:Me.map((t,j)=>{var Pe;return e.jsxs("tr",{children:[e.jsx("td",{style:{border:`1px solid ${s.palette.divider}`,padding:"8px"},children:((Pe=t.stock)==null?void 0:Pe.name)||"Producto no encontrado"}),e.jsx("td",{style:{border:`1px solid ${s.palette.divider}`,padding:"8px",textAlign:"center"},children:t.quantity}),e.jsxs("td",{style:{border:`1px solid ${s.palette.divider}`,padding:"8px",textAlign:"right"},children:["$",t.price]}),e.jsxs("td",{style:{border:`1px solid ${s.palette.divider}`,padding:"8px",textAlign:"right"},children:["$",(t.quantity*t.price).toFixed(2)]})]},j)})})]})}):e.jsx(c,{color:"text.secondary",children:"No se encontraron detalles de productos"}),e.jsx(v,{sx:{mt:2,textAlign:"right"},children:e.jsx(c,{variant:"h6",children:e.jsxs("strong",{children:["Total: $",K.total_neto]})})})]})})}),e.jsxs($e,{children:[e.jsx(H,{onClick:()=>{Re(!1)},children:"Cerrar"}),e.jsx(H,{onClick:()=>Be(K,l==null?void 0:l.name),variant:"contained",startIcon:e.jsx(we,{}),children:"Imprimir"})]})]}),e.jsxs(Se,{open:Qe,onClose:()=>{Ne(!1),Ye(null)},maxWidth:"lg",fullWidth:!0,disableRestoreFocus:!0,"aria-labelledby":"payment-detail-dialog-title","aria-describedby":"payment-detail-dialog-description",slotProps:{backdrop:{invisible:!1,sx:{backgroundColor:"rgba(0, 0, 0, 0.5)"}}},TransitionProps:{onEntering:()=>{},onExited:()=>{}},children:[e.jsx(ke,{id:"payment-detail-dialog-title",children:"Detalle de Pago"}),e.jsx(ze,{id:"payment-detail-dialog-description",children:e.jsx(v,{sx:{pt:2},children:ie&&e.jsx(i,{container:!0,spacing:2,children:e.jsx(i,{item:!0,xs:12,children:e.jsx(De,{variant:"outlined",children:e.jsxs(dt,{children:[e.jsx(c,{variant:"h6",gutterBottom:!0,color:s.palette.text.titlePrimary,children:"Información del Pago"}),e.jsxs(c,{children:[e.jsx("strong",{children:"Cliente:"})," ",l==null?void 0:l.name]}),e.jsxs(c,{children:[e.jsx("strong",{children:"Monto:"})," $",ie.amount]}),e.jsxs(c,{children:[e.jsx("strong",{children:"Método de Pago:"})," ",ie.payment_method]}),e.jsxs(c,{children:[e.jsx("strong",{children:"Fecha:"})," ",new Date(ie.payment_date).toLocaleDateString()]}),e.jsxs(c,{children:[e.jsx("strong",{children:"Creado por:"})," ",ie.created_by||"Sistema"]}),ie.notes&&e.jsxs(c,{children:[e.jsx("strong",{children:"Notas:"})," ",ie.notes]})]})})})})})}),e.jsxs($e,{children:[e.jsx(H,{onClick:()=>{Ne(!1)},children:"Cerrar"}),e.jsx(H,{onClick:()=>Te(ie,l==null?void 0:l.name),variant:"contained",startIcon:e.jsx(we,{}),children:"Imprimir Comprobante"})]})]}),e.jsx(Kt,{open:!!fe,autoHideDuration:6e3,onClose:r.useCallback(()=>le(""),[le]),children:e.jsx(nt,{severity:"error",children:fe||Ae})}),e.jsx(Kt,{open:!!he,autoHideDuration:4e3,onClose:r.useCallback(()=>re(""),[re]),children:e.jsx(nt,{severity:"success",children:he})})]})};export{Ps as default};
